var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)}
return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length
var a=Array(t),o=0
for(e=0;e<i;e++)for(var r=arguments[e],n=0,s=r.length;n<s;n++,o++)a[o]=r[n]
return a},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,a=arguments.length;i<a;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])
return t}).apply(this,arguments)},Actores=function(){function t(t){this.pilas=t}return t.prototype.crear_actor=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),e||(e=window[t])
var a=new e(this.pilas),o=this.pilas.utilidades.combinar_propiedades(a.propiedades_base,a.propiedades)
if(!o.nombre){var r=this.pilas.escena.obtener_nombre_para(t)
o.nombre=r}return i&&(o.imagen=i),a.pre_iniciar(o),a.iniciar(),a},t.prototype.vincular=function(t,e){var i=this
if(!t||!e)throw new Error("Tiene que especificar el nombre del actor y la clase para vincularlo.")
this[t]=function(){return i.crear_actor(t,e)}},t.prototype.actor=function(){return this.crear_actor("Actor")},t.prototype.aceituna=function(){return this.crear_actor("aceituna")},t.prototype.caja=function(){return this.crear_actor("caja")},t.prototype.conejo=function(){return this.crear_actor("conejo")},t.prototype.logo=function(){return this.crear_actor("logo")},t.prototype.moneda=function(){return this.crear_actor("moneda")},t.prototype.nave=function(){return this.crear_actor("nave")},t.prototype.nube=function(){return this.crear_actor("nube")},t.prototype.pared=function(){return this.crear_actor("pared")},t.prototype.pelota=function(){return this.crear_actor("pelota")},t.prototype.plataforma=function(){return this.crear_actor("plataforma")},t.prototype.suelo=function(){return this.crear_actor("suelo")},t.prototype.techo=function(){return this.crear_actor("techo")},t.prototype.texto=function(){return this.crear_actor("texto")},t.prototype.laser=function(){return this.crear_actor("laser")},t.prototype.deslizador=function(){return this.crear_actor("deslizador")},t.prototype.boton=function(){return this.crear_actor("boton")},t.prototype.boton_izquierda=function(){return this.crear_actor("boton_izquierda")},t.prototype.boton_derecha=function(){return this.crear_actor("boton_derecha")},t.prototype.boton_arriba=function(){return this.crear_actor("boton_arriba")},t.prototype.boton_abajo=function(){return this.crear_actor("boton_abajo")},t.prototype.boton_espacio=function(){return this.crear_actor("boton_espacio")},t.prototype.robot=function(){return this.crear_actor("robot")},t.prototype.puntaje=function(){return this.crear_actor("puntaje")},t.prototype.reiniciar_escena=function(){return this.crear_actor("reiniciar_escena")},t.prototype.nube_animada=function(){return this.crear_actor("nube_animada")},t.prototype.pizarra=function(){return this.crear_actor("pizarra")},t.prototype.explosion=function(){return this.crear_actor("explosion")},t.prototype.boton_activable=function(){return this.crear_actor("boton_activable")},t.prototype.pantalla_completa=function(){return this.crear_actor("pantalla_completa")},t.prototype.barra_de_energia=function(){return this.crear_actor("barra_de_energia")},t.prototype.interruptor_de_gravedad=function(){return this.crear_actor("interruptor_de_gravedad")},t.prototype.actor_basico=function(t){return this.crear_actor("Actor",null,t)},t}(),Tipo;(function(t){t.lineal="Linear",t.suave="Cubic",t.elastico="Elastic",t.rebote="Bounce",t.desborde="Back"})(Tipo||(Tipo={}))
var AnimacionDePropiedad=function(){function t(t,e,i,a,o){if(void 0===i&&(i=Tipo.lineal),this.veces_que_ejecuto=0,this.data=[],this.pilas=t,this.actor=e,this.tipo_de_animacion=i,this.veces=a,this.duración=o,a<-1||0===a)throw Error("La cantidad de veces tiene que ser -1 o un número mayor a 0. Se envió el valor "+a)}return t.prototype.repetir=function(){return this.ejecutar(),this},t.prototype.cuando_finaliza=function(){},t.prototype.explotar=function(){var t=this
return this.funcion((function(){var e=t.pilas.actores.explosion()
e.x=t.actor.x,e.y=t.actor.y,t.actor.eliminar(),t.eliminar_inmediatamente()})),this},t.prototype.agregar=function(t){var e=t.duración
return 0===e&&(e=this.duración),t.duration=1e3*e,t.duración=void 0,this.data.push(t),this},t.prototype.mover=function(t,e,i){return void 0===i&&(i=0),this.agregar({x:"+="+t,y:"+="+e,duración:i})},t.prototype.mover_x=function(t,e){return void 0===e&&(e=0),this.agregar({x:"+="+t,duración:e})},t.prototype.mover_y=function(t,e){return void 0===e&&(e=0),this.agregar({y:"+="+t,duración:e})},t.prototype.mover_hasta=function(t,e,i){return void 0===i&&(i=0),this.agregar({x:t,y:e,duración:i})},t.prototype.mover_x_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({x:t,duración:e})},t.prototype.mover_y_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({y:t,duración:e})},t.prototype.rotar=function(t,e){return void 0===e&&(e=0),this.agregar({rotacion:"+="+t,duración:e})},t.prototype.rotar_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({rotacion:t,duración:e})},t.prototype.eliminar=function(){var t=this
return this.funcion((function(){t.eliminar_inmediatamente()})),this},t.prototype.eliminar_inmediatamente=function(){this.timeline&&this.timeline.destroy(),this.data=[],this.timeline=null},t.prototype.ejecutar=function(){var t=this
return this.timeline&&this.timeline.destroy(),this.timeline=this.pilas.modo.tweens.createTimeline(),this.data.map((function(e){var i=JSON.parse(JSON.stringify(e))
i.targets=t.actor,i.ease=t.tipo_de_animacion,e.onStart&&(i.onStart=e.onStart),t.timeline.add(i)})),this.timeline.on("complete",(function(){t.veces_que_ejecuto+=1,t.veces_que_ejecuto==t.veces?t.cuando_finaliza():t.repetir()})),this.timeline.play(),this},t.prototype.funcion=function(t){var e=this
return this.agregar({demo:0,duración:.001,onStart:function(){try{t.call(this)}catch(i){e.pilas.mensajes.emitir_excepcion_al_editor(i,"animación de propiedad")}}})},t.prototype.decir=function(t){var e=this
return this.funcion((function(){e.actor.decir(t)})),this},t.prototype.esperar=function(t){return this.agregar({demo:0,duración:t})},t.prototype.escalar_x=function(t,e){return void 0===e&&(e=0),this.agregar({escala_x:"+="+t,duración:e})},t.prototype.escalar_y=function(t,e){return void 0===e&&(e=0),this.agregar({escala_y:"+="+t,duración:e})},t.prototype.escalar=function(t,e){return void 0===e&&(e=0),this.agregar({escala:"+="+t,duración:e})},t.prototype.escalar_x_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({escala_x:t,duración:e})},t.prototype.escalar_y_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({escala_y:t,duración:e})},t.prototype.escalar_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({escala:t,duración:e})},t.prototype.transparencia_hasta=function(t,e){return void 0===e&&(e=0),this.agregar({transparencia:t,duración:e})},t.prototype.ocultar=function(t){return void 0===t&&(t=0),this.transparencia_hasta(100,t)},t.prototype.mostrar=function(t){return void 0===t&&(t=0),this.transparencia_hasta(0,t)},t}(),AnimacionNula=function(t){function e(){return t.call(this,null,null,null,null,null)||this}return __extends(e,t),e.prototype.cuando_finaliza=function(){},e.prototype.explotar=function(){return this},e.prototype.mover_x=function(){return this},e.prototype.mover_y=function(){return this},e.prototype.mover_hasta=function(){return this},e.prototype.mover_x_hasta=function(){return this},e.prototype.mover_y_hasta=function(){return this},e.prototype.rotar=function(){return this},e.prototype.rotar_hasta=function(){return this},e.prototype.eliminar=function(){return this},e.prototype.funcion=function(){return this},e.prototype.decir=function(){return this},e.prototype.esperar=function(){return this},e.prototype.escalar_x=function(){return this},e.prototype.escalar_y=function(){return this},e.prototype.escalar=function(){return this},e.prototype.escalar_x_hasta=function(){return this},e.prototype.escalar_y_hasta=function(){return this},e.prototype.escalar_hasta=function(){return this},e.prototype.transparencia_hasta=function(){return this},e.prototype.ocultar=function(){return this},e.prototype.mostrar=function(){return this},e}(AnimacionDePropiedad),Animaciones=function(){function t(t){this.animaciones={},this.pilas=t}return t.prototype.crear_animacion=function(t,e,i){var a=this.crear_frames_de_animacion(e,t)
this.animaciones[t]||this.pilas.modo.anims.remove(t)
var o=this.pilas.modo.anims.create({key:t,frames:a,frameRate:i,repeat:-1})
this.animaciones[t]=o},t.prototype.reemplazar_todas_las_animaciones=function(t){for(var e in this.animaciones)this.pilas.modo.anims.remove(e)
this.animaciones={}
for(var i=0;i<t.length;i++){var a=t[i],o=a.cuadros.map((function(t){return t.nombre}))
this.crear_animacion(a.nombre,o,a.velocidad)}},t.prototype.crear_frames_de_animacion=function(t,e){var i=this
return t.map((function(t){if(-1===i.pilas.imagenes_precargadas.indexOf(t))throw Error('No se puede crear la animación "'+e+'"'+"\n"+("El cuadro "+t+" no existe."))
return t.indexOf(":")>-1?{key:t.split(":")[0],frame:t.split(":")[1]}:{key:t}}))},t.prototype.existe_animacion=function(t){return void 0!==this.animaciones[t]},t}(),Automata=function(){function t(t){this.actor=t,this.pilas=t.pilas,this._estado=""}return Object.defineProperty(t.prototype,"estado",{get:function(){return this._estado},set:function(t){this._estado=t,this.validar_que_existen_los_metodos_de_estado(t),this.iniciar_estado(t),this.actor.cuadro_del_estado=0},enumerable:!1,configurable:!0}),t.prototype.iniciar_estado=function(t){this.actor[t+"_iniciar"]()},t.prototype.actualizar=function(){if(this.actor.cuadro_del_estado+=1,""!==this._estado&&(this.actor[this._estado+"_actualizar"](),this.actor.cuadro_del_estado>0&&this.actor.cuadro_del_estado%60==0)){var t=Math.floor(this.actor.cuadro_del_estado/60)
this.cada_segundo(t)}},t.prototype.cuando_finaliza_animacion=function(t){if(""!==this._estado){var e=this.actor[this._estado+"_cuando_finaliza_animacion"]
e&&e.call(this.actor,t)}},t.prototype.cada_segundo=function(t){if(""!==this._estado){var e=this.actor[this._estado+"_cada_segundo"]
e&&e.call(this.actor,t)}},t.prototype.validar_que_existen_los_metodos_de_estado=function(t){var e=t+"_iniciar",i=t+"_actualizar"
if(!this.actor[e])throw console.log("no hay metodo iniciar"),new Error("Imposible usar el estado '"+t+"', porque no existe un método llamado '"+e+"'")
if(!this.actor[i])throw console.log("no hay metodo actualizar"),new Error("Imposible usar el estado '"+t+"', porque no existe un método llamado '"+i+"'")},t.prototype.cuando_pulsa_tecla=function(t,e){if(""!==this._estado){var i=this.actor[this._estado+"_cuando_pulsa_tecla"]
i&&i.call(this.actor,t,e)}},t.prototype.cuando_hace_click=function(t,e,i){if(""!==this._estado){var a=this.actor[this._estado+"_cuando_hace_click"]
a&&a.call(this.actor,t,e,i)}},t.prototype.cuando_termina_de_hacer_click=function(t,e,i){if(""!==this._estado){var a=this.actor[this._estado+"_cuando_termina_de_hacer_click"]
a&&a.call(this.actor,t,e,i)}},t.prototype.cuando_sale=function(t,e,i){if(""!==this._estado){var a=this.actor[this._estado+"_cuando_sale"]
a&&a.call(this.actor,t,e,i)}},t.prototype.cuando_mueve=function(t,e,i){if(""!==this._estado){var a=this.actor[this._estado+"_cuando_mueve"]
a&&a.call(this.actor,t,e,i)}},t.prototype.cuando_mueve_sobre_la_pantalla=function(t,e,i){if(""!==this._estado){var a=this.actor[this._estado+"_cuando_mueve_sobre_la_pantalla"]
a&&a.call(this.actor,t,e,i)}},t}(),Camara=function(){function t(t){this.pilas=t}return t.prototype.seguir_al_actor=function(t,e,i){if(void 0===e&&(e=10),void 0===i&&(i=!1),t._vivo){var a=t.x-this.pilas.camara.x,o=t.y-this.pilas.camara.y
this.pilas.camara.x+=a/e,this.pilas.camara.y+=o/e,i||(this.pilas.camara.x=Math.max(this.pilas.camara.x,0),this.pilas.camara.x=Math.min(this.pilas.camara.x,this.pilas.escena.ancho-this.pilas.modo.ancho/2),this.pilas.camara.y=Math.min(this.pilas.camara.y,0),this.pilas.camara.y=Math.max(this.pilas.camara.y,-(this.pilas.escena.alto-this.pilas.modo.alto)))}else console.warn("No se moverá la cámara porque el actor "+t.nombre+" ha sido eliminado (llamando a seguir_al_actor)")},Object.defineProperty(t.prototype,"camara_principal",{get:function(){return this.pilas.modo.cameras.main},enumerable:!1,configurable:!0}),t.prototype.vibrar=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1)
var i=this.pilas.actores.actor()
i.imagen="imagenes:basicos/invisible"
var a=this.x,o=this.y
i.actualizar=function(){void 0===this.contador&&(this.contador=0),this.contador+=1,this.contador>60*e?(this.pilas.camara.x=a,this.pilas.camara.y=o,this.eliminar()):(this.pilas.camara.x=a+this.pilas.azar(-1,1)*t,this.pilas.camara.y=o+this.pilas.azar(-1,1)*t)}},Object.defineProperty(t.prototype,"escala",{get:function(){return this.camara_principal.zoom},set:function(t){this.pilas.utilidades.validar_numero(t),t>=1&&t<=10&&this.camara_principal.setZoom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zoom",{get:function(){return this.escala},set:function(t){this.escala=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.camara_principal.scrollX},set:function(t){this.pilas.utilidades.validar_numero(t),this.camara_principal.setScroll(t,-this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return-this.camara_principal.scrollY},set:function(t){this.pilas.utilidades.validar_numero(t),this.camara_principal.setScroll(this.x,-t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borde_izquierdo",{get:function(){return this.x-this.pilas.modo.ancho/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borde_derecho",{get:function(){return this.x+this.pilas.modo.ancho/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borde_arriba",{get:function(){return this.y+this.pilas.modo.alto/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borde_abajo",{get:function(){return this.y-this.pilas.modo.alto/2},enumerable:!1,configurable:!0}),t}(),Colores=function(){function t(t){this.pilas=t,this._lista_de_colores=[{nombre:"rojo",hexa:16711680,ingles:"red"},{nombre:"verde",hexa:65280,ingles:"green"},{nombre:"azul",hexa:255,ingles:"blue"},{nombre:"negro",hexa:0,ingles:"black"},{nombre:"amarillo",hexa:16776960,ingles:"yellow"},{nombre:"rosa",hexa:16761035,ingles:"PINK"},{nombre:"naranja",hexa:16753920,ingles:"orange"},{nombre:"violeta",hexa:15631086,ingles:"violet"},{nombre:"cyan",hexa:65535,ingles:"cyan"},{nombre:"marron",hexa:10824234,ingles:"brown"},{nombre:"blanco",hexa:16777215,ingles:"white"},{nombre:"gris",hexa:8421504,ingles:"gray"}]}return t.prototype.convertir_a_hexa=function(t){return"number"==typeof t?t:(this.validar_color(t),this._lista_de_colores.filter((function(e){return e.nombre==t.toLowerCase()}))[0].hexa)},t.prototype.validar_color=function(t){if(this.colores.indexOf(t)>-1)return!0
throw Error("El color "+t+" es inválido")},Object.defineProperty(t.prototype,"colores",{get:function(){return this._lista_de_colores.map((function(t){return t.nombre}))},enumerable:!1,configurable:!0}),t.prototype.generar=function(t,e,i){return Phaser.Display.Color.GetColor(t,e,i)},t}(),Comportamiento=function(){function t(t,e){this.pilas=t,this.actor=e}return t.prototype.iniciar=function(t){},t.prototype.actualizar=function(){return!1},t.prototype.terminar=function(){},t}(),ComportamientoAparecer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.velocidad=1,e}return __extends(e,t),e.prototype.iniciar=function(t){this.velocidad=t&&t.velocidad||1},e.prototype.actualizar=function(){if(this.actor.transparencia-=this.velocidad,this.actor.transparencia<=0)return!0},e.prototype.terminar=function(){},e}(Comportamiento),ComportamientoDesaparecer=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.velocidad=1,e}return __extends(e,t),e.prototype.iniciar=function(t){this.velocidad=t&&t.velocidad||1},e.prototype.actualizar=function(){if(this.actor.transparencia+=this.velocidad,this.actor.transparencia>=100)return!0},e.prototype.terminar=function(){},e}(Comportamiento),ComportamientoEliminar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){return this.actor.eliminar(),!0},e.prototype.terminar=function(){},e}(Comportamiento),ComportamientoMover=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.demora=1,e.destino_x=0,e.destino_y=0,e}return __extends(e,t),e.prototype.iniciar=function(t){t||(t={}),this.destino_x=t.x||0,this.destino_y=t.y||0,this.demora=t.demora||1
var e=this.destino_x-this.actor.x,i=this.destino_y-this.actor.y
this.dx=e/60/this.demora,this.dy=i/60/this.demora,this.tiempo=0},e.prototype.actualizar=function(){if(this.tiempo+=1,this.actor.x+=this.dx,this.actor.y+=this.dy,this.tiempo>=60*this.demora)return this.actor.x=this.destino_x,this.actor.y=this.destino_y,!0},e.prototype.terminar=function(){},e}(Comportamiento),Comportamientos=function(){function t(t){this.pilas=t,this._comportamientos=[],this.vincular("desaparecer",ComportamientoDesaparecer),this.vincular("aparecer",ComportamientoAparecer),this.vincular("eliminar",ComportamientoEliminar),this.vincular("mover",ComportamientoMover)}return t.prototype.buscar=function(t){var e=this.generar_lista_de_similitudes(t)
return(e=e.sort((function(t,e){return t.similitud>e.similitud?1:-1})))[0].comportamiento.clase},t.prototype.generar_lista_de_similitudes=function(t){var e=this
return this._comportamientos.map((function(i){return{similitud:e.pilas.utilidades.obtener_similaridad(i.nombre,t),comportamiento:i}}))},t.prototype.listar=function(){return this._comportamientos.map((function(t){return t.nombre}))},t.prototype.vincular=function(t,e){var i=this._comportamientos.find((function(e){return e.nombre===t}))
if(!e||!t)throw new Error("Para vincular un comportamiento tiene que especificar nombre y clase, envió nombre="+t+" y clase="+e)
i?console.warn("No se vinculó la clase "+t+" porque ya estaba vinculada con anterioridad."):this._comportamientos.push({nombre:t,clase:e})},t.prototype.validar_si_existe=function(t){var e=this._comportamientos.map((function(t){return t.nombre}))
if(-1===e.indexOf(t)){var i=this.pilas.utilidades.obtener_mas_similar(t,e)
throw new Error('No existe un comportamiento llamado "'+t+'", ¿quisiste decir "'+i+'" o te faltó vincularlo?')}},t}(),GamePad=function(){function t(t,e){this.gamepad=t,this.indice=e,this.umbral=.3}return Object.defineProperty(t.prototype,"control_interno",{get:function(){return this.gamepad.gamepads[this.indice]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analogico_izquierdo_x",{get:function(){return this.obtener_stick("izquierdo").x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analogico_izquierdo_y",{get:function(){return this.obtener_stick("izquierdo").y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analogico_derecho_x",{get:function(){return this.obtener_stick("derecho").x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analogico_derecho_y",{get:function(){return this.obtener_stick("derecho").y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"izquierda",{get:function(){return this.obtener_stick("izquierdo").x<-this.umbral},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"derecha",{get:function(){return this.obtener_stick("izquierdo").x>this.umbral},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arriba",{get:function(){return this.obtener_stick("izquierdo").y>this.umbral},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"abajo",{get:function(){return this.obtener_stick("izquierdo").y<-this.umbral},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boton_x",{get:function(){return this.obtener_boton(3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boton_y",{get:function(){return this.obtener_boton(2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boton_a",{get:function(){return this.obtener_boton(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boton_b",{get:function(){return this.obtener_boton(0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boton_lb",{get:function(){return this.obtener_boton(4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boton_rb",{get:function(){return this.obtener_boton(5)},enumerable:!1,configurable:!0}),t.prototype.obtener_boton=function(t){var e=this.gamepad.gamepads[this.indice]
return!!(e&&t<e.getButtonTotal())&&0!==e.getButtonValue(t)},t.prototype.obtener_stick=function(t){var e=this.gamepad.gamepads[this.indice],i="izquierdo"===t?"leftStick":"rightStick"
if(e&&e[i]){var a=e[i]
return{x:a.x,y:-a.y}}return{x:0,y:0}},t}(),Control=function(){function t(t){this.pilas=t,this.vincular_gamepads(),this.conectar_teclas()}return t.prototype.terminar=function(){},t.prototype.desvincular_gamepad_del_control_principal=function(){},t.prototype.vincular_gamepads=function(){this.pilas.modo.input.gamepad.start(),this.gamepad_1=new GamePad(this.pilas.modo.input.gamepad,0)},t.prototype.obtener_cantidad_de_gamepads_conectados=function(){return this.pilas.modo.input.gamepad.gamepads.length},t.prototype.conectar_teclas=function(){var t=this.pilas.modo.input.keyboard
this.teclas=t.addKeys("LEFT,RIGHT,UP,DOWN,SPACE,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,SEMICOLON"),this._simulaciones={izquierda:!1,derecha:!1,arriba:!1,abajo:!1,espacio:!1}},t.prototype.se_pulsa_tecla=function(t,e){return void 0===e&&(e=void 0),e?this.teclas[t].isDown||this._simulaciones[e]:this.teclas[t].isDown},Object.defineProperty(t.prototype,"arriba",{get:function(){return this.se_pulsa_tecla("UP","arriba")||this.gamepad_1.arriba},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"abajo",{get:function(){return this.se_pulsa_tecla("DOWN","abajo")||this.gamepad_1.abajo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"izquierda",{get:function(){return this.se_pulsa_tecla("LEFT","izquierda")||this.gamepad_1.izquierda},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"derecha",{get:function(){return this.se_pulsa_tecla("RIGHT","derecha")||this.gamepad_1.derecha},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"espacio",{get:function(){return this.se_pulsa_tecla("SPACE","espacio")||this.gamepad_1.boton_x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_a",{get:function(){return this.se_pulsa_tecla("A")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_b",{get:function(){return this.se_pulsa_tecla("B")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_c",{get:function(){return this.se_pulsa_tecla("C")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_d",{get:function(){return this.se_pulsa_tecla("D")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_e",{get:function(){return this.se_pulsa_tecla("E")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_f",{get:function(){return this.se_pulsa_tecla("F")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_g",{get:function(){return this.se_pulsa_tecla("G")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_h",{get:function(){return this.se_pulsa_tecla("H")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_i",{get:function(){return this.se_pulsa_tecla("I")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_j",{get:function(){return this.se_pulsa_tecla("J")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_k",{get:function(){return this.se_pulsa_tecla("K")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_l",{get:function(){return this.se_pulsa_tecla("L")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_m",{get:function(){return this.se_pulsa_tecla("M")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_n",{get:function(){return this.se_pulsa_tecla("N")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_ñ",{get:function(){return this.se_pulsa_tecla("SEMICOLON")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_o",{get:function(){return this.se_pulsa_tecla("O")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_p",{get:function(){return this.se_pulsa_tecla("P")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_q",{get:function(){return this.se_pulsa_tecla("Q")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_r",{get:function(){return this.se_pulsa_tecla("R")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_s",{get:function(){return this.se_pulsa_tecla("S")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_t",{get:function(){return this.se_pulsa_tecla("T")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_u",{get:function(){return this.se_pulsa_tecla("U")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_v",{get:function(){return this.se_pulsa_tecla("V")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_w",{get:function(){return this.se_pulsa_tecla("W")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_x",{get:function(){return this.se_pulsa_tecla("X")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_y",{get:function(){return this.se_pulsa_tecla("Y")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_z",{get:function(){return this.se_pulsa_tecla("Z")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_1",{get:function(){return this.se_pulsa_tecla("1")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_2",{get:function(){return this.se_pulsa_tecla("2")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_3",{get:function(){return this.se_pulsa_tecla("3")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_4",{get:function(){return this.se_pulsa_tecla("4")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_5",{get:function(){return this.se_pulsa_tecla("5")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_6",{get:function(){return this.se_pulsa_tecla("6")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_7",{get:function(){return this.se_pulsa_tecla("7")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_8",{get:function(){return this.se_pulsa_tecla("8")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tecla_9",{get:function(){return this.se_pulsa_tecla("9")},enumerable:!1,configurable:!0}),t.prototype.simular_pulsacion=function(t,e){if(void 0===this._simulaciones[t])throw Error("No se puede simular la tecla "+t)
this._simulaciones[t]=e},t}(),Depurador=function(){function t(t){this.pilas=t,this.modo_posicion_activado=!1,this.mostrar_fps=!1,this.mostrar_fisica=!1,this.fisica_en_modo_ejecucion=!1}return t.prototype.definir_estados_de_depuracion=function(t){this.mostrar_fps=t.fps,this.modo_posicion_activado=t.pos,this.mostrar_fisica=t.fisica,this.minimapa=t.minimapa,this.fisica_en_modo_ejecucion=t.fisica_en_modo_ejecucion},t}(),Escenas=function(){function t(t){this.escena_actual=null,this.pilas=t}return t.prototype.Normal=function(){return new Normal(this.pilas)},t.prototype.vincular=function(t){var e=this
this[t.name]=function(){return e.escena_actual=new t(e.pilas),e.escena_actual}},t.prototype.definir_escena_actual=function(t){this.escena_actual=t},t}(),Eventos=function(){function t(t){this.pilas=t}return t.prototype.conectar=function(t,e){return this.pilas.escena.eventos.conectar(t,e)},t.prototype.desconectar=function(t){return this.pilas.escena.eventos.desconectar(t)},t.prototype.emitir_evento=function(t,e){return this.pilas.escena.eventos.emitir_evento(t,e)},t}(),EventosDeEscena=function(){function t(t){this.pilas=t,this.conexiones=[],this.nombres_de_eventos=["mueve_mouse","click_de_mouse","termina_click"]}return t.prototype.conectar=function(t,e){if(-1===this.nombres_de_eventos.indexOf(t))return console.warn("No se puede conectar el evento "+t),void console.warn("Los eventos que existen son",this.nombres_de_eventos)
var i=this.generar_id(t)
return this.conexiones.push({id:i,nombre_del_evento:t,funcion:e}),i},t.prototype.desconectar=function(t){var e=this.conexiones.findIndex((function(e){return e.id===t}))
e>-1?this.conexiones.splice(e,1):console.warn("No se encontró en evento "+t)},t.prototype.generar_id=function(t){return"evento_conectado:"+t+":"+this.pilas.utilidades.obtener_id_autoincremental()},t.prototype.emitir_evento=function(t,e){this.conexiones.map((function(i){i.nombre_del_evento===t&&i.funcion(e)}))},t}(),Fisica=function(){function t(t){this.pilas=t}return Object.defineProperty(t.prototype,"Matter",{get:function(){return Phaser.Physics.Matter.Matter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gravedad_x",{get:function(){return this.pilas.escena.gravedad_x},set:function(t){this.pilas.escena.gravedad_x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gravedad_y",{get:function(){return this.pilas.escena.gravedad_y},set:function(t){this.pilas.escena.gravedad_y=t},enumerable:!1,configurable:!0}),t}(),Habilidad=function(){function t(t,e){this.pilas=t,this.actor=e}return t.prototype.iniciar=function(){},t.prototype.actualizar=function(){},t.prototype.eliminar=function(){},t}(),RotarConstantemente=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){this.actor.rotacion+=10},e}(Habilidad),Arrastrable=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.valor_inicial_dinamico=null,e}return __extends(e,t),e.prototype.iniciar=function(){var t=this.pilas.modo.input
this.actor.sprite.setInteractive(),t.setDraggable(this.actor.sprite),t.on("dragstart",this.cuando_comienza_a_arrastrar,this),t.on("drag",this.cuando_mueve,this),t.on("dragend",this.cuando_suelta,this)},e.prototype.actualizar=function(){},e.prototype.eliminar=function(){var t=this.pilas.modo.input
t.setDraggable(this.actor.sprite,!1),t.off("dragstart",this.cuando_comienza_a_arrastrar,this),t.off("drag",this.cuando_mueve,this),t.off("dragend",this.cuando_suelta,this)},e.prototype.cuando_comienza_a_arrastrar=function(t,e){this.actor===e.actor&&this.actor.figura&&(this.valor_inicial_dinamico=e.actor.dinamico,e.actor.dinamico=!1)},e.prototype.cuando_mueve=function(t,e,i,a){e.x=i,e.y=a},e.prototype.cuando_suelta=function(t,e){this.actor===e.actor&&this.actor.figura&&(e.actor.dinamico=this.valor_inicial_dinamico)},e}(Habilidad),MoverConElTeclado=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){this.pilas.control.izquierda&&(this.actor.x-=5),this.pilas.control.derecha&&(this.actor.x+=5),this.pilas.control.arriba&&(this.actor.y+=5),this.pilas.control.abajo&&(this.actor.y-=5)},e}(Habilidad),SeguirAlMouse=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){this.actor.x=this.pilas.cursor_x,this.actor.y=this.pilas.cursor_y},e}(Habilidad),SeguirAlMouseLentamente=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){var t=this.pilas.cursor_x,e=this.pilas.cursor_y
this.actor.x+=(t-this.actor.x)/10,this.actor.y+=(e-this.actor.y)/10},e}(Habilidad),OscilarVerticalmente=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.contador=0,e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){this.contador++,this.actor.y+=Math.sin(this.contador/20)/4},e}(Habilidad),OscilarRotacion=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.contador=0,e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){this.contador++,this.actor.rotacion+=Math.cos(this.contador/20)/2},e}(Habilidad),OscilarTransparencia=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.contador=0,e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){this.contador++,this.actor.transparencia=50+50*Math.cos(this.contador/10)},e}(Habilidad),Habilidades=function(){function t(t){this.pilas=t,this._habilidades=[],this.vincular("rotar constantemente",RotarConstantemente),this.vincular("arrastrable",Arrastrable),this.vincular("mover con el teclado",MoverConElTeclado),this.vincular("seguir al mouse",SeguirAlMouse),this.vincular("seguir al mouse lentamente",SeguirAlMouseLentamente),this.vincular("oscilar verticalmente",OscilarVerticalmente),this.vincular("oscilar rotacion",OscilarRotacion),this.vincular("oscilar transparencia",OscilarTransparencia)}return t.prototype.buscar=function(t){var e=this.generar_lista_de_similitudes(t)
return(e=e.sort((function(t,e){return t.similitud>e.similitud?1:-1})))[0].habilidad.clase},t.prototype.generar_lista_de_similitudes=function(t){var e=this
return this._habilidades.map((function(i){return{similitud:e.pilas.utilidades.obtener_similaridad(i.nombre,t),habilidad:i}}))},t.prototype.listar=function(){return this._habilidades.map((function(t){return t.nombre}))},t.prototype.vincular=function(t,e){var i=this._habilidades.find((function(e){return e.nombre===t}))
i?i.clase=e:this._habilidades.push({nombre:t,clase:e})},t}(),Historia=function(){function t(t){this.pilas=t,this.fotos=[]}return t.prototype.limpiar=function(){this.fotos=[]},t.prototype.serializar_escena=function(t,e,i){this.fotos.push({escena:t.serializar(),actores:t.actores.filter((function(t){return t.esta_vivo()})).map((function(t){return t.serializar()})),instrumentacion:e,instrumentacion_de_bloques:i})},t.prototype.dibujar_puntos_de_las_posiciones_recorridas=function(t,e){for(var i=this,a=this.fotos.slice(-840),o=a.length,r=0;r<o;r++){a[r].actores.map((function(a){if(!e||e.nombre===a.nombre){var o=i.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(a.x,a.y),r=o.x,n=o.y
t.fillStyle(a.id_color,1),t.fillRect(r,n,2,2)}}))}},t.prototype.obtener_cantidad_de_posiciones=function(){return this.fotos.length-1},t.prototype.obtener_foto=function(t){return this.fotos[t]},t}(),Huesos=function(){function t(t,e,i,a){this.sprites={},this.prefijo_de_imagenes="",this.contenedor=a,this.atlas=i,this.pilas=t
var o=this.pilas.game.cache.json.get(e),r=(new Data).load(o),n=new Pose(r),s=Object.keys(n.getEntities())[0]
n.setEntity(s),this.pose=n,this.definir_animacion(this.obtener_primer_animacion())}return t.prototype.obtener_animaciones=function(){return Object.keys(this.pose.getAnims())},t.prototype.obtener_primer_animacion=function(){return this.obtener_animaciones()[0]},t.prototype.definir_animacion=function(t){t!=this.animacion_actual&&(this.eliminar_sprites(),this.animacion_actual=t,this.pose.setAnim(t),this.pose.update(0),this.pose.setTime(0),this.pose.strike(),this.actualizar_posicion(this.pose))},t.prototype.obtener_siguiente_animacion=function(){var t=this.animacion_actual,e=this.obtener_animaciones(),i=e.indexOf(t)
return(i+=1)>=e.length&&(i=0),e[i]},t.prototype.actualizar_animacion=function(t){this.pose.update(t),this.pose.strike(),this.actualizar_posicion(this.pose)},t.prototype.obtener_o_crear_sprite=function(t,e){if(this.sprites[t])return this.sprites[t]
var i=null
return i=this.atlas?this.pilas.modo.add.sprite(0,0,this.atlas,e):this.pilas.modo.add.sprite(0,0,e),this.sprites[t]=i,i},t.prototype.actualizar_posicion=function(t){var e=this
t.object_array.map((function(i){var a=t.data.folder_array[i.folder_index].file_array[i.file_index].name,o=e.obtener_o_crear_sprite(i.name,e.prefijo_de_imagenes+a)
e.prefijo_de_imagenes&&o.setTexture(e.prefijo_de_imagenes+a),o.setAlpha(i.alpha),o.x=i.world_space.position.x,o.y=-i.world_space.position.y,o.setScale(i.world_space.scale.x,i.world_space.scale.y),o.setDepth(i.world_space.z_index),o.setRotation(-i.world_space.rotation.rad),e.contenedor.add(o)}))},t.prototype.eliminar_sprites=function(){for(var t=Object.keys(this.sprites),e=0;e<t.length;e++){var i=this.sprites[t[e]]
this.contenedor.remove(i),i.destroy()}this.sprites={}},t}(),Laser=function(){function t(t,e,i,a){this.actor=t,this.nombre=e,this.rotacion=i,this.longitud=a}return t.prototype.obtener_colisiones=function(){var t=this.actor.pilas,e=t.utilidades.convertir_angulo_a_radianes(this.rotacion),i=this.actor.x,a=this.actor.y,o=i+Math.cos(e)*this.longitud,r=a+Math.sin(e)*this.longitud
return t.laser(this.actor,i,a,o,r)},t.prototype.distancia_al_actor_mas_cercado=function(){var t=this.obtener_colisiones()
return t.length>0?t[0].distancia:this.longitud},t.prototype.distancia_al_actor_con_etiqueta=function(t){var e=this.obtener_colisiones()
return(e=e.filter((function(e){return e.actor.tiene_etiqueta(t)}))).length>0?e[0].distancia:this.longitud},t.prototype.colisiona_con_un_actor_de_etiqueta=function(t){var e=this.obtener_colisiones()
return(e=e.filter((function(e){return e.actor.tiene_etiqueta(t)}))).length>0},t.prototype.obtener_actor_mas_cercano=function(){var t=this.obtener_colisiones()
return t.length>0?t[0].actor:null},t}()
function raycast(t,e,i,a){void 0===a&&(a=!0),e=vec2.fromOther(e),i=vec2.fromOther(i)
for(var o=Phaser.Physics.Matter.Matter.Query.ray(t,e,i),r=[],n=new ray(e,i),s=o.length-1;s>=0;s--)for(var c=ray.bodyCollisions(n,o[s].body),l=c.length-1;l>=0;l--)r.push(c[l])
return a&&r.sort((function(t,i){return t.point.distance(e)-i.point.distance(e)})),r}var raycol=function(t,e,i,a){this.body=t,this.point=e,this.normal=i,this.verts=a},ray=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.yValueAt=function(t){return this.offsetY+this.slope*t},t.prototype.xValueAt=function(t){return(t-this.offsetY)/this.slope},t.prototype.pointInBounds=function(t){var e=Math.min(this.start.x,this.end.x),i=Math.max(this.start.x,this.end.x),a=Math.min(this.start.y,this.end.y),o=Math.max(this.start.y,this.end.y)
return t.x>=e&&t.x<=i&&t.y>=a&&t.y<=o},t.prototype.calculateNormal=function(t){var e=this.difference,i=e.normalized().rotate(Math.PI/2),a=e.normalized().rotate(Math.PI/-2)
return this.start.plus(i).distance(t)<this.start.plus(a).distance(t)?i:a},Object.defineProperty(t.prototype,"difference",{get:function(){return this.end.minus(this.start)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"slope",{get:function(){var t=this.difference
return t.y/t.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this.start.y-this.slope*this.start.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHorizontal",{get:function(){return compareNum(this.start.y,this.end.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVertical",{get:function(){return compareNum(this.start.x,this.end.x)},enumerable:!1,configurable:!0}),t.intersect=function(t,e){if(t.isVertical&&e.isVertical)return null
if(t.isVertical)return new vec2(t.start.x,e.yValueAt(t.start.x))
if(e.isVertical)return new vec2(e.start.x,t.yValueAt(e.start.x))
if(compareNum(t.slope,e.slope))return null
if(t.isHorizontal)return new vec2(e.xValueAt(t.start.y),t.start.y)
if(e.isHorizontal)return new vec2(t.xValueAt(e.start.y),e.start.y)
var i=(e.offsetY-t.offsetY)/(t.slope-e.slope)
return new vec2(i,t.yValueAt(i))},t.collisionPoint=function(e,i){var a=t.intersect(e,i)
return a&&e.pointInBounds(a)&&i.pointInBounds(a)?a:null},t.bodyEdges=function(e){for(var i=[],a=e.parts.length-1;a>=0;a--)for(var o=e.parts[a].vertices.length-1;o>=0;o--){var r=o+1
r>=e.parts[a].vertices.length&&(r=0)
var n=new t(vec2.fromOther(e.parts[a].vertices[o]),vec2.fromOther(e.parts[a].vertices[r]))
n.verts=[e.parts[a].vertices[o],e.parts[a].vertices[r]],i.push(n)}return i},t.bodyCollisions=function(e,i){for(var a=[],o=t.bodyEdges(i),r=o.length-1;r>=0;r--){var n=t.collisionPoint(e,o[r])
if(n){var s=o[r].calculateNormal(e.start)
a.push(new raycol(i,n,s,o[r].verts))}}return a},t}()
function compareNum(t,e,i){return void 0===i&&(i=1e-5),Math.abs(e-t)<=i}var vec2=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e}return t.prototype.normalized=function(t){return void 0===t&&(t=1),this.multiply(t/this.distance())},Object.defineProperty(t.prototype,"inverted",{get:function(){return this.multiply(-1)},enumerable:!1,configurable:!0}),t.prototype.multiply=function(e){return new t(this.x*e,this.y*e)},t.prototype.plus=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.minus=function(t){return this.plus(t.inverted)},t.prototype.rotate=function(e){var i=this.direction,a=this.distance()
return i+=e,t.fromAng(i,a)},t.prototype.toPhysVector=function(){return Phaser.Physics.Matter.Matter.Vector.create(this.x,this.y)},Object.defineProperty(t.prototype,"direction",{get:function(){return Math.atan2(this.y,this.x)},enumerable:!1,configurable:!0}),t.prototype.distance=function(e){return void 0===e&&(e=new t),Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},t.prototype.clone=function(){return new t(this.x,this.y)},t.fromAng=function(e,i){return void 0===i&&(i=1),new t(Math.cos(e)*i,Math.sin(e)*i)},t.fromOther=function(e){return new t(e.x,e.y)},t.prototype.toString=function(){return"vector<"+this.x+", "+this.y+">"},t}(),DEPURAR_MENSAJES=!1,DEPURAR_MENSAJES_DE_CARGA=!1,Mensajes=function(){function t(t){this.pilas=t,this.agregar_manejador_de_eventos()}return t.prototype.agregar_manejador_de_eventos=function(){window.addEventListener("message",this.atender_mensaje.bind(this),!1)},t.prototype.atender_mensaje=function(t){var e=t.data.tipo,i=t.data.nombre_del_contexto,a="atender_mensaje_"+e,o=t.data
if(e){if(!i){if("codigo_ejecutado"===e||"termina_de_reproducir_sonido"===e)return
throw new Error("No llegó el nombre de contexto con el mensaje "+e)}DEPURAR_MENSAJES&&console.log("[editor → pilas] [contexto: "+i+"] llega el mensaje: "+e),this[a]?this[a](o):"atender_mensaje_cambiar_prefijo_de_variante"!==a&&"atender_mensaje_cambiar_animacion"!==a&&console.error("Imposible llamar al evento "+a,o)}},t.prototype.atender_mensaje_capturar_pantalla=function(t){var e=this
pilasengine.game.renderer.snapshot((function(t){e.emitir_mensaje_al_editor("captura_de_pantalla_realizada",{data:t.src})}))},t.prototype.atender_mensaje_cambiar_zoom=function(t){this.pilas.modo.cameras.main.setZoom(t.zoom)},t.prototype.atender_mensaje_iniciar_pilas=function(t){this.pilas.nombre_del_contexto=t.nombre_del_contexto||"sin_nombre_de_contexto",t.recursos.sonidos=t.sonidos,this.pilas.iniciar_phaser(t.ancho,t.alto,t.recursos,t.opciones,t.imagenes)},t.prototype.atender_mensaje_definir_estados_de_depuracion=function(t){this.pilas.depurador.definir_estados_de_depuracion(t)},t.prototype.emitir_mensaje_al_editor=function(t,e){void 0===e&&(e=null),e=e||{}
var i=this.pilas.nombre_del_contexto
e.tipo=t,e.nombre_del_contexto=i,"progreso_de_carga"===t?DEPURAR_MENSAJES_DE_CARGA&&console.log("[pilas → editor] [contexto: "+i+"] Emitiendo el mensaje de carga: "+t):DEPURAR_MENSAJES&&console.log("[pilas → editor] [contexto: "+i+"] Emitiendo el mensaje: "+t),window.parent.postMessage(e,HOST)},t.prototype.atender_mensaje_define_escena=function(t){this.pilas.definir_modo("ModoEditor",{pilas:this.pilas,escena:t.escena,proyecto:t.proyecto})},t.prototype.atender_mensaje_definir_zoom_inicial_para_el_modo_editor=function(t){this.pilas.modo.cameras.main.setZoom(t.zoom)},t.prototype.atender_mensaje_cuando_cambia_zoom_desde_el_selector_manual=function(t){this.pilas.modo.cameras.main.setZoom(t.zoom)},t.prototype.atender_mensaje_cuando_cambia_grilla_desde_el_selector_manual=function(t){this.pilas.modo.cuando_cambia_grilla_desde_el_selector_manual(t.grilla)},t.prototype.atender_mensaje_actualizar_escena_desde_el_editor=function(t){this.pilas.modo.cambiar_fondo(t.escena.fondo),this.pilas.modo.posicionar_la_camara(t.escena)},t.prototype.atender_mensaje_termina_de_reproducir_sonido=function(){},t.prototype.atender_mensaje_ubicar_camara_en_el_actor=function(t){var e=this,i=this.pilas.modo.obtener_actor_por_id(t.actor_id),a=this.pilas.modo.cameras.cameras[0]
a.pan(i.x,i.y,250,"Sine.easeInOut"),setTimeout((function(){var t=a.scrollX,i=-a.scrollY
e.emitir_mensaje_al_editor("mientras_mueve_la_camara",{x:t,y:i}),e.pilas.modo.posicionar_la_camara({camara_x:t,camara_y:i})}),260)},t.prototype.atender_mensaje_ejecutar_proyecto=function(t){var e={pilas:this.pilas,nombre_de_la_escena_inicial:t.nombre_de_la_escena_inicial,permitir_modo_pausa:t.permitir_modo_pausa,codigo:t.codigo,proyecto:t.proyecto,es_cambio_de_escena:!1}
this.pilas.definir_modo("ModoEjecucion",e)},t.prototype.emitir_excepcion_al_editor=function(t,e){var i=t.stack.replace(/\(.*\)/g,"").replace(/ {2}at /g," - "),a={pilas:this.pilas,error:t,stacktrace:i,origen:e}
this.pilas.modo.con_error=!0,this.pilas.definir_modo("ModoError",a),this.emitir_mensaje_al_editor("error_de_ejecucion",{mensaje:t.message,stack:i})},t.prototype.atender_mensaje_selecciona_actor_desde_el_editor=function(t){this.pilas.modo.destacar_actor_por_id(t.id)},t.prototype.atender_mensaje_actualizar_actor_desde_el_editor=function(t){var e=this.pilas.modo.obtener_actor_por_id(t.id)
this.pilas.modo.actualizar_sprite_desde_datos(e,t.actor)},t.prototype.atender_mensaje_pausar_escena=function(){var t={pilas:this.pilas}
this.pilas.definir_modo("ModoPausa",t)},t.prototype.atender_mensaje_cambiar_posicion=function(t){this.pilas.modo.actualizar_posicion(t.posicion)},t.prototype.atender_mensaje_eliminar_actor_desde_el_editor=function(t){this.pilas.modo.eliminar_actor_por_id(t.id)},t.prototype.atender_mensaje_selecciona_un_actor_en_modo_pausa=function(t){this.pilas.modo.selecciona_actor_o_escena_en_modo_pausa(t.actor)},t}(),Utilidades=function(){function t(t){this.pilas=t,this.id=1,this.navegador=navigator.appCodeName}return t.prototype.obtener_id_autoincremental=function(){return this.id=this.id+1,this.id},t.prototype.acceso_incorrecto=function(t){console.error("No se puede definir esta propiedad (valor "+t+") porque es de solo lectura.")},t.prototype.obtener_rampa_de_colores=function(){return[8577194,16303217,15774330,16054007,11713211,8765929,12292046,15832202,14256256]},t.prototype.obtener_color_al_azar=function(){var t=this.obtener_rampa_de_colores(),e=t.length
return t[Math.floor(Math.random()*e)]},t.prototype.limitar=function(t,e,i){return Math.min(Math.max(t,e),i)},t.prototype.validar_numero=function(t){if("number"!=typeof t)throw new Error("El valor enviado no corresponde con un número: "+t)},t.prototype.validar_que_este_vivo=function(t){if(!t||!t.esta_vivo())throw new Error('El actor "'+t.nombre+'" ha sido eliminado, usá el método esta_vivo() del actor antes de acceder a el.')},t.prototype.es_animacion=function(t){return Array.isArray(t)&&t.every((function(t){return"number"==typeof t}))},t.prototype.validar_parametro_numero_positivo=function(t,e){if("number"!=typeof e||e<0)throw new Error('El valor enviado como parámetro "'+t+'" tiene que ser un número mayor a 0, se envió: '+e)},t.prototype.validar_parametro_booleano=function(t,e){if("boolean"!=typeof e)throw new Error('El valor enviado como parámetro "'+t+'" tiene que ser true o false, se envió: '+e)},t.prototype.validar_parametro_lista_de_numeros_pares=function(t,e){if(!Array.isArray(e))throw new Error('El valor enviado como parámetro "'+t+'" tiene que ser una lista de números, se envió: '+e)
if(e.length%2!=0)throw new Error('El valor enviado como parámetro "'+t+'" tiene que tener una cantidad par de números, se contaron '+e.length+" números en la lista enviada.")},t.prototype.validar_parametro_numero_entero_cero_o_positivo=function(t,e){if("number"!=typeof e||e!==parseInt(""+e,10)||e<0)throw new Error('El valor enviado como parámetro "'+t+'" tiene que ser un número entero mayor o igual a 0, se envió: '+e)},t.prototype.convertir_angulo_a_radianes=function(t){return t*Math.PI/180},t.prototype.convertir_radianes_a_angulos=function(t){return 180*t/Math.PI},t.prototype.es_firefox=function(){return/Firefox/.test(navigator.userAgent)},t.prototype.convertir_coordenada_de_pilas_a_phaser=function(t,e){return{x:t+this.pilas._ancho/2,y:this.pilas._alto/2-e}},t.prototype.convertir_coordenada_de_phaser_a_pilas=function(t,e){return{x:t-this.pilas._ancho/2,y:-e+this.pilas._alto/2}},t.prototype.combinar_propiedades=function(t,e){return function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])
return t}(JSON.parse(JSON.stringify(t)),e)},t.prototype.obtener_distancia_entre=function(t,e,i,a){return Math.sqrt(Math.pow(Math.abs(t-i),2)+Math.pow(Math.abs(e-a),2))},t.prototype.obtener_similaridad=function(t,e){return function(t,e){if(0==t.length)return e.length
if(0==e.length)return t.length
var i,a,o=[]
for(i=0;i<=e.length;i++)o[i]=[i]
for(a=0;a<=t.length;a++)o[0][a]=a
for(i=1;i<=e.length;i++)for(a=1;a<=t.length;a++)e.charAt(i-1)==t.charAt(a-1)?o[i][a]=o[i-1][a-1]:o[i][a]=Math.min(o[i-1][a-1]+1,Math.min(o[i][a-1]+1,o[i-1][a]+1))
return o[e.length][t.length]}(t,e)},t.prototype.obtener_mas_similar=function(t,e){var i=this,a=e.map((function(e){return{similitud:i.obtener_similaridad(e,t),posiblidad:e}}))
return(a=a.sort((function(t,e){return t.similitud>e.similitud?1:-1})))[0].posiblidad},t.prototype.validar_que_existe_imagen=function(t){if(-1===this.pilas.imagenes_precargadas.indexOf(t)){if(0===this.pilas.imagenes_precargadas.length)throw Error('No se encuentra la imagen "'+t+'" y parece que no se cargó ninguna imagen')
var e=this.pilas.utilidades.obtener_mas_similar(t,this.pilas.imagenes_precargadas)
throw Error('No se encuentra la imagen "'+t+'"\n¿Quisiste decir "'+e+'"?')}},t.prototype.sincronizar_contenedor=function(t,e){t.x=e.x,t.y=e.y,e.flipX?t.scaleX=-e.scaleX:t.scaleX=e.scaleX,e.flipY?t.scaleY=-e.scaleY:t.scaleY=e.scaleY,t.angle=e.angle,t.alpha=e.alpha,t.setDepth(e.depth)},t.prototype.obtener_nombre_de_la_tecla_desde_un_evento=function(t){var e=t.key
e||(e=e.code)
var i={" ":"espacio",ArrowLeft:"izquierda",ArrowRight:"derecha",ArrowUp:"arriba",ArrowDown:"abajo",Alt:"alt",Control:"control",Shift:"shift",Tab:"tab",Backspace:"backspace",Meta:"meta",Escape:"escape",Enter:"enter"}
return i[e]?i[e]:e},t}(),Sonidos=function(){function t(t){this.pilas=t,this._sonidos=[]}return t.prototype.agregar_sonido=function(t){this._sonidos.push(t)},t.prototype.existe_sonido=function(t){return this._sonidos.indexOf(t)>-1},t.prototype.obtener_sonido_con_nombre_similar=function(t){return this.pilas.utilidades.obtener_mas_similar(t,this._sonidos)},t.prototype.hay_sonidos_cargados=function(){return this._sonidos.length>0},t}(),HOST="file://"
window.location.host&&(HOST=window.location.origin)
var Pilas=function(){function t(){this.cursor_x=0,this.cursor_y=0,this.cursor_x_absoluta=0,this.cursor_y_absoluta=0,this.imagenes_precargadas=[],this.imagenes=[],this.Phaser=Phaser,this.mensajes=new Mensajes(this),this.colores=new Colores(this),this.depurador=new Depurador(this),this.utilidades=new Utilidades(this),this.escenas=new Escenas(this),this.historia=new Historia(this),this.sonidos=new Sonidos(this),this.actores=new Actores(this),this.animaciones=new Animaciones(this),this.fisica=new Fisica(this),this.habilidades=new Habilidades(this),this.comportamientos=new Comportamientos(this),this.eventos=new Eventos(this)}return t.prototype.crear_animacion=function(t,e,i,a){return this.escena.crear_animacion(t,e,i,a)},Object.defineProperty(t.prototype,"escena",{get:function(){return this.escenas.escena_actual},set:function(t){this.utilidades.acceso_incorrecto("escena")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"control",{get:function(){return this.escena.control},set:function(t){this.utilidades.acceso_incorrecto("control")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camara",{get:function(){return this.escena.camara},enumerable:!1,configurable:!0}),t.prototype.iniciar_phaser=function(t,e,i,a,o){var r=this
if(void 0===a.maximizar&&(a.maximizar=!0),this.opciones=a,this.imagenes=o,!i)throw Error("No se puede iniciar phaser sin especificar una lista de recursos")
this._ancho=t,this._alto=e,this.recursos=i
var n=this.crear_configuracion(t,e,a.maximizar,a.pixelart,a.transparente)
a.modo_simple&&(n.modo_simple=a.modo_simple),30===a.fps&&(n.fps={target:a.fps,forceSetTimeOut:!0}),a.esperar_antes_de_iniciar?(console.log("Esperando 1 segundo antes de iniciar ..."),setTimeout((function(){r.iniciar_phaser_desde_configuracion_y_cargar_escenas(n)}),1e3)):this.iniciar_phaser_desde_configuracion_y_cargar_escenas(n)},t.prototype.iniciar=function(t,e,i,a,o,r){return void 0===a&&(a={}),void 0===o&&(o=[]),void 0===r&&(r=!1),void 0===a&&(a={}),null==i&&(i={imagenes:[],sonidos:[{nombre:"explosion",ruta:"sonidos/explosion.mp3"},{nombre:"gallina",ruta:"sonidos/gallina.mp3"},{nombre:"laser",ruta:"sonidos/laser.mp3"},{nombre:"moneda",ruta:"sonidos/moneda.mp3"},{nombre:"salto-corto",ruta:"sonidos/salto-corto.mp3"},{nombre:"salto-largo",ruta:"sonidos/salto-largo.mp3"},{nombre:"seleccion-aguda",ruta:"sonidos/seleccion-aguda.mp3"},{nombre:"seleccion-grave",ruta:"sonidos/seleccion-grave.mp3"}]}),a.modo_simple=!0,a.omitir_imagenes_de_pilas=r,this.iniciar_phaser(t,e,i,a,o),this},t.prototype.listar_imagenes=function(){return this.imagenes_precargadas},t.prototype.iniciar_phaser_desde_configuracion_y_cargar_escenas=function(t){var e=new Phaser.Game(t)
e.scene.add("ModoCargador",ModoCargador),e.scene.add("ModoEditor",ModoEditor),e.scene.add("ModoEjecucion",ModoEjecucion),e.scene.add("ModoEjecucionEnPausa",ModoEjecucionEnPausa),e.scene.add("ModoPausa",ModoPausa),e.scene.add("ModoError",ModoError),e.scene.start("ModoCargador",{pilas:this}),this.game=e},t.prototype.ejecutar=function(){console.warn("La función pilas.ejecutar() entró en desuso, no hace falta invocarla.")},t.prototype.definir_modo=function(t,e){try{this.game.scene.stop("ModoCargador"),this.game.scene.stop("ModoEjecucion"),this.game.scene.stop("ModoEditor"),this.game.scene.stop("ModoPausa"),this.game.scene.stop("ModoError")}catch(i){console.warn(i)}"ModoEjecucion"!==t&&(this.game.sound.stopAll(),this.musica_en_reproduccion=null,this.comportamientos=new Comportamientos(this),this.habilidades=new Habilidades(this)),this.modo=this.game.scene.getScene(t),this.definir_cursor("default"),this.game.scene.start(t,e)},t.prototype.cambiar_escena=function(t){this.modo.cambiar_escena(t)},t.prototype.reiniciar_escena=function(){this.modo.cambiar_escena(this.escena.constructor.name)},t.prototype.crear_configuracion=function(t,e,i,a,o){var r=void 0,n="#000000"
return i&&(r={mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}),void 0===a&&(a=!0),void 0===o&&(o=!1),o&&(n="rgba(0,0,0,0)"),{type:Phaser.AUTO,parent:"game",scale:r,width:t,height:e,backgroundColor:n,disableContextMenu:!0,pixelArt:a,autostart:!1,transparent:o,fps:{},input:{keyboard:!0,mouse:!0,touch:!0,activePointers:6,gamepad:!0},plugins:{global:[NineSlice.Plugin.DefaultCfg]},physics:{default:"matter",debug:!1}}},t.prototype.reproducir_sonido=function(t){if(!this.sonidos.existe_sonido(t)){if(this.sonidos.hay_sonidos_cargados()){var e=this.sonidos.obtener_sonido_con_nombre_similar(t)
throw new Error('No existe un sonido llamado "'+t+'", ¿quisiste decir "'+e+'"?')}throw new Error('No se puede reproducir el sonido "'+t+'" porque no hay ningún sonido en el proyecto.')}this.escena.planificar_reproducir_sonido(t)},t.prototype.reproducir_musica=function(t){if(this.musica_en_reproduccion&&this.detener_musica(),this.sonidos.existe_sonido(t)){var e=this.modo.sound.add(t,{loop:!0})
return e.play(),this.musica_en_reproduccion=e,e}if(this.sonidos.hay_sonidos_cargados()){var i=this.sonidos.obtener_sonido_con_nombre_similar(t)
throw new Error('No existe una música llamada "'+t+'", ¿quisiste decir "'+i+'"?')}throw new Error('No se puede la música "'+t+'" porque no hay ningún sonido o música en el proyecto.')},t.prototype.detener_musica=function(){this.musica_en_reproduccion&&(this.musica_en_reproduccion.stop(),this.musica_en_reproduccion=null)},t.prototype.esta_reproduciendo_musica=function(){return null!==this.musica_en_reproduccion},t.prototype.obtener_actores=function(){return this.escena.actores.filter((function(t){return t._vivo}))},t.prototype.buscar_actor=function(t){return this.obtener_actor_por_nombre(t)},t.prototype.obtener_actor_por_nombre=function(t){var e=this.obtener_actores().find((function(e){return e.nombre===t}))
if(void 0===e)throw Error("No se puede obtener un actor con el nombre '"+t+"', ¿Tal vez se eliminó?")
return e},t.prototype.existe_un_actor_llamado=function(t){return void 0!==this.obtener_actores().find((function(e){return e.nombre===t}))},t.prototype.existe_un_actor_llamado_en_el_proyecto=function(t){return this.modo.existe_actor_llamado_en_el_proyecto(t)},t.prototype.obtener_actor_por_etiqueta=function(t){return this.obtener_actores().find((function(e){return e.tiene_etiqueta(t)}))},t.prototype.obtener_todos_los_actores_con_la_etiqueta=function(t){return this.obtener_actores().filter((function(e){if(e._vivo)return e.tiene_etiqueta(t)}))},t.prototype.obtener_cantidad_de_actores=function(){return this.obtener_actores().length},t.prototype.obtener_diccionario_de_actores=function(){var t={}
return this.obtener_actores().map((function(e){t[e.nombre]=e})),t},t.prototype.obtener_actores_en=function(t,e){var i=this.utilidades.convertir_coordenada_de_pilas_a_phaser(t,e),a=i.x,o=i.y
return this.obtener_actores().filter((function(t){return t.sprite.getBounds().contains(a,o)}))},t.prototype.obtener_actor_en=function(t,e){var i=this.obtener_actores_en(t,e)
return i.length>0?i[0]:null},t.prototype.existe_actor_en=function(t,e){return this.obtener_actores_en(t,e).length>0},t.prototype.existe_actor_con_etiqueta_en=function(t,e,i){return this.obtener_actores_en(e,i).filter((function(e){return e.tiene_etiqueta(t)})).length>0},t.prototype.escena_actual=function(){return this.escena},t.prototype.animar=function(t,e,i,a){void 0===a&&(a=.5)
var o={targets:t,ease:"Power1",duration:1e3*a}
o[e]=i[0],this.modo.tweens.add(o)},t.prototype.luego=function(t,e){var i=this
return this.modo.time.delayedCall(1e3*t,(function(){try{e()}catch(t){i.mensajes.emitir_excepcion_al_editor(t,"Al ejecutar la tarea 'luego'")}}))},t.prototype.cada=function(t,e,i){var a=this,o=0,r=this.modo.time.addEvent({delay:1e3*t,callback:function(){try{e()&&r.remove(),o+=1,i&&o>=i&&r.remove()}catch(t){a.mensajes.emitir_excepcion_al_editor(t,"Al ejecutar la tarea 'cada'")}},loop:!0})
return r},t.prototype.azar=function(t,e){if(t>e)throw Error("Rango inválido, el número desde ("+t+" en este caso) debe ser menor al hasta ("+e+").")
return Math.floor(Math.random()*(e-t+1))+t},t.prototype.azar_excluyendo_un_valor=function(t,e,i){for(var a=this.azar(t,e);a==i;)a=this.azar(t,e)
return a},t.prototype.obtener_distancia_entre_puntos=function(t,e,i,a){var o=t-i,r=e-a
return Math.sqrt(o*o+r*r)},t.prototype.obtener_distancia_entre_actores=function(t,e){return this.obtener_distancia_entre_puntos(t.x,t.y,e.x,e.y)},t.prototype.obtener_angulo_entre_puntos=function(t,e,i,a){var o=i-t,r=a-e,n=Math.atan(r/o)
return 1/o<0&&(n+=Math.PI),1/n<0&&(n+=2*Math.PI),n*(180/Math.PI)},t.prototype.obtener_angulo_entre_actores=function(t,e){return t.esta_vivo()&&e.esta_vivo()?this.obtener_angulo_entre_puntos(t.x,t.y,e.x,e.y):0},t.prototype.ocultar_cursor=function(){this.modo.input.setDefaultCursor("none")},t.prototype.definir_cursor=function(t){this.modo.input.setDefaultCursor({normal:"default",pulsable:"hand",mano:"hand"}[t]||t)},t.prototype.observar=function(t,e){this.escena.observar(t,e)},t.prototype.clonar=function(t){return this.modo.clonar_actor_por_nombre(t)},t.prototype.clonar_en=function(t,e,i){var a=this.modo.clonar_actor_por_nombre(t)
return a.x=e,a.y=i,a},t.prototype.clonar_en_la_posión_del_cursor=function(t){var e=this.modo.clonar_actor_por_nombre(t)
return e.x=this.cursor_x,e.y=this.cursor_y,e},t.prototype.clonar_en_posicion_al_azar=function(t){var e=this.azar(-200,200),i=this.azar(-200,200)
return this.clonar_en(t,e,i)},t.prototype.es_multiplo=function(t,e){return t%e==0},t.prototype.enviar_mensaje_global=function(t,e){void 0===e&&(e={}),this.escena_actual().enviar_mensaje(t,e)
for(var i=this.obtener_actores(),a=0;a<i.length;a++)i[a].enviar_mensaje(t,e)},t.prototype.alternar_modo_pantalla_completa=function(){this.modo.scale.toggleFullscreen()},t.prototype.solicitar_modo_pantalla_completa=function(){this.modo.scale.startFullscreen()},t.prototype.solicitar_modo_ventana=function(){this.modo.scale.stopFullscreen()},t.prototype.ajustar=function(t,e){return this.alinear(t,e)},t.prototype.alinear=function(t,e){if(e<1)throw new Error("El valor de la grilla tiene que ser mayor a 1")
return Math.round(t/e)*e},t.prototype.pausar=function(){this.modo.game.scene.start("ModoEjecucionEnPausa",{pilas:this}),this.modo.game.scene.pause("ModoEjecucion")},t.prototype.azar_desde_lista=function(t){return t[this.azar(0,t.length-1)]},t.prototype.intercambiar_posiciones_al_azar=function(t){var e=t.map((function(t){return{x:t.x,y:t.y}}))
e=this.desordenar_lista(e),t.map((function(t,i){t.x=e[i].x,t.y=e[i].y}))},t.prototype.desordenar_lista=function(t){for(var e,i=__spreadArrays(t),a=i.length-1;a>0;a--){var o=Math.floor(Math.random()*(a+1))
e=[i[o],i[a]],i[a]=e[0],i[o]=e[1]}return i},t.prototype.subdividir_lista=function(t,e){return __spreadArrays(t).slice(0,e)},t.prototype.notificar_traza_de_ejecucion=function(t,e){void 0===this.instrumentacion&&this.limpiar_traza_de_ejecucion(),this.instrumentacion[t]?this.instrumentacion[t].push(e):this.instrumentacion[t]=[e]},t.prototype.notificar_ejecucion_del_bloque=function(t,e){this.instrumentacion_de_bloques[e]?this.instrumentacion_de_bloques[e].push(t):this.instrumentacion_de_bloques[e]=[t]},t.prototype.limpiar_traza_de_ejecucion=function(){this.instrumentacion={},this.instrumentacion_de_bloques={}},t.prototype.definir_mapa=function(t){for(var e in t)if(t.hasOwnProperty(e)){if("string"!=typeof e||e.length>1)throw new Error("Las claves del mapa tienen que ser de una sola letra o número. Se encontró: "+e)
if(-1!==[".","-"," "].indexOf(e))throw new Error("Las claves del mapa no pueden ser punto, guión ni espacio. Esos caracteres están reservados para definir espacios.")
if(!this.existe_un_actor_llamado_en_el_proyecto(t[e]))throw new Error('Los valores del mapa tienen que nombres de actores que existan en alguna escena. El actor "'+t[e]+'" no existe.')}this.referencia_de_mapa=t},t.prototype.crear_mapa=function(t,e,i,a){void 0===e&&(e=64),void 0===i&&(i=0),void 0===a&&(a=0)
var o=t.split("\n").map((function(t){return t.trim()})).filter((function(t){return t})),r=o.length
if(!this.referencia_de_mapa)throw Error("No se puede crear un mapa si no se llamó antes a la función 'pilas.definir_mapa'.")
for(var n=0;n<r;n++)for(var s=o[n].length,c=0;c<s;c++){var l=o[n][c],p=c*e+i-(s/2<<0)*e,_=n*e+a-(r/2<<0)*e
if(this.referencia_de_mapa[l]){var u=this.referencia_de_mapa[l]
this.clonar_en(u,p,-_)}else if(-1==["-"," ","."].indexOf(l))throw Error('Cuidado, el mapa usa la letra "'+l+"\" que no se definió a llamar a la función 'definir_mapa'.")}},t.prototype.laser=function(t,e,i,a,o){var r=this,n=this.modo.matter.world.getAllBodies(),s=[],c=raycast(n,this.utilidades.convertir_coordenada_de_pilas_a_phaser(e,i),this.utilidades.convertir_coordenada_de_pilas_a_phaser(a,o))
return(c=(c=(c=c.filter((function(t){return t.body.gameObject&&t.body.gameObject.actor}))).filter((function(e){return e.body.gameObject.actor.id!==t.id}))).filter((function(t){return!s.includes(t.body.gameObject.actor.id)&&(s.push(t.body.gameObject.actor.id),!0)}))).map((function(t){var a=r.utilidades.convertir_coordenada_de_phaser_a_pilas(t.point.x,t.point.y)
return{actor:t.body.gameObject.actor,body:t.body,distancia:Math.trunc(r.obtener_distancia_entre_puntos(e,i,a.x,a.y)),x:a.x,y:a.y}})).sort((function(t,e){return t.distancia-e.distancia}))},t.prototype.laser_al_primer_actor=function(t,e,i,a,o,r){void 0===r&&(r="")
var n=this.laser(t,e,i,a,o)
return r&&(n=n.filter((function(t){return t.actor.tiene_etiqueta(r)}))),n.length>0?n[0]:null},t.prototype.imprimir_en_consola=function(t){var e=typeof t,i=t.toString()
this.mensajes.emitir_mensaje_al_editor("imprimir_en_consola",{mensaje:i,tipo_de_dato:e})},t}(),pilasengine=new Pilas,print=function(t){pilasengine.imprimir_en_consola(t)},mostrar=print,ingresar=function(t){return void 0===t&&(t=""),prompt(t)},Sensor=function(){function t(t){this._figura=t}return Object.defineProperty(t.prototype,"colisiones",{get:function(){return this._figura.colisiones},enumerable:!1,configurable:!0}),t.prototype.colisiones_con_la_etiqueta=function(t){return this._figura.colisiones.filter((function(e){return e.tiene_etiqueta(t)}))},t.prototype.colisiona_con_etiqueta=function(t){return!!this._figura.colisiones.find((function(e){return e.tiene_etiqueta(t)}))},Object.defineProperty(t.prototype,"cantidad_de_colisiones",{get:function(){return this._figura.colisiones.length},enumerable:!1,configurable:!0}),t.prototype.cantidad_de_colisiones_con_la_etiqueta=function(t){return this.colisiones_con_la_etiqueta(t).length},t}(),ActorBase=function(){function t(t){this.figura="",this.lasers_serializados=[],this._etiqueta=null,this._vivo=!0,this._animacion_en_curso="",this._es_texto=!1,this.animacion_pausada=!1,this._comportamiento_actual=null,this._fondo=null,this._fondo_imagen="",this._dialogo=null,this._fuente="color-blanco-con-sombra",this._texto_con_borde=!1,this._color_de_texto="white",this.propiedades_base={x:0,y:0,z:0,imagen:"imagenes:basicos/sin_imagen",centro_x:.5,centro_y:.5,rotacion:0,escala_x:1,escala_y:1,transparencia:0,etiqueta:"actor",espejado:!1,espejado_vertical:!1,figura:"",figura_dinamica:!0,figura_ancho:100,figura_alto:100,figura_radio:40,figura_sin_rotacion:!1,figura_rebote:1,figura_sensor:!1,es_texto:!1,texto_con_borde:!1},this.propiedades={x:0,y:0,z:0,imagen:"imagenes:basicos/sin_imagen",figura:""},this.pilas=t,this.automata=new Automata(this),this.colisiones=[],this._habilidades=[]}return Object.defineProperty(t.prototype,"propiedades_iniciales",{get:function(){return this.propiedades},enumerable:!1,configurable:!0}),t.prototype.pre_iniciar=function(t){var e=this,i=t.figura||""
switch(this._id=t.id||this.pilas.utilidades.obtener_id_autoincremental(),this._nombre=t.nombre,this.recorte_activado=!1,this.sensores=[],this.lasers=[],this._comportamientos=[],this._figura_ancho=t.figura_ancho,this._figura_alto=t.figura_alto,this._figura_radio=t.figura_radio,this._es_texto=t.es_texto,this.cuadro=0,i){case"rectangulo":this.sprite=this.crear_sprite("matter",t.imagen),this.figura=i,this.crear_figura_rectangular(t.figura_ancho,t.figura_alto),this.dinamico=t.figura_dinamica,this.sin_rotacion=t.figura_sin_rotacion,this.rebote=t.figura_rebote,this.sensor=t.figura_sensor,this.sprite.body.es_dinamica=this.dinamico,this.sprite.body.es_sensor=this.sensor
break
case"circulo":this.sprite=this.crear_sprite("matter",t.imagen),this.figura=i,this.crear_figura_circular(t.figura_radio),this.dinamico=t.figura_dinamica,this.sin_rotacion=t.figura_sin_rotacion,this.rebote=t.figura_rebote,this.sensor=t.figura_sensor,this.sprite.body.es_dinamica=this.dinamico,this.sprite.body.es_sensor=this.sensor
break
case"ninguna":case"":this.figura=i,this.sprite=this.crear_sprite("sprite",t.imagen)
break
default:throw Error("No se conoce el tipo de figura "+i)}if(this.interactivo=!0,this.rotacion=t.rotacion||0,this.id_color=this.generar_color_para_depurar(),this.etiqueta=t.etiqueta,this.escala_x=t.escala_x||1,this.escala_y=t.escala_y||1,this.tipo=t.tipo,this.centro_x=t.centro_x||.5,this.centro_y=t.centro_y||.5,this.transparencia=t.transparencia||0,this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.espejado=t.espejado,this.espejado_vertical=t.espejado_vertical,this.sprite.actor=this,t.lasers){var a=null
this.lasers=t.lasers.map((function(t){return new Laser(e,t.nombre,t.rotacion,t.longitud)})),this.sprite.body&&(a=this.sprite.body.id),this.lasers_serializados=t.lasers.map((function(t){return __assign(__assign({},t),{actor_id:e.id,body_id:a})}))}t.es_texto&&(this.texto=t.texto,this.fuente=t.fuente,t.fondo&&(this.fondo=t.fondo)),this.sprite.on("animationrepeat",(function(t,i){e.ejecutar_de_modo_seguro((function(){if(i.isFirst){var a=t.key
a.includes("-")&&(a=t.key.split("-")[1])
e.estado
e.cuando_finaliza_animacion(a),e.automata.cuando_finaliza_animacion(a)}}))})),this.sprite.on("pointerdown",(function(t){e.ejecutar_de_modo_seguro((function(){var i=e.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(t.x,t.y)
e.cuando_hace_click(i.x,i.y,t),e.automata.cuando_hace_click(i.x,i.y,t),e._bloques_cuando_hace_click(i.x,i.y,t)}))})),this.sprite.on("pointerup",(function(t){e.ejecutar_de_modo_seguro((function(){var i=e.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(t.x,t.y)
e.cuando_termina_de_hacer_click(i.x,i.y,t),e.automata.cuando_termina_de_hacer_click(i.x,i.y,t)}))})),this.sprite.on("pointerout",(function(t){e.ejecutar_de_modo_seguro((function(){var i=e.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(t.x,t.y)
e.cuando_sale(i.x,i.y,t),e.automata.cuando_sale(i.x,i.y,t)}))})),this.sprite.on("pointermove",(function(t){e.ejecutar_de_modo_seguro((function(){var i=e.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(t.x,t.y)
e.cuando_mueve(i.x,i.y,t),e.automata.cuando_mueve(i.x,i.y,t)}))})),this.pilas.escena.agregar_actor(this)},t.prototype.ejecutar_de_modo_seguro=function(t){try{t()}catch(e){this.pilas.mensajes.emitir_excepcion_al_editor(e,"actualizar actor")}},t.prototype.crear_sprite=function(t,e){var i=null,a=null,o=null
switch(this.pilas.utilidades.validar_que_existe_imagen(e),e.indexOf(":")>-1?(i=e.split(":")[0],a=e.split(":")[1]):(i=null,a=e),t){case"matter":o=i?this.pilas.modo.matter.add.sprite(0,0,i,a):this.pilas.modo.matter.add.sprite(0,0,a)
break
case"sprite":o=i?this.pilas.modo.add.sprite(0,0,i,a):this.pilas.modo.add.sprite(0,0,a)
break
default:throw Error("No se puede crear un sprite de tipo "+t)}return o},t.prototype.copiar_atributos_de_sprite=function(t,e){e.x=t.x,e.y=t.y,e.angle=t.angle,e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.alpha=t.alpha,e.flipX=t.flipX,e.flipY=t.flipY,e.depth=t.depth,e.setOrigin(t.originX,t.originY)},t.prototype.iniciar=function(){},t.prototype._bloques_iniciar=function(){},t.prototype._bloques_actualizar=function(){},Object.defineProperty(t.prototype,"interactivo",{get:function(){return this.sprite.input.enabled},set:function(t){t?this.sprite.setInteractive():this.sprite.disableInteractive()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"area_de_interactividad",{get:function(){return{ancho:this.sprite.input.hitArea.width,alto:this.sprite.input.hitArea.height}},set:function(t){console.warn("No pude definir el area así, use definir_area_de_interactividad")},enumerable:!1,configurable:!0}),t.prototype.desactivar_clicks=function(){this.sprite.disableInteractive()},t.prototype.activar_clicks=function(){this.sprite.setInteractive()},t.prototype.definir_area_de_interactividad=function(t,e){this.sprite?this.sprite.input.hitArea.setTo(-t*this.centro_x,-e*this.centro_y,t,e):console.log("aún no tiene sprite")},t.prototype.cuando_hace_click_en_la_pantalla=function(t,e,i){},t.prototype.cuando_termina_de_hacer_click_en_la_pantalla=function(t,e,i){},Object.defineProperty(t.prototype,"fondo",{set:function(t){},enumerable:!1,configurable:!0}),t.prototype.serializar=function(){var t="",e="",i=""
this._es_texto&&(t=this._texto.text,e=this._fondo_imagen,i=this._fuente)
var a=[]
this.sensores&&(a=this.sensores.map((function(t){return t.vertices.map((function(t){return{x:t.x,y:t.y,isInternal:t.isInternal}}))})))
var o=0,r=0,n=0,s=0,c=!1
return this.sprite.input&&this.sprite.input.hitArea&&(o=this.sprite.input.hitArea.x,r=this.sprite.input.hitArea.y,n=this.sprite.input.hitArea.width,s=this.sprite.input.hitArea.height,c=this.recorte_activado),{id:this.id,nombre:this.nombre,tipo:this.tipo,x:Math.round(this.x),y:Math.round(this.y),z:Math.round(this.z),centro_x:this.centro_x,centro_y:this.centro_y,rotacion:this.rotacion,escala_x:this.escala_x,escala_y:this.escala_y,imagen:this.imagen,figura:this.figura,figura_ancho:this.figura_ancho,figura_alto:this.figura_alto,figura_radio:this.figura_radio,figura_dinamica:this.dinamico,figura_sensor:this.sensor,fijo:this.fijo,es_texto:this._es_texto,texto:t,fondo:e,fuente:i,texto_con_borde:this._texto_con_borde,color_de_texto:this._color_de_texto,espejado:this.espejado,espejado_vertical:this.espejado_vertical,transparencia:this.transparencia,id_color:this.id_color,hit_x:o,hit_y:r,hit_ancho:n,hit_alto:s,hit_activado:c,sensores:a,lasers:this.lasers_serializados}},Object.defineProperty(t.prototype,"etiqueta",{get:function(){return this._etiqueta},set:function(t){this._etiqueta=t},enumerable:!1,configurable:!0}),t.prototype.tiene_etiqueta=function(t){return this.etiqueta===t},t.prototype.generar_color_para_depurar=function(){return this.pilas.utilidades.obtener_color_al_azar()},t.prototype.pre_actualizar=function(){this.cuadro+=1,this.figura&&this.sin_rotacion&&this.sprite.setAngularVelocity(0),this.actualizar_comportamientos(),this.automata.actualizar()},t.prototype.actualizar_comportamientos=function(){this._comportamiento_actual?this._comportamiento_actual.actualizar()&&(this._comportamientos.length>0?this._adoptar_siguiente_comportamiento():this._comportamiento_actual=null):this._comportamientos.length>0&&this._adoptar_siguiente_comportamiento()},t.prototype._adoptar_siguiente_comportamiento=function(){var t=this._comportamientos[0],e=t.nombre_del_comportamiento,i=this.pilas.comportamientos.buscar(e)
if(i){var a=new i(this.pilas,this)
a.iniciar(t.argumentos),this._comportamientos.length>0&&(this._comportamientos.shift(),this._comportamiento_actual=a)}},t.prototype.hacer=function(t,e){void 0===e&&(e=void 0),this.pilas.comportamientos.validar_si_existe(t),this._comportamientos.push({nombre_del_comportamiento:t,argumentos:e})},t.prototype.eliminar_comportamientos=function(){this._comportamientos=[],this._comportamiento_actual=null},t.prototype.hacer_inmediatamente=function(t,e){void 0===e&&(e=void 0),this.eliminar_comportamientos(),this.hacer(t,e)},Object.defineProperty(t.prototype,"estado",{get:function(){return this.automata.estado},set:function(t){this.automata.estado=t},enumerable:!1,configurable:!0}),t.prototype.actualizar=function(){},t.prototype.actualizar_habilidades=function(){this._habilidades.map((function(t){t.actualizar()}))},t.prototype.actualizar_sensores=function(){var t=this,e=this.pilas.Phaser.Physics.Matter.Matter.Body
this.sensores.map((function(i){var a=t.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(t.x,t.y),o=a.x,r=a.y
e.setPosition(i,{x:o+i.distancia_x,y:r-i.distancia_y}),e.setVelocity(i,{x:0,y:0}),e.setAngularVelocity(i,0),i.colisiones=i.colisiones.filter((function(t){return t._vivo}))}))},Object.defineProperty(t.prototype,"imagen",{get:function(){return"__BASE"===this.sprite.frame.name?this.sprite.texture.key:this.sprite.texture.key+":"+this.sprite.frame.name},set:function(t){var e=null,i=null
this.pilas.utilidades.validar_que_existe_imagen(t),t.indexOf(":")>-1?(e=t.split(":")[0],i=t.split(":")[1]):(e=null,i=t),e?this.sprite.setTexture(e,i):this.sprite.setTexture(i)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nombre",{get:function(){return this._nombre},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){try{return this.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(this.sprite.x,0).x}catch(t){if(t.stack.includes("Tween"))return
throw Error("No se puede acceder a la posición el actor "+this.nombre+" porque ha sido eliminado")}},set:function(t){try{if(this.pilas.utilidades.es_animacion(t))this.pilas.animar(this,"x",t)
else{this.pilas.utilidades.validar_numero(t)
var e=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(t,0).x
this.sprite.x=e}}catch(i){if(i.stack.includes("Tween"))return
throw Error("No se puede acceder a la posición el actor "+this.nombre+" porque ha sido eliminado")}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){try{return this.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(0,this.sprite.y).y}catch(t){if(t.stack.includes("Tween"))return
throw Error("No se puede acceder a la posición el actor "+this.nombre+" porque ha sido eliminado")}},set:function(t){if(this.pilas.utilidades.es_animacion(t))this.pilas.animar(this,"y",t)
else{this.pilas.utilidades.validar_numero(t)
var e=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(0,t).y
this.sprite.y=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return-this.sprite.depth},set:function(t){this.pilas.utilidades.validar_numero(t),this.sprite.depth=-t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotacion",{get:function(){return-this.sprite.angle%360},set:function(t){this.pilas.utilidades.es_animacion(t)?this.pilas.animar(this,"rotacion",t):(this.pilas.utilidades.validar_numero(t),this.sprite.angle=-t%360)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"escala_x",{get:function(){return this.sprite.scaleX},set:function(t){this.pilas.utilidades.es_animacion(t)?this.pilas.animar(this,"escala_x",t):(this.pilas.utilidades.validar_numero(t),this.sprite.scaleX=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"escala_y",{get:function(){return this.sprite.scaleY},set:function(t){this.pilas.utilidades.es_animacion(t)?this.pilas.animar(this,"escala_y",t):(this.pilas.utilidades.validar_numero(t),this.sprite.scaleY=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"escala",{get:function(){return this.escala_x},set:function(t){this.pilas.utilidades.es_animacion(t)?this.pilas.animar(this,"escala",t):(this.pilas.utilidades.validar_numero(t),this.escala_x=t,this.escala_y=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centro_y",{get:function(){return this.sprite.originY},set:function(t){var e={centro:.5,arriba:0,abajo:1,medio:.5}
void 0!==e[t]&&(t=e[t]),this.pilas.utilidades.validar_numero(t),this.sprite.setOrigin(this.centro_x,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centro_x",{get:function(){return this.sprite.originX},set:function(t){var e={centro:.5,izquierda:0,derecha:1,medio:.5}
void 0!==e[t]&&(t=e[t]),this.pilas.utilidades.validar_numero(t),this.sprite.setOrigin(t,this.centro_y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transparencia",{get:function(){return 100*(1-this.sprite.alpha)},set:function(t){this.pilas.utilidades.es_animacion(t)?this.pilas.animar(this,"transparencia",t):(this.pilas.utilidades.validar_numero(t),t=this.pilas.utilidades.limitar(t,0,100),this.sprite.alpha=1-t/100)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){var t=this.constructor.name
if(this.esta_vivo())return"<"+t+" en ("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")>"},t.prototype.fallar_si_no_tiene_figura=function(){if(!this.figura)throw Error("Este actor no tiene figura física, no se puede llamar a este método")},t.prototype.crear_figura_rectangular=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.fallar_si_no_tiene_figura(),this.pilas.utilidades.validar_numero(t),this.pilas.utilidades.validar_numero(e),this.sprite.setRectangle(t,e)},t.prototype.crear_figura_circular=function(t){void 0===t&&(t=0),this.fallar_si_no_tiene_figura(),this.pilas.utilidades.validar_numero(t),t<1&&(t=30),this.sprite.setCircle(t)},Object.defineProperty(t.prototype,"ancho",{get:function(){return this.sprite.width},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alto",{get:function(){return this.sprite.height},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"estatico",{get:function(){return void 0!==this.sprite.isStatic&&this.sprite.isStatic()},set:function(t){void 0!==this.sprite.setStatic?(this.sprite.setStatic(t),this.sprite.setVelocity(0,0)):console.warn("Este actor no tiene figura, ignorando valor estatico/dinámico.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dinamico",{get:function(){return!this.estatico},set:function(t){this.estatico=!t},enumerable:!1,configurable:!0}),t.prototype.impulsar=function(t,e){this.fallar_si_no_tiene_figura(),this.sprite.setVelocity(t,-e)},Object.defineProperty(t.prototype,"velocidad_x",{get:function(){return this.fallar_si_no_tiene_figura(),this.sprite.body.velocity.x},set:function(t){this.fallar_si_no_tiene_figura(),this.sprite.setVelocityX(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"velocidad_y",{get:function(){return this.fallar_si_no_tiene_figura(),-this.sprite.body.velocity.y},set:function(t){this.fallar_si_no_tiene_figura(),this.sprite.setVelocityY(-t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rebote",{get:function(){return this.fallar_si_no_tiene_figura(),this.sprite.body.restitution},set:function(t){this.pilas.utilidades.validar_numero(t),this.fallar_si_no_tiene_figura(),this.sprite.setBounce(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sensor",{get:function(){return!(!this.sprite.body||void 0===this.sprite.body.isSensor)&&this.sprite.isSensor()},set:function(t){this.fallar_si_no_tiene_figura(),this.sprite.setSensor(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fijo",{get:function(){return 0==this.sprite.scrollFactorX},set:function(t){t?(this.sprite.setScrollFactor(0,0),this._texto&&this._texto.setScrollFactor(0,0)):(this.sprite.setScrollFactor(1,1),this._texto&&this._texto.setScrollFactor(1,1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"espejado",{get:function(){return this.sprite.flipX},set:function(t){this.sprite.setFlipX(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"espejado_vertical",{get:function(){return this.sprite.flipY},set:function(t){this.sprite.setFlipY(t)},enumerable:!1,configurable:!0}),t.prototype.cada_segundo=function(t){},t.prototype.cuando_transcurre_un_segundo=function(t){},t.prototype.avanzar=function(t,e){void 0===t&&(t=null),void 0===e&&(e=1),null===t&&(t=this.rotacion)
var i=this.pilas.utilidades.convertir_angulo_a_radianes(t)
this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e},t.prototype.crear_animacion=function(t,e,i){this.pilas.animaciones.crear_animacion(t,e,i)},t.prototype.pausar_animacion=function(){this.animacion_pausada=!0,this.sprite.anims.pause()},t.prototype.continuar_animacion=function(){this.animacion_pausada&&this.sprite.anims.resume()},t.prototype.reiniciar_animacion=function(){this.sprite.anims.restart()},t.prototype.actualizar_animacion=function(t){void 0===t&&(t=1)
var e=null
t<0&&(this.sprite.anims.inReverse=!0,this.sprite.anims.forward=!1),this.animacion_pausada&&this.sprite.anims.resume(),e=t>0?t:-t
var i=this.pilas.modo._delta,a=this.pilas.modo._time
this.sprite.anims.update(a,i*e),t<0&&(this.sprite.anims.inReverse=!1,this.sprite.anims.forward=!0),this.animacion_pausada&&this.sprite.anims.pause()},t.prototype.reproducir_animacion=function(t){this.sprite.anims.resume()
var e=this.pilas.animaciones.animaciones[t]
if(!e)throw Error('No existe una animación con el nombre "'+t+'"')
if(0===e.frames.length)throw Error('La animación "'+t+'" está vacía.')
this.sprite.anims.play(t)},t.prototype.cuando_finaliza_animacion=function(t){},Object.defineProperty(t.prototype,"animacion",{get:function(){return this._animacion_en_curso},set:function(t){if(this._animacion_en_curso!==t){if(!this.pilas.animaciones.existe_animacion(t))throw Error("No se ha creado la animación '"+t+"' previamente")
this.reproducir_animacion(t),this._animacion_en_curso=t}},enumerable:!1,configurable:!0}),t.prototype.animar=function(t,e,i){return void 0===t&&(t=Tipo.suave),void 0===e&&(e=1),void 0===i&&(i=1),this._vivo?this.pilas.escena.crear_animacion(this,t,e,i):this.pilas.escena.crear_animacion_nula()},t.prototype.cuando_comienza_una_colision=function(t){},t.prototype.cuando_se_mantiene_una_colision=function(t){},t.prototype.cuando_termina_una_colision=function(t){},t.prototype.cuando_colisiona=function(t){},t.prototype.cuando_hace_click=function(t,e,i){},t.prototype.cuando_termina_de_hacer_click=function(t,e,i){},t.prototype.cuando_sale=function(t,e,i){},t.prototype.cuando_mueve=function(t,e,i){},t.prototype.cuando_mueve_sobre_la_pantalla=function(t,e,i){},t.prototype.cuando_pulsa_tecla=function(t,e){},t.prototype.cuando_suelta_tecla=function(t,e){},Object.defineProperty(t.prototype,"cantidad_de_colisiones",{get:function(){return this.colisiones.length},enumerable:!1,configurable:!0}),t.prototype.agregar_sensores_desde_lista=function(t){var e=this
t.map((function(t){e.agregar_sensor(t.ancho,t.alto,t.x,t.y,t.nombre)}))},t.prototype.agregar_sensor=function(t,e,i,a,o){void 0===o&&(o="sin nombre")
var r=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(i,a),n=this.pilas.modo.matter.add.rectangle(r.x,r.y,t,e,{isSensor:!0,isStatic:!1})
return n.distancia_x=i,n.distancia_y=a,n.es_sensor=!0,n.es_dinamica=!0,n.sensor_del_actor=this,n.colisiones=[],n.nombre=o,this.sensores.push(n),n},t.prototype.eliminar=function(){this._vivo=!1,this.pilas.escena.eliminar_animaciones_del_actor(this)},t.prototype.esta_vivo=function(){return this._vivo},Object.defineProperty(t.prototype,"fuente",{get:function(){return""},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"figura_ancho",{get:function(){return this._figura_ancho},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"figura_alto",{get:function(){return this._figura_alto},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"figura_radio",{get:function(){return this._figura_radio},set:function(t){throw new Error("No puede definir este atributo")},enumerable:!1,configurable:!0}),t.prototype.decir=function(t,e,i,a){var o=this
void 0===e&&(e=4),void 0===i&&(i=0),void 0===a&&(a=0),this._dialogo&&(this._dialogo.eliminar(),this._dialogo=null)
var r=this.pilas.actores.texto()
r.texto=t
try{r.x=this.x-15+i,r.y=this.y+this.alto+a}catch(s){console.warn('No se puede llamar a "decir" porque el actor '+this.nombre+" ha sido eliminado")}function n(){r.x-r.sprite.width<r.pilas.camara.borde_izquierdo&&(r.x=r.pilas.camara.borde_izquierdo+r.sprite.width),r.x+20>r.pilas.camara.borde_derecho&&(r.x=r.pilas.camara.borde_derecho-20),r.y+r.sprite.height>r.pilas.camara.borde_arriba&&(r.y=r.pilas.camara.borde_arriba-r.sprite.height),r.y-15<r.pilas.camara.borde_abajo&&(r.y=r.pilas.camara.borde_abajo+15)}r.fuente="color-negro",r.fondo="imagenes:redimensionables/dialogo",r.color="black",r.centro_x=1,r.centro_y=1,r.z=this.z-1,r.texto=t,n(),r.actualizar=function(){o.esta_vivo()&&(r.x=o.x-15+i,r.y=o.y+o.alto+a,n())},this._dialogo=r,this.pilas.luego(e,(function(){r.esta_vivo()&&(r.eliminar(),r===o._dialogo&&(o._dialogo=null))}))},t.prototype.aprender=function(t){var e=this.pilas.habilidades.buscar(t)
if(e){if(this.tiene_habilidad(e.name)){var i="No se aplica la habilidad "+e.name+" porque el actor ya la tenía vinculada."
return console.warn(i),i}var a=new e(this.pilas,this)
return a.iniciar(),this._habilidades.push(a),"Enseñando habilidad "+e.name}},t.prototype.olvidar=function(t){var e=this.pilas.habilidades.buscar(t)
if(e)if(this.tiene_habilidad(e.name)){var i=this._habilidades.findIndex((function(t){return t.constructor.name==e.name}))
this._habilidades[i].eliminar(),this._habilidades.splice(i,1)}else console.warn("No se puede olvidar la habilidad '"+e.name+"' porque el actor no la tiene.")},t.prototype.tiene_habilidad=function(t){return this._habilidades.filter((function(e){return e.constructor.name===t})).length>0},t.prototype.aumentar=function(t){void 0===t&&(t=1)},Object.defineProperty(t.prototype,"con_borde",{set:function(t){this._texto_con_borde=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{set:function(t){this._color_de_texto=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"control",{get:function(){return this.pilas.control},enumerable:!1,configurable:!0}),t.prototype.obtener_distancia_al_punto=function(t,e){return this.pilas.utilidades.obtener_distancia_entre(this.x,this.y,t,e)},t.prototype.obtener_distancia_al_actor=function(t){if(t.esta_vivo())return this.obtener_distancia_al_punto(t.x,t.y)
throw Error('No se puede llamar a obtener_distancia_al_actor porque el actor "'+t.nombre+'" se eliminó. Llama a la función this.pilas.existe_actor_llamado("'+t.nombre+'") para consultar si existe ese actor antes de llamar a esta función')},t.prototype.mover_hacia_el_punto=function(t,e,i){void 0===i&&(i=10)
var a=this.pilas.obtener_angulo_entre_puntos(this.x,this.y,t,e)
this.avanzar(a,i)},t.prototype.enviar_mensaje=function(t,e){void 0===e&&(e={}),this.cuando_llega_un_mensaje(t,e),this["cuando_llega_el_mensaje_"+t]&&this["cuando_llega_el_mensaje_"+t](e)},t.prototype.cuando_llega_un_mensaje=function(t,e){void 0===e&&(e={})},t.prototype.enviar_mensaje_global=function(t,e){void 0===e&&(e={}),this.pilas.enviar_mensaje_global(t,e)},Object.defineProperty(t.prototype,"camara",{get:function(){return this.pilas.camara},enumerable:!1,configurable:!0}),t.prototype.hacer_recorrido=function(t,e,i,a){var o=this
void 0===e&&(e=1),void 0===i&&(i=1),void 0===a&&(a=!1),this.pilas.utilidades.validar_parametro_lista_de_numeros_pares("posiciones",t),this.pilas.utilidades.validar_parametro_numero_positivo("duracion",e),this.pilas.utilidades.validar_parametro_numero_entero_cero_o_positivo("veces",i)
var r=[this.x,this.y].concat(t),n=new Phaser.Curves.Spline(r),s=this.x,c=this.y
this.pilas.modo.tweens.add({targets:{t:0},t:1,ease:"Linear",duration:1e3*e,yoyo:!1,repeat:i-1,onUpdate:function(t,e){var i=n.getPoint(e.t),r=i.x,l=i.y
if(o.esta_vivo()){if(o.x=r,o.y=l,a){var p=o.x-s,_=o.y-c
o.rotacion=o.pilas.utilidades.convertir_radianes_a_angulos(Math.atan2(_,p))}s=r,c=l}}})},t.prototype.obtener_laser=function(t){var e=this.lasers.find((function(e){return e.nombre===t}))
if(!e){var i=this.lasers.map((function(t){return t.nombre}))
if(i.length>0){var a=this.pilas.utilidades.obtener_mas_similar(t,i)
throw Error('No existe un laser que se llame "'+t+'". ¿Quisiste decir "'+a+'"?')}throw Error('No hay lasers creados, así que no se buscó si existía uno llamado "'+t+'".')}return e},t.prototype.obtener_sensor=function(t){var e=this.sensores.find((function(e){return e.nombre===t}))
if(!e){var i=this.sensores.map((function(t){return t.nombre}))
if(i.length>0){var a=this.pilas.utilidades.obtener_mas_similar(t,i)
throw Error('No existe un sensor que se llame "'+t+'". ¿Quisiste decir "'+a+'"?')}throw Error('No hay sensores creados, así que no se buscó si existía uno llamado "'+t+'".')}if(e)return new Sensor(e)},t.prototype.reproducir_sonido=function(t){return this.pilas.reproducir_sonido(t)},t.prototype.reproducir_musica=function(t){return this.pilas.reproducir_musica(t)},t.prototype.detener_musica=function(){return this.pilas.detener_musica()},t.prototype.recortar=function(t,e,i,a){if(this.figura)throw new Error("No se puede recortar un actor que tiene una figura dinámica.")
this.recorte_activado=!0,this.sprite.setCrop(t,e,i,a),this.sprite.input.hitArea.x=t,this.sprite.input.hitArea.y=e,this.sprite.input.hitArea.width=i,this.sprite.input.hitArea.height=a,this.centro_x=(t+i/2)/this.sprite.width,this.centro_y=(e+a/2)/this.sprite.height},t.prototype.eliminar_recortado=function(){this.sprite.setCrop(),this.recorte_activado=!1,this.sprite.input.hitArea.x=0,this.sprite.input.hitArea.y=0,this.sprite.input.hitArea.width=this.sprite.width,this.sprite.input.hitArea.height=this.sprite.height,this.centro_x=.5,this.centro_y=.5},t.prototype.reiniciar=function(){this.eliminar(),this.pilas.clonar(this.nombre)},t.prototype.saltar=function(){this.impulsar(0,10)},t.prototype.saludar=function(){this.decir("¡hola!")},t.prototype._bloques_cuando_hace_click_en_la_pantalla=function(t,e,i){},t.prototype._bloques_cuando_hace_click=function(t,e,i){},t.prototype._bloques_cada_segundo=function(t){},t}(),ActorTextoBase=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/invisible",texto:"Hola mundo",es_texto:!0,fuente:"color-blanco-con-sombra-grande"},e.margen_interno=30,e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.pre_actualizar=function(){t.prototype.pre_actualizar.call(this),this.copiar_atributos_de_sprite(this.sprite,this._texto),this._fondo&&(this.copiar_atributos_de_sprite(this.sprite,this._fondo),this._texto.depth=this._texto.depth+1,this._fondo.x+=this.margen_interno*this.sprite.originX-.5*this.margen_interno,this._fondo.y+=this.margen_interno*this.sprite.originY-.5*this.margen_interno,this._fondo_imagen.includes("dialogo")&&(this._fondo.y+=4),this.fijo?this._fondo.setScrollFactor(0,0):this._fondo.setScrollFactor(1,1))},e.prototype.actualizar=function(){},Object.defineProperty(e.prototype,"texto",{get:function(){return this._texto.text},set:function(t){this._texto?this._texto.text=t:this._texto=this.pilas.modo.add.bitmapText(0,0,this._fuente,t),this.actualizar_tamano_del_fondo()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fuente",{get:function(){return this._fuente},set:function(t){var e=this.texto
this._texto&&this._texto.destroy(),this._texto=this.pilas.modo.add.bitmapText(0,0,t,e),this._fuente=t,this.actualizar_tamano_del_fondo()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fondo",{set:function(t){this._fondo_imagen=t,this._fondo?(this._fondo.destroy(),this.crear_fondo(t)):this.crear_fondo(t)},enumerable:!1,configurable:!0}),e.prototype.crear_fondo=function(t){var e=null
if(t.indexOf(":")>-1){var i=t.split(":")
e={key:i[0],frame:i[1]}}else e=t
this._fondo=this.pilas.modo.add.nineslice(0,0,30,20,e,10,10),this.pre_actualizar(),this.actualizar_tamano_del_fondo()},e.prototype.actualizar_tamano_del_fondo=function(){if(this.definir_area_de_interactividad(this._texto.width,this._texto.height),this._fondo){var t=this._texto.width+this.margen_interno,e=this._texto.height+this.margen_interno
this._fondo.resize(t,e),this.definir_area_de_interactividad(t,e)}},e.prototype.eliminar=function(){t.prototype.eliminar.call(this)},e}(ActorBase),Actor=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={},e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){},e}(ActorBase),PizarraBase=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/sin_imagen"},e}return __extends(e,t),e.prototype.iniciar=function(){this._canvas=this.pilas.modo.add.graphics()},e.prototype.dibujar_circulo=function(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=20),void 0===a&&(a="negro")
var o=this.pilas.colores.convertir_a_hexa(a)
this._canvas.fillStyle(o,1),this._canvas.fillCircle(t,-e,i)},e.prototype.dibujar_borde_de_circulo=function(t,e,i,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=20),void 0===a&&(a="negro"),void 0===o&&(o=1)
var r=this.pilas.colores.convertir_a_hexa(a)
this._canvas.lineStyle(o,r,1),this._canvas.strokeCircle(t,-e,i)},e.prototype.dibujar_rectangulo=function(t,e,i,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=20),void 0===a&&(a=20),void 0===o&&(o="negro")
var r=this.pilas.colores.convertir_a_hexa(o)
this._canvas.fillStyle(r,1),this._canvas.fillRect(t,-e,i,a)},e.prototype.dibujar_borde_de_rectangulo=function(t,e,i,a,o,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=20),void 0===a&&(a=20),void 0===o&&(o="negro"),void 0===r&&(r=1)
var n=this.pilas.colores.convertir_a_hexa(o)
this._canvas.lineStyle(r,n,1),this._canvas.strokeRect(t,-e,i,a)},e.prototype.dibujar_linea=function(t,e,i,a,o,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=100),void 0===a&&(a=100),void 0===o&&(o="negro"),void 0===r&&(r=1)
var n=this.pilas.colores.convertir_a_hexa(o)
this._canvas.lineStyle(r,n,1),this._canvas.lineBetween(t,-e,i,-a)},e.prototype.limpiar=function(){this._canvas.clear()},Object.defineProperty(e.prototype,"fijo",{get:function(){return 0==this._canvas.scrollFactorX},set:function(t){t?this._canvas.setScrollFactor(0,0):this._canvas.setScrollFactor(1,1)},enumerable:!1,configurable:!0}),e.prototype.actualizar=function(){},e.prototype.pre_actualizar=function(){this.pilas.utilidades.sincronizar_contenedor(this._canvas,this.sprite)},e}(Actor),aceituna=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:objetos/aceituna"},e}return __extends(e,t),e.prototype.iniciar=function(){this.imagen="imagenes:objetos/aceituna"},e}(Actor),actor=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/sin_imagen"},e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){},e}(Actor),barra_de_energia=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/barra_de_energia"},e.barra_largo=200,e.barra_alto=15,e.vida_actual=100,e.vida_anterior=0,e}return __extends(e,t),e.prototype.iniciar=function(){t.prototype.iniciar.call(this),this.imagen="imagenes:basicos/invisible"},e.prototype.actualizar=function(){this.dibujar()},e.prototype.dibujar=function(){this.vida_actual!==this.vida_anterior&&(this.vida_actual=Math.max(0,this.vida_actual),this.vida_actual=Math.min(100,this.vida_actual),this.vida_anterior=this.vida_actual,this.dibujar_barra())},e.prototype.dibujar_barra=function(){var t=this.vida_actual,e=this.barra_largo,i=this.barra_alto,a=-e/2,o=+i/2
this.limpiar(),this.dibujar_borde_de_rectangulo(a,o,e,i,"blanco",4),this.dibujar_rectangulo(a,o,e,i,"rojo"),this.dibujar_rectangulo(a,o,e/100*t,i,"amarillo")},e}(PizarraBase),boton=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/invisible",fondo:"imagenes:redimensionables/gris",texto:"Botón",es_texto:!0,z:-10,color:"black",fuente:"color-negro"},e}return __extends(e,t),e.prototype.cuando_hace_click=function(){this.decir("¡has hecho click!"),this.realizar_animacion_de_pulsacion()},e.prototype.realizar_animacion_de_pulsacion=function(){var t=this
this.y-=2,this.pilas.luego(.2,(function(){t.y+=2}))},e.prototype.cuando_mueve=function(){this.pilas.definir_cursor("pointer")},e.prototype.cuando_sale=function(){this.pilas.definir_cursor("normal")},e}(ActorTextoBase),boton_abajo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/botones_abajo",z:-100},e.pulsado=!1,e}return __extends(e,t),e.prototype.iniciar=function(){this.fijo=!0},e.prototype.actualizar=function(){this.pulsado?this.transparencia=0:this.transparencia=50,this.pilas.control.simular_pulsacion("abajo",this.pulsado)},e.prototype.cuando_hace_click=function(){this.pulsado=!0},e.prototype.cuando_sale=function(){this.pulsado=!1},e.prototype.cuando_termina_de_hacer_click=function(){this.pulsado=!1},e}(Actor),boton_activable=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/invisible",fondo:"imagenes:redimensionables/gris",texto:"Botón",es_texto:!0,z:-10,color:"black",fuente:"color-negro"},e.habilitado=!0,e}return __extends(e,t),e.prototype.cuando_hace_click=function(){this.habilitado&&(this.decir("¡has hecho click!"),this.realizar_animacion_de_pulsacion())},e.prototype.realizar_animacion_de_pulsacion=function(){var t=this
this.y-=2,this.pilas.luego(.2,(function(){t.y+=2}))},e.prototype.cuando_mueve=function(){this.habilitado&&this.pilas.definir_cursor("pointer")},e.prototype.cuando_sale=function(){this.habilitado&&this.pilas.definir_cursor("normal")},e.prototype.habilitar=function(){this.habilitado=!0,this.transparencia=0},e.prototype.deshabilitar=function(){this.habilitado=!1,this.transparencia=30,this.pilas.definir_cursor("normal")},e.prototype.activar=function(){this.habilitar()},e.prototype.desactivar=function(){this.deshabilitar()},e}(ActorTextoBase),boton_arriba=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/botones_arriba",z:-100},e.pulsado=!1,e}return __extends(e,t),e.prototype.iniciar=function(){this.fijo=!0},e.prototype.actualizar=function(){this.pulsado?this.transparencia=0:this.transparencia=50,this.pilas.control.simular_pulsacion("arriba",this.pulsado)},e.prototype.cuando_hace_click=function(){this.pulsado=!0},e.prototype.cuando_sale=function(){this.pulsado=!1},e.prototype.cuando_termina_de_hacer_click=function(){this.pulsado=!1},e}(Actor),boton_derecha=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/botones_derecha",z:-100},e.pulsado=!1,e}return __extends(e,t),e.prototype.iniciar=function(){this.fijo=!0},e.prototype.actualizar=function(){this.pulsado?this.transparencia=0:this.transparencia=50,this.pilas.control.simular_pulsacion("derecha",this.pulsado)},e.prototype.cuando_hace_click=function(){this.pulsado=!0},e.prototype.cuando_sale=function(){this.pulsado=!1},e.prototype.cuando_termina_de_hacer_click=function(){this.pulsado=!1},e}(Actor),boton_espacio=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/botones_a",z:-100},e.pulsado=!1,e}return __extends(e,t),e.prototype.iniciar=function(){this.fijo=!0},e.prototype.actualizar=function(){this.pulsado?this.transparencia=0:this.transparencia=50,this.pilas.control.simular_pulsacion("espacio",this.pulsado)},e.prototype.cuando_hace_click=function(){this.pulsado=!0},e.prototype.cuando_sale=function(){this.pulsado=!1},e.prototype.cuando_termina_de_hacer_click=function(){this.pulsado=!1},e}(Actor),boton_izquierda=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/botones_izquierda",z:-100},e.pulsado=!1,e}return __extends(e,t),e.prototype.iniciar=function(){this.fijo=!0},e.prototype.actualizar=function(){this.pulsado?this.transparencia=0:this.transparencia=50,this.pilas.control.simular_pulsacion("izquierda",this.pulsado)},e.prototype.cuando_hace_click=function(){this.pulsado=!0},e.prototype.cuando_sale=function(){this.pulsado=!1},e.prototype.cuando_termina_de_hacer_click=function(){this.pulsado=!1},e}(Actor),caja=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={x:0,y:0,imagen:"imagenes:objetos/caja",etiqueta:"caja",figura:"rectangulo",figura_ancho:45,figura_alto:45,figura_rebote:.9},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),chispa=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"",imagen:"imagenes:efectos/chispa-3",etiqueta:"chispa"},e}return __extends(e,t),e.prototype.iniciar=function(){this.animacion="chispa"},e.prototype.actualizar=function(){},e.prototype.cuando_finaliza_animacion=function(t){this.eliminar()},e}(Actor),conejo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={x:0,y:0,imagen:"imagenes:conejo/conejo_parado1",figura:"rectangulo",figura_ancho:50,figura_alto:100,figura_radio:50,figura_sin_rotacion:!0,figura_dinamica:!0,figura_rebote:0,sensores:[{x:0,y:-51,ancho:64,alto:10,nombre:"pies"}]},e.toca_el_suelo=!1,e.pies=null,e}return __extends(e,t),e.prototype.iniciar=function(){this.estado="parado",this.pies=this.obtener_sensor("pies")},e.prototype.actualizar=function(){this.pies.colisiones.length>0?this.toca_el_suelo=!0:this.toca_el_suelo=!1},e.prototype.parado_iniciar=function(){this.reproducir_animacion("conejo_parado")},e.prototype.parado_actualizar=function(){(this.pilas.control.izquierda||this.pilas.control.derecha)&&(this.estado="camina"),this.pilas.control.arriba&&this.toca_el_suelo&&(this.impulsar(0,10),this.estado="salta"),this.toca_el_suelo||(this.estado="salta")},e.prototype.camina_iniciar=function(){this.reproducir_animacion("conejo_camina")},e.prototype.camina_actualizar=function(){this.pilas.control.izquierda&&(this.x-=5,this.espejado=!0),this.pilas.control.derecha&&(this.x+=5,this.espejado=!1),this.pilas.control.derecha||this.pilas.control.izquierda?(this.pilas.control.arriba&&this.toca_el_suelo&&(this.impulsar(0,10),this.estado="salta"),this.toca_el_suelo||(this.estado="salta")):this.estado="parado"},e.prototype.salta_iniciar=function(){this.reproducir_animacion("conejo_salta")},e.prototype.salta_actualizar=function(){this.pilas.control.izquierda&&(this.x-=5),this.pilas.control.derecha&&(this.x+=5),this.toca_el_suelo&&(this.estado="parado")},e.prototype.cuando_comienza_una_colision=function(t){if("moneda"===t.etiqueta&&(this.pilas.reproducir_sonido("moneda"),t.eliminar()),"plataforma"===t.etiqueta&&this.velocidad_y>.1)return!0},e.prototype.cuando_se_mantiene_una_colision=function(t){},e.prototype.cuando_termina_una_colision=function(t){},e}(Actor),deslizador=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={x:0,y:0,imagen:"imagenes:interfaz/interfaz_linea",etiqueta:"deslizador",figura:""},e.valor=0,e}return __extends(e,t),e.prototype.iniciar=function(){this.imagen="imagenes:interfaz/interfaz_linea",this.esta_arrastrando_el_deslizador=!1,this.crear_marca(),this.conectar_eventos()},e.prototype.conectar_eventos=function(){var t=this
this.pilas.eventos.conectar("mueve_mouse",(function(e){t.cuando_mueve_el_mouse(e)})),this.pilas.eventos.conectar("termina_click",(function(){t.cuando_termina_de_hacer_click()}))},e.prototype.crear_marca=function(){this.marca=this.pilas.actores.actor(),this.marca.imagen="imagenes:interfaz/interfaz_deslizador",this.marca.interactivo=!1},e.prototype.cuando_hace_click=function(t,e){this.esta_arrastrando_el_deslizador=!0,this.ajustar_marca(t)},e.prototype.cuando_mueve_el_mouse=function(t){this.esta_arrastrando_el_deslizador&&this.ajustar_marca(t.x)},e.prototype.cuando_termina_de_hacer_click=function(){this.esta_arrastrando_el_deslizador=!1},e.prototype.actualizar=function(){this.marca.x=this.x-90+1.8*this.valor,this.marca.y=this.y},e.prototype.ajustar_marca=function(t){var e=t-this.x
e=Math.max(e,-90),e=Math.min(e,90),this.valor=(e+90)/1.8},e}(Actor),explosion=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"",imagen:"imagenes:explosion/explosion_001",etiqueta:"explosion"},e}return __extends(e,t),e.prototype.iniciar=function(){this.animacion="explosion",this.pilas.reproducir_sonido("explosion")},e.prototype.actualizar=function(){},e.prototype.cuando_finaliza_animacion=function(t){this.eliminar()},e}(Actor),gallina=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={x:0,y:0,imagen:"imagenes:gallina/gallina_vuela_3",figura:"circulo",figura_radio:30,figura_sin_rotacion:!0,figura_dinamica:!0,figura_rebote:0},e}return __extends(e,t),e.prototype.iniciar=function(){this.crear_animacion("gallina_vuela",["imagenes:gallina/gallina_vuela_1","imagenes:gallina/gallina_vuela_1","imagenes:gallina/gallina_vuela_2","imagenes:gallina/gallina_vuela_3","imagenes:gallina/gallina_vuela_2"],15),this.crear_animacion("gallina_muere",["imagenes:gallina/gallina_muere"],20),this.crear_animacion("gallina_sin_piel",["imagenes:gallina/gallina_sin_piel"],20),this.estado="vuela"},e.prototype.actualizar=function(){},e.prototype.vuela_iniciar=function(){this.reproducir_animacion("gallina_vuela")},e.prototype.vuela_actualizar=function(){},e.prototype.vuela_cuando_comienza_una_colision=function(t){},e}(Actor),golpe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"",imagen:"imagenes:efectos/golpe-3",etiqueta:"golpe"},e}return __extends(e,t),e.prototype.iniciar=function(){this.animacion="golpe"},e.prototype.actualizar=function(){},e.prototype.cuando_finaliza_animacion=function(t){this.eliminar()},e}(Actor),humo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"",imagen:"imagenes:efectos/humo-03",etiqueta:"humo"},e}return __extends(e,t),e.prototype.iniciar=function(){this.animacion="humo"},e.prototype.actualizar=function(){},e.prototype.cuando_finaliza_animacion=function(t){this.eliminar()},e}(Actor),interruptor_de_gravedad=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/interruptor-si",rotacion:-90,z:-100},e}return __extends(e,t),e.prototype.actualizar=function(){},e.prototype.cuando_hace_click=function(){this.pilas.fisica.gravedad_y*=-1,"imagenes:botones/interruptor-no"==this.imagen?this.imagen="imagenes:botones/interruptor-si":this.imagen="imagenes:botones/interruptor-no"},e}(Actor),laser=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:disparos/laser",etiqueta:"laser",figura:"rectangulo",figura_ancho:38,figura_alto:12,figura_dinamica:!1,figura_rebote:0},e}return __extends(e,t),e.prototype.iniciar=function(){this.centro_x=.3,this.velocidad=10,this.pilas.reproducir_sonido("laser")},e.prototype.actualizar=function(){this.avanzar(this.rotacion,this.velocidad),this.eliminar_si_sale_de_la_pantalla()},e.prototype.eliminar_si_sale_de_la_pantalla=function(){var t=this.pilas.camara.borde_izquierdo,e=this.pilas.camara.borde_derecho,i=this.pilas.camara.borde_arriba,a=this.pilas.camara.borde_abajo;(this.x>e||this.x<t||this.y>i||this.y<a)&&this.eliminar()},e}(Actor),logo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/logo"},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),moneda=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:objetos/moneda",etiqueta:"moneda",figura:"circulo",figura_radio:10,figura_dinamica:!1,figura_sensor:!0},e}return __extends(e,t),e.prototype.iniciar=function(){this.animacion="moneda"},e}(Actor),nave=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:nave/nave_reposo"},e.velocidad=5,e}return __extends(e,t),e.prototype.iniciar=function(){this.animacion="nave_en_reposo",this.cuadros_desde_el_ultimo_disparo=0},e.prototype.actualizar=function(){this.cuadros_desde_el_ultimo_disparo+=1,this.pilas.control.izquierda&&(this.rotacion+=this.velocidad,this.animacion="nave_girando_a_la_izquierda"),this.pilas.control.derecha&&(this.rotacion-=this.velocidad,this.animacion="nave_girando_a_la_derecha"),this.pilas.control.espacio&&this.cuadros_desde_el_ultimo_disparo>5&&this.disparar(),this.pilas.control.arriba?(this.avanzar(this.rotacion,this.velocidad),this.animacion="nave_avanzando"):this.pilas.control.izquierda||this.pilas.control.derecha||(this.animacion="nave_en_reposo")},e.prototype.disparar=function(){var t=this.pilas.actores.laser()
t.x=this.x,t.y=this.y,t.rotacion=this.rotacion,t.z=this.z+1,this.cuadros_desde_el_ultimo_disparo=0},e}(Actor),nube=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"decoracion:objetos/nube"},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),nube_animada=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"decoracion:objetos/decoracion_nube_1",z:30},e}return __extends(e,t),e.prototype.iniciar=function(){this.z=50,this.velocidad=2},e.prototype.actualizar=function(){this.x-=this.velocidad,this.x<-400&&(this.x=400,this.y=this.pilas.azar(-200,200))},e}(Actor),pantalla_completa=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:botones/pantalla-completa",es_texto:!1,z:-10,transparencia:50},e}return __extends(e,t),e.prototype.iniciar=function(){this.transparencia=50},e.prototype.cuando_hace_click=function(){this.pilas.alternar_modo_pantalla_completa()},e.prototype.cuando_mueve=function(){this.transparencia=0},e.prototype.cuando_sale=function(){this.transparencia=0},e}(Actor),pared=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"rectangulo",imagen:"imagenes:plataformas/pared",y:0,figura_ancho:20,figura_alto:600,figura_dinamica:!1,figura_rebote:0},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),pelota=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:objetos/pelota",figura:"circulo",figura_radio:25},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),pizarra=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/sin_imagen"},e}return __extends(e,t),e.prototype.iniciar=function(){t.prototype.iniciar.call(this),this.imagen="imagenes:basicos/invisible",this.limpiar()
var e=this.pilas.colores.generar(255,100,0)
this.dibujar_circulo(100,0,40,e),this.dibujar_borde_de_circulo(100,0,40,"negro",2),this.dibujar_circulo(100,100,20,"amarillo"),this.dibujar_borde_de_circulo(100,100,20,"negro",2),this.dibujar_rectangulo(-50,-50,40,90,"verde"),this.dibujar_borde_de_rectangulo(-50,-50,40,90,"negro",2),this.dibujar_linea(-100,0,200,200,"rojo",6)},e.prototype.actualizar=function(){},e}(PizarraBase),plataforma=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"rectangulo",imagen:"imagenes:plataformas/plataforma",etiqueta:"plataforma",y:0,figura_ancho:250,figura_alto:40,figura_dinamica:!1,figura_rebote:0},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),puntaje=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/invisible",texto:"PUNTAJE: 0",es_texto:!0,z:-10,fuente:"color-blanco-con-sombra-chico"},e.puntaje=0,e}return __extends(e,t),e.prototype.iniciar=function(){this.actualizar_texto(),this.fijo=!0},e.prototype.aumentar=function(t){void 0===t&&(t=1),this.puntaje+=t,this.actualizar_texto()},e.prototype.actualizar_texto=function(){this.texto="PUNTAJE: "+this.puntaje},e}(ActorTextoBase),reiniciar_escena=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/invisible",fondo:"imagenes:redimensionables/gris",texto:"Reiniciar escena",es_texto:!0,z:-10,fuente:"color-negro"},e}return __extends(e,t),e.prototype.iniciar=function(){this.fijo=!0},e.prototype.cuando_hace_click=function(){this.pilas.reiniciar_escena()},e.prototype.cuando_mueve=function(){this.pilas.definir_cursor("pointer")},e.prototype.cuando_sale=function(){this.pilas.definir_cursor("normal")},e}(ActorTextoBase),robot=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:objetos/robot",centro_y:1},e}return __extends(e,t),e.prototype.iniciar=function(){this.imagen="imagenes:basicos/invisible",this.contenedor=this.pilas.modo.add.container(),this.huesos=new Huesos(this.pilas,"robot","atlas-robot",this.contenedor),this.huesos.definir_animacion("run")},e.prototype.actualizar=function(){this.huesos.actualizar_animacion(20)},e.prototype.pre_actualizar=function(){this.pilas.utilidades.sincronizar_contenedor(this.contenedor,this.sprite)},e}(Actor),suelo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"rectangulo",imagen:"imagenes:plataformas/suelo",figura_ancho:600,figura_alto:25,figura_rebote:0,figura_dinamica:!1},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),techo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={figura:"rectangulo",imagen:"imagenes:plataformas/techo",figura_ancho:600,figura_alto:25,figura_dinamica:!1},e}return __extends(e,t),e.prototype.iniciar=function(){},e}(Actor),texto=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.propiedades={imagen:"imagenes:basicos/invisible",texto:"Hola mundo",es_texto:!0,z:-10,fuente:"color-blanco-con-sombra"},e}return __extends(e,t),e}(ActorTextoBase),EscenaBase=function(){function t(t){this._gravedad_x=0,this._gravedad_y=1,this.pilas=t,this.actores=[],this.animaciones_pendientes_de_ejecucion=[],this.animaciones_en_ejecucion=[],this.pilas.utilidades.obtener_id_autoincremental(),this.camara=new Camara(t),this.pilas.escenas.definir_escena_actual(this),this.control=new Control(t),this.eventos=new EventosDeEscena(t),this._observables=null,this._sonidos_para_reproducir=[],this._sonidos_en_reproduccion={},this.desplazamiento_del_fondo_x=0,this.desplazamiento_del_fondo_y=0}return t.prototype.crear_animacion=function(t,e,i,a){var o=new AnimacionDePropiedad(this.pilas,t,e,i,a)
return this.animaciones_pendientes_de_ejecucion.push(o),o},t.prototype.crear_animacion_nula=function(){return new AnimacionNula},t.prototype.eliminar_animaciones_del_actor=function(t){this.animaciones_en_ejecucion.map((function(e){e.actor===t&&e.timeline.stop()}))},t.prototype.reproducir_sonido=function(t){return this.pilas.reproducir_sonido(t)},t.prototype.reproducir_musica=function(t){return this.pilas.reproducir_musica(t)},t.prototype.detener_musica=function(){return this.pilas.detener_musica()},t.prototype.planificar_reproducir_sonido=function(t){this._sonidos_para_reproducir.push(t)},t.prototype.observar=function(t,e){if(null===this._observables){this._actor_visor_observables=this.pilas.actores.texto(),this._actor_visor_observables.fijo=!0,this._actor_visor_observables.centro_x=0,this._actor_visor_observables.centro_y=0,this._actor_visor_observables.x=10-this.pilas._ancho/2,this._actor_visor_observables.y=this.pilas._alto/2-10,this._observables={}
var i=this
this._actor_visor_observables.actualizar=function(){var t=JSON.stringify(i._observables,null,4).replace(/^{|}$|"/g,"").replace(/,\n/g,"\n").replace(/ {4}/g,"").trim()
this.texto=t},this._actor_visor_observables.actualizar()}"number"!=typeof e||Number.isInteger(e)?this._observables[t]=""+this.convertir_a_string(e):this._observables[t]=e.toFixed(2)},t.prototype.convertir_a_string=function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(this.convertir_a_string(t[i]))
return"[ "+e.join(", ")+" ]"}if(null===t)return"null"
if(void 0===t)return"undefined"
if(""+t=="[object Object]"){var a=Object.entries(t)
if(a.length>8)return"<Objeto>"
var o=[]
for(i=0;i<a.length;i++){var r=a[i][0],n=a[i][1]
o.push(r+": "+this.convertir_a_string(n))}return"{ "+o.join(", ")+" }"}return"number"==typeof t?t.toFixed(2):t},t.prototype.agregar_actor=function(t){this.actores.push(t)},Object.defineProperty(t.prototype,"gravedad_x",{get:function(){return this._gravedad_x},set:function(t){this._gravedad_x=t,this.actualizar_gravedad()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gravedad_y",{get:function(){return this._gravedad_y},set:function(t){this._gravedad_y=t,this.actualizar_gravedad()},enumerable:!1,configurable:!0}),t.prototype.actualizar_gravedad=function(){this.pilas.modo.matter.world.setGravity(this._gravedad_x,this._gravedad_y)},t.prototype.obtener_nombre_para=function(t){for(var e=this.actores.map((function(t){return t.nombre})).filter((function(e){return e.startsWith(t)})),i=1,a=t;e.indexOf(a)>-1;)a=t+(i+=1)
return a},t.prototype.serializar=function(){return{camara_x:this.camara.x,camara_y:this.camara.y,ancho:this.ancho,alto:this.alto,fondo:this.fondo,desplazamiento_del_fondo_x:this.desplazamiento_del_fondo_x,desplazamiento_del_fondo_y:this.desplazamiento_del_fondo_y}},t.prototype.pre_actualizar=function(){},t.prototype.actualizar=function(){},t.prototype.iniciar_animaciones_pendientes=function(){var t=this
this.animaciones_pendientes_de_ejecucion.length>0&&(this.animaciones_pendientes_de_ejecucion.map((function(e){e.ejecutar(),t.animaciones_en_ejecucion.push(e)})),this.animaciones_pendientes_de_ejecucion=[])},t.prototype.actualizar_actores=function(){var t=this,e=[]
this.actores.map((function(i){try{if(!i._vivo)return i.sprite.destroy(),i._canvas&&i._canvas.destroy(),i.sensores.map((function(e){t.pilas.modo.matter.world.remove(e)})),i._texto&&i._texto.destroy(),i._fondo&&i._fondo.destroy(),void e.push(i)
t.actualizar_actor(i),i._bloques_actualizar&&i._bloques_actualizar()}catch(a){throw t.pilas.mensajes.emitir_excepcion_al_editor(a,"actualizando actores"),Error(a)}})),e.map((function(e){t.quitar_actor_luego_de_eliminar(e)}))},t.prototype.actualizar_actor=function(t){try{t.pre_actualizar(),t.actualizar_habilidades(),t.actualizar(),t.actualizar_sensores()}catch(e){throw this.pilas.mensajes.emitir_excepcion_al_editor(e,'actualizando al actor "'+t.nombre+'"'),Error(e)}},t.prototype.reproducir_sonidos_pendientes=function(){var t=this,e=this._sonidos_para_reproducir
e=e.filter((function(t,i){return e.indexOf(t)===i}))
for(var i,a=function(a){var r=e[a]
o._sonidos_en_reproduccion[r]||(o._sonidos_en_reproduccion[r]=0),o._sonidos_en_reproduccion[r]<20&&(o._sonidos_en_reproduccion[r]+=1,(i=o.pilas.modo.sound.add(r)).play(),i.once("complete",(function(e){t._sonidos_en_reproduccion[r]-=1,t.pilas.mensajes.emitir_mensaje_al_editor("termina_de_reproducir_sonido",{sonido:r})})))},o=this,r=0;r<e.length;r++)a(r)
this._sonidos_para_reproducir=[]},t.prototype.avisar_click_en_la_pantalla_a_los_actores=function(t,e,i){var a=this
this.actores.map((function(o){try{o.cuando_hace_click_en_la_pantalla(t,e,i),o._bloques_cuando_hace_click_en_la_pantalla(t,e,i)}catch(r){a.pilas.mensajes.emitir_excepcion_al_editor(r,"avisando click de pantalla")}}))},t.prototype.avisar_cuando_termina_de_hacer_click_en_la_pantalla_a_los_actores=function(t,e,i){var a=this
this.actores.map((function(o){try{o.cuando_termina_de_hacer_click_en_la_pantalla(t,e,i)}catch(r){a.pilas.mensajes.emitir_excepcion_al_editor(r,"avisando click de pantalla")}}))},t.prototype.avisar_cuando_pulsa_tecla_a_los_actores=function(t,e){var i=this
this.actores.map((function(a){try{a.cuando_pulsa_tecla(t,e),a.automata.cuando_pulsa_tecla(t,e)}catch(a){i.pilas.mensajes.emitir_excepcion_al_editor(a,"avisando que pulsan tecla")}}))},t.prototype.avisar_cuando_mueve_a_todos_los_actores=function(t,e,i){var a=this
this.actores.map((function(o){try{o.cuando_mueve_sobre_la_pantalla(t,e,i),o.automata.cuando_mueve_sobre_la_pantalla(t,e,i)}catch(o){a.pilas.mensajes.emitir_excepcion_al_editor(o,"avisando que mueven el mouse sobre toda la pantalla")}}))},t.prototype.avisar_cuando_suelta_tecla_a_los_actores=function(t,e){var i=this
this.actores.map((function(a){try{a.cuando_suelta_tecla(t,e)}catch(a){i.pilas.mensajes.emitir_excepcion_al_editor(a,"avisando que pulsan tecla")}}))},t.prototype.quitar_actor_luego_de_eliminar=function(t){var e=this.actores.indexOf(t),i=t.id
if(-1===e)throw Error("Se intentó eliminar un actor inexistente en la escena: id="+i+" etiqueta="+t.etiqueta+".")
this.actores.splice(e,1)},t.prototype.terminar=function(){var t=this
this.actores.map((function(e){try{e.eliminar()}catch(e){t.pilas.mensajes.emitir_excepcion_al_editor(e,"eliminando actores")}})),this.actualizar(),this.actualizar_actores(),this.control.terminar()},t.prototype.cuando_hace_click=function(t,e,i){},t.prototype.cuando_mueve=function(t,e,i){},t.prototype.cuando_termina_de_hacer_click=function(t,e,i){},t.prototype.cada_segundo=function(t){},t.prototype.cuando_transcurre_un_segundo=function(t){},t.prototype.cuando_pulsa_tecla=function(t,e){},t.prototype.cuando_suelta_tecla=function(t,e){},t.prototype.enviar_mensaje=function(t,e){void 0===e&&(e={}),this.cuando_llega_un_mensaje(t,e),this["cuando_llega_el_mensaje_"+t]&&this["cuando_llega_el_mensaje_"+t](e)},t.prototype._bloques_al_actualizar=function(){},t.prototype._bloques_cada_segundo=function(t){},t.prototype.cuando_llega_un_mensaje=function(t,e){void 0===e&&(e={})},t}(),Escena=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.cuadro=-1,e}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.pre_actualizar=function(){if(this.cuadro+=1,this.cuadro>0&&this.cuadro%60==0){var t=Math.floor(this.cuadro/60)
this.cada_segundo(t),this._bloques_cada_segundo&&this._bloques_cada_segundo(t),this.cuando_transcurre_un_segundo(t),this.actores.map((function(e){e.cada_segundo(t),e.cuando_transcurre_un_segundo(t),e._bloques_cada_segundo(t)}))}},e.prototype.obtener_oscilacion=function(t,e){return Math.sin(this.cuadro*t*.1)*e},e}(EscenaBase),Normal=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.iniciar=function(){},e.prototype.actualizar=function(){},e}(Escena)
function loadBool(t,e,i){var a=t[e]
switch(typeof a){case"string":return"true"===a
case"boolean":return a
default:return i||!1}}function saveBool(t,e,i,a){"boolean"==typeof a&&i===a||(t[e]=i)}function loadFloat(t,e,i){var a=t[e]
switch(typeof a){case"string":return parseFloat(a)
case"number":return a
default:return i||0}}function saveFloat(t,e,i,a){"number"==typeof a&&i===a||(t[e]=i)}function loadInt(t,e,i){var a=t[e]
switch(typeof a){case"string":return parseInt(a,10)
case"number":return 0|a
default:return i||0}}function saveInt(t,e,i,a){"number"==typeof a&&i===a||(t[e]=i)}function loadString(t,e,i){var a=t[e]
switch(typeof a){case"string":return a
default:return i||""}}function saveString(t,e,i,a){"string"==typeof a&&i===a||(t[e]=i)}function makeArray(t){return"object"==typeof t&&"number"==typeof t.length?t:void 0!==t?[t]:[]}function wrap(t,e,i){return e<i?t<e?i-(e-t)%(i-e):e+(t-e)%(i-e):e===i?e:t}function interpolateLinear(t,e,i){return t+(e-t)*i}function interpolateQuadratic(t,e,i,a){return interpolateLinear(interpolateLinear(t,e,a),interpolateLinear(e,i,a),a)}function interpolateCubic(t,e,i,a,o){return interpolateLinear(interpolateQuadratic(t,e,i,o),interpolateQuadratic(e,i,a,o),o)}function interpolateQuartic(t,e,i,a,o,r){return interpolateLinear(interpolateCubic(t,e,i,a,r),interpolateCubic(e,i,a,o,r),r)}function interpolateQuintic(t,e,i,a,o,r,n){return interpolateLinear(interpolateQuartic(t,e,i,a,o,n),interpolateQuartic(e,i,a,o,r,n),n)}function interpolateBezier(t,e,i,a,o){function r(t,e,i,a){return((t*a+e)*a+i)*a}function n(t,e,i,a){return(3*t*a+2*e)*a+i}var s=3*t,c=3*(i-t)-s,l=3*e,p=3*(a-e)-l
return function(t,e,i,a,o,s,c,l){return r(a,o,s,function(t,e,i,a,o){var s,c,l,p,_,u
for(l=a,u=0;u<8;u++){if(p=r(t,e,i,l)-a,Math.abs(p)<o)return l
if(_=n(t,e,i,l),Math.abs(_)<o)break
l-=p/_}if(c=1,(l=a)<(s=0))return s
if(l>c)return c
for(;s<c;){if(p=r(t,e,i,l),Math.abs(p-a)<o)return l
a>p?s=l:c=l,l=.5*(c-s)+s}return l}(t,e,i,c,l))}(1-s-c,c,s,1-l-p,p,l,o,function(t){return 1/(200*t)}(1))}function tween(t,e,i){return t+(e-t)*i}function wrapAngleRadians(t){return t<=0?(t-Math.PI)%(2*Math.PI)+Math.PI:(t+Math.PI)%(2*Math.PI)-Math.PI}function tweenAngleRadians(t,e,i,a){return 0===a?t:(a>0?e-t<0&&(e+=2*Math.PI):a<0&&e-t>0&&(e-=2*Math.PI),wrapAngleRadians(t+wrapAngleRadians(e-t)*i))}var Angle=function(){function t(t){void 0===t&&(t=0),this.rad=0,this.rad=t}return Object.defineProperty(t.prototype,"deg",{get:function(){return 180*this.rad/Math.PI},set:function(t){this.rad=t*Math.PI/180},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cos",{get:function(){return Math.cos(this.rad)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sin",{get:function(){return Math.sin(this.rad)},enumerable:!1,configurable:!0}),t.prototype.selfIdentity=function(){return this.rad=0,this},t.prototype.copy=function(t){return this.rad=t.rad,this},t.add=function(e,i,a){return void 0===a&&(a=new t),a.rad=wrapAngleRadians(e.rad+i.rad),a},t.prototype.add=function(e,i){return void 0===i&&(i=new t),t.add(this,e,i)},t.prototype.selfAdd=function(e){return t.add(this,e,this)},t.tween=function(e,i,a,o,r){return void 0===r&&(r=new t),r.rad=tweenAngleRadians(e.rad,i.rad,a,o),r},t.prototype.tween=function(e,i,a,o){return void 0===o&&(o=new t),t.tween(this,e,i,a,o)},t.prototype.selfTween=function(e,i,a){return t.tween(this,e,i,a,this)},t}(),Vector=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.equal=function(t,e,i){return void 0===i&&(i=1e-6),!(Math.abs(t.x-e.x)>i)&&!(Math.abs(t.y-e.y)>i)},t.add=function(e,i,a){return void 0===a&&(a=new t),a.x=e.x+i.x,a.y=e.y+i.y,a},t.prototype.add=function(e,i){return void 0===i&&(i=new t),t.add(this,e,i)},t.prototype.selfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},t.tween=function(e,i,a,o){return void 0===o&&(o=new t),o.x=tween(e.x,i.x,a),o.y=tween(e.y,i.y,a),o},t.prototype.tween=function(e,i,a){return void 0===a&&(a=new t),t.tween(this,e,i,a)},t.prototype.selfTween=function(e,i){return t.tween(this,e,i,this)},t}(),Position=function(t){function e(){return t.call(this,0,0)||this}return __extends(e,t),e}(Vector),Rotation=function(t){function e(){return t.call(this,0)||this}return __extends(e,t),e}(Angle),Scale=function(t){function e(){return t.call(this,1,1)||this}return __extends(e,t),e.prototype.selfIdentity=function(){return this.x=1,this.y=1,this},e}(Vector),Pivot=function(t){function e(){return t.call(this,0,1)||this}return __extends(e,t),e.prototype.selfIdentity=function(){return this.x=0,this.y=1,this},e}(Vector),Space=function(){function t(){this.position=new Position,this.rotation=new Rotation,this.scale=new Scale}return t.prototype.copy=function(t){return this.position.copy(t.position),this.rotation.copy(t.rotation),this.scale.copy(t.scale),this},t.prototype.load=function(t){return this.position.x=loadFloat(t,"x",0),this.position.y=loadFloat(t,"y",0),this.rotation.deg=loadFloat(t,"angle",0),this.scale.x=loadFloat(t,"scale_x",1),this.scale.y=loadFloat(t,"scale_y",1),this},t.equal=function(t,e,i){return void 0===i&&(i=1e-6),!(Math.abs(t.position.x-e.position.x)>i)&&(!(Math.abs(t.position.y-e.position.y)>i)&&(!(Math.abs(t.rotation.rad-e.rotation.rad)>i)&&(!(Math.abs(t.scale.x-e.scale.x)>i)&&!(Math.abs(t.scale.y-e.scale.y)>i))))},t.identity=function(e){return void 0===e&&(e=new t),e.position.x=0,e.position.y=0,e.rotation.rad=0,e.scale.x=1,e.scale.y=1,e},t.translate=function(t,e,i){e*=t.scale.x,i*=t.scale.y
var a=t.rotation.rad,o=Math.cos(a),r=Math.sin(a),n=o*e-r*i,s=r*e+o*i
return t.position.x+=n,t.position.y+=s,t},t.rotate=function(t,e){return t.rotation.rad=wrapAngleRadians(t.rotation.rad+e),t},t.scale=function(t,e,i){return t.scale.x*=e,t.scale.y*=i,t},t.invert=function(e,i){i=i||new t
var a=1/e.scale.x,o=1/e.scale.y,r=-e.rotation.rad,n=-e.position.x,s=-e.position.y
i.scale.x=a,i.scale.y=o,i.rotation.rad=r
var c=n,l=s,p=r,_=Math.cos(p),u=Math.sin(p),d=_*c-u*l,h=u*c+_*l
return i.position.x=d*a,i.position.y=h*o,i},t.combine=function(e,i,a){a=a||new t
var o=i.position.x*e.scale.x,r=i.position.y*e.scale.y,n=e.rotation.rad,s=Math.cos(n),c=Math.sin(n),l=s*o-c*r,p=c*o+s*r
return a.position.x=l+e.position.x,a.position.y=p+e.position.y,e.scale.x*e.scale.y<0?a.rotation.rad=wrapAngleRadians(e.rotation.rad-i.rotation.rad):a.rotation.rad=wrapAngleRadians(i.rotation.rad+e.rotation.rad),a.scale.x=i.scale.x*e.scale.x,a.scale.y=i.scale.y*e.scale.y,a},t.extract=function(e,i,a){(a=a||new t).scale.x=e.scale.x/i.scale.x,a.scale.y=e.scale.y/i.scale.y,i.scale.x*i.scale.y<0?a.rotation.rad=wrapAngleRadians(i.rotation.rad+e.rotation.rad):a.rotation.rad=wrapAngleRadians(e.rotation.rad-i.rotation.rad)
var o=e.position.x-i.position.x,r=e.position.y-i.position.y,n=-i.rotation.rad,s=Math.cos(n),c=Math.sin(n),l=s*o-c*r,p=c*o+s*r
return a.position.x=l/i.scale.x,a.position.y=p/i.scale.y,a},t.transform=function(t,e,i){i=i||new Vector
var a=e.x*t.scale.x,o=e.y*t.scale.y,r=t.rotation.rad,n=Math.cos(r),s=Math.sin(r),c=n*a-s*o,l=s*a+n*o
return i.x=c+t.position.x,i.y=l+t.position.y,i},t.untransform=function(t,e,i){i=i||new Vector
var a=e.x-t.position.x,o=e.y-t.position.y,r=-t.rotation.rad,n=Math.cos(r),s=Math.sin(r),c=n*a-s*o,l=s*a+n*o
return i.x=c/t.scale.x,i.y=l/t.scale.y,i},t.tween=function(t,e,i,a,o){return o.position.x=tween(t.position.x,e.position.x,i),o.position.y=tween(t.position.y,e.position.y,i),o.rotation.rad=tweenAngleRadians(t.rotation.rad,e.rotation.rad,i,a),o.scale.x=tween(t.scale.x,e.scale.x,i),o.scale.y=tween(t.scale.y,e.scale.y,i),o},t}(),Element=function(){function t(){this.id=-1,this.name=""}return t.prototype.load=function(t){return this.id=loadInt(t,"id",-1),this.name=loadString(t,"name",""),this},t}(),File=function(t){function e(e){var i=t.call(this)||this
return i.type="unknown",i.type=e,i}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=loadString(e,"type","image")
if(this.type!==i)throw new Error
return this},e}(Element),ImageFile=function(t){function e(){var e=t.call(this,"image")||this
return e.width=0,e.height=0,e.pivot=new Pivot,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.width=loadInt(e,"width",0),this.height=loadInt(e,"height",0),this.pivot.x=loadFloat(e,"pivot_x",0),this.pivot.y=loadFloat(e,"pivot_y",1),this},e}(File),SoundFile=function(t){function e(){return t.call(this,"sound")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e}(File),Folder=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.file_array=[],e}return __extends(e,t),e.prototype.load=function(e){var i=this
return t.prototype.load.call(this,e),this.file_array=[],e.file=makeArray(e.file),e.file.forEach((function(t){switch(t.type){case"image":default:i.file_array.push((new ImageFile).load(t))
break
case"sound":i.file_array.push((new SoundFile).load(t))}})),this},e}(Element),BaseObject=function(){function t(t){this.type="unknown",this.name="",this.type=t}return t.prototype.load=function(t){var e=loadString(t,"type","sprite")
if(this.type!==e)throw new Error
return this},t}(),SpriteObject=function(t){function e(){var e=t.call(this,"sprite")||this
return e.parent_index=-1,e.folder_index=-1,e.file_index=-1,e.local_space=new Space,e.world_space=new Space,e.default_pivot=!1,e.pivot=new Pivot,e.z_index=0,e.alpha=1,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=loadInt(e,"parent",-1),this.folder_index=loadInt(e,"folder",-1),this.file_index=loadInt(e,"file",-1),this.local_space.load(e),this.world_space.copy(this.local_space),void 0!==e.pivot_x||void 0!==e.pivot_y?(this.pivot.x=loadFloat(e,"pivot_x",0),this.pivot.y=loadFloat(e,"pivot_y",1)):this.default_pivot=!0,this.z_index=99,this.alpha=loadFloat(e,"a",1),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.folder_index=t.folder_index,this.file_index=t.file_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.default_pivot=t.default_pivot,this.pivot.copy(t.pivot),this.z_index=t.z_index,this.alpha=t.alpha,this},e.prototype.tween=function(t,e,i){Space.tween(this.local_space,t.local_space,e,i,this.local_space),this.default_pivot||Vector.tween(this.pivot,t.pivot,e,this.pivot),this.alpha=tween(this.alpha,t.alpha,e)},e}(BaseObject),Bone=function(t){function e(){var e=t.call(this,"bone")||this
return e.parent_index=-1,e.local_space=new Space,e.world_space=new Space,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=loadInt(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this},e.prototype.tween=function(t,e,i){Space.tween(this.local_space,t.local_space,e,i,this.local_space)},e}(BaseObject),BoxObject=function(t){function e(){var e=t.call(this,"box")||this
return e.parent_index=-1,e.local_space=new Space,e.world_space=new Space,e.pivot=new Pivot,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=loadInt(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this.pivot.x=loadFloat(e,"pivot_x",0),this.pivot.y=loadFloat(e,"pivot_y",1),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.pivot.copy(t.pivot),this},e.prototype.tween=function(t,e,i){Space.tween(this.local_space,t.local_space,e,i,this.local_space)},e}(BaseObject),PointObject=function(t){function e(){var e=t.call(this,"point")||this
return e.parent_index=-1,e.local_space=new Space,e.world_space=new Space,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=loadInt(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this},e.prototype.tween=function(t,e,i){Space.tween(this.local_space,t.local_space,e,i,this.local_space)},e}(BaseObject),SoundObject=function(t){function e(){var e=t.call(this,"sound")||this
return e.folder_index=-1,e.file_index=-1,e.trigger=!1,e.volume=1,e.panning=0,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.folder_index=loadInt(e,"folder",-1),this.file_index=loadInt(e,"file",-1),this.trigger=loadBool(e,"trigger",!1),this.volume=loadFloat(e,"volume",1),this.panning=loadFloat(e,"panning",0),this},e.prototype.copy=function(t){return this.folder_index=t.folder_index,this.file_index=t.file_index,this.trigger=t.trigger,this.volume=t.volume,this.panning=t.panning,this},e.prototype.tween=function(t,e,i){this.volume=tween(this.volume,t.volume,e),this.panning=tween(this.panning,t.panning,e)},e}(BaseObject),EntityObject=function(t){function e(){var e=t.call(this,"entity")||this
return e.parent_index=-1,e.local_space=new Space,e.world_space=new Space,e.entity_index=-1,e.animation_index=-1,e.animation_time=0,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=loadInt(e,"parent",-1),this.local_space.load(e),this.world_space.copy(this.local_space),this.entity_index=loadInt(e,"entity",-1),this.animation_index=loadInt(e,"animation",-1),this.animation_time=loadFloat(e,"t",0),this},e.prototype.copy=function(t){return this.parent_index=t.parent_index,this.local_space.copy(t.local_space),this.world_space.copy(t.world_space),this.entity_index=t.entity_index,this.animation_index=t.animation_index,this.animation_time=t.animation_time,this},e.prototype.tween=function(t,e,i){Space.tween(this.local_space,t.local_space,e,i,this.local_space),this.animation_time=tween(this.animation_time,t.animation_time,e)},e}(BaseObject),VariableObject=function(t){function e(){return t.call(this,"variable")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e.prototype.copy=function(t){return this},e.prototype.tween=function(t,e,i){},e}(BaseObject),Ref=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.parent_index=-1,e.timeline_index=-1,e.keyframe_index=-1,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.parent_index=loadInt(e,"parent",-1),this.timeline_index=loadInt(e,"timeline",-1),this.keyframe_index=loadInt(e,"key",-1),this},e}(Element),BoneRef=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Ref),ObjectRef=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.z_index=0,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.z_index=loadInt(e,"z_index",0),this},e}(Ref),Keyframe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.time=0,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.time=loadInt(e,"time",0),this},e.find=function(t,e){if(t.length<=0)return-1
if(e<t[0].time)return-1
var i=t.length-1
if(e>=t[i].time)return i
var a=0,o=i
if(0===o)return 0
for(var r=o>>1;;){if(t[r+1].time<=e?a=r+1:o=r,a===o)return a
r=a+o>>1}},e.compare=function(t,e){return t.time-e.time},e}(Element),Curve=function(){function t(){this.type="linear",this.c1=0,this.c2=0,this.c3=0,this.c4=0}return t.prototype.load=function(t){return this.type=loadString(t,"curve_type","linear"),this.c1=loadFloat(t,"c1",0),this.c2=loadFloat(t,"c2",0),this.c3=loadFloat(t,"c3",0),this.c4=loadFloat(t,"c4",0),this},t.prototype.evaluate=function(t){switch(this.type){case"instant":return 0
case"linear":return t
case"quadratic":return interpolateQuadratic(0,this.c1,1,t)
case"cubic":return interpolateCubic(0,this.c1,this.c2,1,t)
case"quartic":return interpolateQuartic(0,this.c1,this.c2,this.c3,1,t)
case"quintic":return interpolateQuintic(0,this.c1,this.c2,this.c3,this.c4,1,t)
case"bezier":return interpolateBezier(this.c1,this.c2,this.c3,this.c4,t)}return 0},t}(),MainlineKeyframe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.curve=new Curve,e}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.curve.load(e),i.bone_ref_array=[],e.bone_ref=makeArray(e.bone_ref),e.bone_ref.forEach((function(t){i.bone_ref_array.push((new BoneRef).load(t))})),i.bone_ref_array.sort((function(t,e){return t.id-e.id})),i.object_ref_array=[],e.object_ref=makeArray(e.object_ref),e.object_ref.forEach((function(t){i.object_ref_array.push((new ObjectRef).load(t))})),i.object_ref_array.sort((function(t,e){return t.id-e.id})),i},e}(Keyframe),Mainline=function(){function t(){}return t.prototype.load=function(t){var e=this
return e.keyframe_array=[],t.key=makeArray(t.key),t.key.forEach((function(t){e.keyframe_array.push((new MainlineKeyframe).load(t))})),e.keyframe_array.sort(Keyframe.compare),e},t}(),TimelineKeyframe=function(t){function e(e){var i=t.call(this)||this
return i.type="unknown",i.spin=1,i.curve=new Curve,i.type=e,i}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.spin=loadInt(e,"spin",1),this.curve.load(e),this},e}(Keyframe),SpriteTimelineKeyframe=function(t){function e(){return t.call(this,"sprite")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.sprite=(new SpriteObject).load(e.object),this},e}(TimelineKeyframe),BoneTimelineKeyframe=function(t){function e(){return t.call(this,"bone")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.bone.type=e.bone.type||"bone",this.bone=(new Bone).load(e.bone),this},e}(TimelineKeyframe),BoxTimelineKeyframe=function(t){function e(){return t.call(this,"box")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"box",this.box=(new BoxObject).load(e.object),this},e}(TimelineKeyframe),PointTimelineKeyframe=function(t){function e(){return t.call(this,"point")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"point",this.point=(new PointObject).load(e.object),this},e}(TimelineKeyframe),SoundTimelineKeyframe=function(t){function e(){return t.call(this,"sound")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"sound",this.sound=(new SoundObject).load(e.object),this},e}(TimelineKeyframe),EntityTimelineKeyframe=function(t){function e(){return t.call(this,"entity")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"entity",this.entity=(new EntityObject).load(e.object),this},e}(TimelineKeyframe),VariableTimelineKeyframe=function(t){function e(){return t.call(this,"variable")||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"variable",this.variable=(new VariableObject).load(e.object),this},e}(TimelineKeyframe),TagDef=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.tag_index=-1,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e}(Element),Tag=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.tag_def_index=-1,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.tag_def_index=loadInt(e,"t",-1),this},e}(Element),TaglineKeyframe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.tag_array=[],e.tag=makeArray(e.tag),e.tag.forEach((function(t){i.tag_array.push((new Tag).load(t))})),this},e}(Keyframe),Tagline=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.keyframe_array=[],e}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.keyframe_array=[],e.key=makeArray(e.key),e.key.forEach((function(t){i.keyframe_array.push((new TaglineKeyframe).load(t))})),this},e}(Element),VarlineKeyframe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
switch(typeof e.val){case"number":this.val=loadFloat(e,"val",0)
break
case"string":this.val=loadString(e,"val","")}return this},e}(Keyframe),Varline=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.var_def_index=-1,e}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.var_def_index=loadInt(e,"def",-1),i.keyframe_array=[],e.key=makeArray(e.key),e.key.forEach((function(t){i.keyframe_array.push((new VarlineKeyframe).load(t))})),this},e}(Element),Meta=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.tagline=new Tagline,e.tagline&&i.tagline.load(e.tagline),i.varline_array=[],e.valline=e.valline||null,e.varline=e.varline||e.valline,e.varline&&(e.varline=makeArray(e.varline),e.varline.forEach((function(t){i.varline_array.push((new Varline).load(t))}))),this},e}(Element),Timeline=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.type="sprite",e.object_index=-1,e}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
switch(i.type=loadString(e,"object_type","sprite"),i.object_index=loadInt(e,"obj",-1),i.keyframe_array=[],e.key=makeArray(e.key),i.type){case"sprite":e.key.forEach((function(t){i.keyframe_array.push((new SpriteTimelineKeyframe).load(t))}))
break
case"bone":e.key.forEach((function(t){i.keyframe_array.push((new BoneTimelineKeyframe).load(t))}))
break
case"box":e.key.forEach((function(t){i.keyframe_array.push((new BoxTimelineKeyframe).load(t))}))
break
case"point":e.key.forEach((function(t){i.keyframe_array.push((new PointTimelineKeyframe).load(t))}))
break
case"sound":e.key.forEach((function(t){i.keyframe_array.push((new SoundTimelineKeyframe).load(t))}))
break
case"entity":e.key.forEach((function(t){i.keyframe_array.push((new EntityTimelineKeyframe).load(t))}))
break
case"variable":e.key.forEach((function(t){i.keyframe_array.push((new VariableTimelineKeyframe).load(t))}))
break
default:console.log("TODO: Timeline::load",i.type,e.key)}return i.keyframe_array.sort(Keyframe.compare),e.meta&&(i.meta=(new Meta).load(e.meta)),i},e}(Element),SoundlineKeyframe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),e.object.type=e.object.type||"sound",this.sound=(new SoundObject).load(e.object),this},e}(Keyframe),Soundline=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.keyframe_array=[],e.key=makeArray(e.key),e.key.forEach((function(t){i.keyframe_array.push((new SoundlineKeyframe).load(t))})),i.keyframe_array.sort(Keyframe.compare),this},e}(Element),EventlineKeyframe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this},e}(Keyframe),Eventline=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.keyframe_array=[],e.key=makeArray(e.key),e.key.forEach((function(t){i.keyframe_array.push((new EventlineKeyframe).load(t))})),i.keyframe_array.sort(Keyframe.compare),this},e}(Element),MapInstruction=function(){function t(){this.folder_index=-1,this.file_index=-1,this.target_folder_index=-1,this.target_file_index=-1}return t.prototype.load=function(t){return this.folder_index=loadInt(t,"folder",-1),this.file_index=loadInt(t,"file",-1),this.target_folder_index=loadInt(t,"target_folder",-1),this.target_file_index=loadInt(t,"target_file",-1),this},t}(),CharacterMap=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.map_instruction_array=[],e}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.map_instruction_array=[],e.map=makeArray(e.map),e.map.forEach((function(t){var e=(new MapInstruction).load(t)
i.map_instruction_array.push(e)})),this},e}(Element),VarDef=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){switch(t.prototype.load.call(this,e),this.type=this.default_value=loadString(e,"type",""),this.type){case"int":this.value=this.default_value=loadInt(e,"default_value",0)
break
case"float":this.value=this.default_value=loadFloat(e,"default_value",0)
break
case"string":this.value=this.default_value=loadString(e,"default_value","")}return this},e}(Element),VarDefs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
this.var_def_array=[]
var a=[]
return"object"==typeof e.i?a=makeArray(e.i):"object"==typeof e&&"number"==typeof e.length&&(a=makeArray(e)),a.forEach((function(t){i.var_def_array.push((new VarDef).load(t))})),this},e}(Element),ObjInfo=function(t){function e(e){var i=t.call(this)||this
return i.type="unknown",i.type=e,i}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.var_defs=(new VarDefs).load(e.var_defs||{}),this},e}(Element),SpriteFrame=function(){function t(){this.folder_index=-1,this.file_index=-1}return t.prototype.load=function(t){return this.folder_index=loadInt(t,"folder",-1),this.file_index=loadInt(t,"file",-1),this},t}(),SpriteObjInfo=function(t){function e(){return t.call(this,"sprite")||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.sprite_frame_array=[],e.frames=makeArray(e.frames),e.frames.forEach((function(t){i.sprite_frame_array.push((new SpriteFrame).load(t))})),this},e}(ObjInfo),BoneObjInfo=function(t){function e(){var e=t.call(this,"bone")||this
return e.w=0,e.h=0,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.w=loadInt(e,"w",0),this.h=loadInt(e,"h",0),this},e}(ObjInfo),BoxObjInfo=function(t){function e(){var e=t.call(this,"box")||this
return e.w=0,e.h=0,e}return __extends(e,t),e.prototype.load=function(e){return t.prototype.load.call(this,e),this.w=loadInt(e,"w",0),this.h=loadInt(e,"h",0),this},e}(ObjInfo),Animation=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this
return e.length=0,e.looping="true",e.loop_to=0,e.min_time=0,e.max_time=0,e}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.length=loadInt(e,"length",0),i.looping=loadString(e,"looping","true"),i.loop_to=loadInt(e,"loop_to",0),i.mainline=(new Mainline).load(e.mainline||{}),i.timeline_array=[],e.timeline=makeArray(e.timeline),e.timeline.forEach((function(t){i.timeline_array.push((new Timeline).load(t))})),i.soundline_array=[],e.soundline=makeArray(e.soundline),e.soundline.forEach((function(t){i.soundline_array.push((new Soundline).load(t))})),i.eventline_array=[],e.eventline=makeArray(e.eventline),e.eventline.forEach((function(t){i.eventline_array.push((new Eventline).load(t))})),e.meta&&(i.meta=(new Meta).load(e.meta)),i.min_time=0,i.max_time=i.length,this},e}(Element),Entity=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e)
var i=this
return i.character_map_map={},i.character_map_keys=[],e.character_map=makeArray(e.character_map),e.character_map.forEach((function(t){var e=(new CharacterMap).load(t)
i.character_map_map[e.name]=e,i.character_map_keys.push(e.name)})),this.var_defs=(new VarDefs).load(e.var_defs||{}),i.obj_info_map={},i.obj_info_keys=[],e.obj_info=makeArray(e.obj_info),e.obj_info.forEach((function(t){var e
switch(t.type){case"sprite":e=(new SpriteObjInfo).load(t)
break
case"bone":e=(new BoneObjInfo).load(t)
break
case"box":e=(new BoxObjInfo).load(t)
break
case"point":case"sound":case"entity":case"variable":default:console.log("TODO: Entity.load",t.type,t),e=new ObjInfo(t.type).load(t)}i.obj_info_map[e.name]=e,i.obj_info_keys.push(e.name)})),i.animation_map={},i.animation_keys=[],e.animation=makeArray(e.animation),e.animation.forEach((function(t){var e=(new Animation).load(t)
i.animation_map[e.name]=e,i.animation_keys.push(e.name)})),this},e}(Element),Data=function(){function t(){this.folder_array=[],this.tag_def_array=[],this.entity_map={},this.entity_keys=[]}return t.prototype.load=function(t){var e=this
loadString(t,"scon_version",""),loadString(t,"generator",""),loadString(t,"generator_version","")
return e.folder_array=[],t.folder=makeArray(t.folder),t.folder.forEach((function(t){e.folder_array.push((new Folder).load(t))})),e.tag_def_array=[],t.tag_list=makeArray(t.tag_list),t.tag_list.forEach((function(t){e.tag_def_array.push((new TagDef).load(t))})),e.entity_map={},e.entity_keys=[],t.entity=makeArray(t.entity),t.entity.forEach((function(t){var i=(new Entity).load(t)
e.entity_map[i.name]=i,e.entity_keys.push(i.name)})),e.entity_keys.forEach((function(t){var i=e.entity_map[t]
i.animation_keys.forEach((function(t){i.animation_map[t].timeline_array.forEach((function(t){t.keyframe_array.forEach((function(t){if(t instanceof SpriteTimelineKeyframe){var i=t.sprite
if(i.default_pivot){var a=e.folder_array[i.folder_index],o=a&&a.file_array[i.file_index]
o&&i.pivot.copy(o.pivot)}}}))}))}))})),this},t.prototype.getEntities=function(){return this.entity_map},t.prototype.getEntityKeys=function(){return this.entity_keys},t.prototype.getAnims=function(t){var e=this.entity_map&&this.entity_map[t]
return e?e.animation_map:{}},t.prototype.getAnimKeys=function(t){var e=this.entity_map&&this.entity_map[t]
return e?e.animation_keys:[]},t}(),Pose=function(){function t(t){this.entity_key="",this.character_map_key_array=[],this.anim_key="",this.time=0,this.elapsed_time=0,this.dirty=!0,this.bone_array=[],this.object_array=[],this.sound_array=[],this.event_array=[],this.tag_array=[],this.var_map={},this.data=t}return t.prototype.getEntities=function(){return this.data?this.data.getEntities():null},t.prototype.getEntityKeys=function(){return this.data?this.data.getEntityKeys():null},t.prototype.curEntity=function(){var t=this.data.entity_map
return t&&t[this.entity_key]},t.prototype.getEntity=function(){return this.entity_key},t.prototype.setEntity=function(t){this.entity_key!==t&&(this.entity_key=t,this.anim_key="",this.time=0,this.dirty=!0,this.bone_array=[],this.object_array=[])},t.prototype.getAnims=function(){return this.data?this.data.getAnims(this.entity_key):null},t.prototype.getAnimKeys=function(){return this.data?this.data.getAnimKeys(this.entity_key):null},t.prototype.curAnim=function(){var t=this.getAnims()
return t&&t[this.anim_key]},t.prototype.curAnimLength=function(){var t=this.data,e=t&&t.entity_map[this.entity_key],i=e&&e.animation_map[this.anim_key]
return i&&i.length||0},t.prototype.getAnim=function(){return this.anim_key},t.prototype.setAnim=function(t){if(this.anim_key!==t){this.anim_key=t
var e=this.curAnim()
e&&(this.time=wrap(this.time,e.min_time,e.max_time)),this.elapsed_time=0,this.dirty=!0}},t.prototype.getTime=function(){return this.time},t.prototype.setTime=function(t){var e=this.curAnim()
e&&(t=wrap(t,e.min_time,e.max_time)),this.time!==t&&(this.time=t,this.elapsed_time=0,this.dirty=!0)},t.prototype.update=function(t){this.elapsed_time+=t,this.dirty=!0},t.prototype.strike=function(){var e=this
if(e.dirty){e.dirty=!1
var i=e.curEntity()
e.var_map=e.var_map||{},i.var_defs.var_def_array.forEach((function(t){t.name in e.var_map||(e.var_map[t.name]=t.default_value)}))
var a=e.curAnim(),o=e.time,r=e.elapsed_time
e.time=e.time+e.elapsed_time,e.elapsed_time=0
var n=!1,s=!1
a&&(n=r<0&&e.time<=a.min_time,s=r>0&&e.time>=a.max_time,e.time=wrap(e.time,a.min_time,a.max_time))
var c=e.time
if(a){var l=a.mainline.keyframe_array,p=Keyframe.find(l,c),_=(p+1)%l.length,u=l[p],d=l[_],h=u.time,f=d.time
f<h&&(f=a.length)
var m=c
if(h!==f){var y=(c-h)/(f-h)
y=u.curve.evaluate(y),m=tween(h,f,y)}var b=a.timeline_array,g=u.bone_ref_array,v=e.bone_array
g.forEach((function(t,e){var i=t.timeline_index,o=b[i],r=o.keyframe_array,n=t.keyframe_index,s=(n+1)%r.length,c=r[n],l=r[s],p=c.time,_=l.time
_<p&&(_=a.length)
var u=0
p!==_&&(u=(m-p)/(_-p),u=c.curve.evaluate(u))
var d=v[e]=v[e]||new Bone,h=c,f=l
d.copy(h.bone).tween(f.bone,u,c.spin),d.name=o.name,d.parent_index=t.parent_index})),v.length=g.length,v.forEach((function(t){var e=v[t.parent_index]
e?Space.combine(e.world_space,t.local_space,t.world_space):t.world_space.copy(t.local_space)}))
var x=u.object_ref_array,j=e.object_array
if(x.forEach((function(t,e){var i=t.timeline_index,o=b[i],r=o.keyframe_array,n=t.keyframe_index,s=(n+1)%r.length,c=r[n],l=r[s],p=c.time,_=l.time
_<p&&(_=a.length)
var u=0
switch(p!==_&&(u=(m-p)/(_-p),u=c.curve.evaluate(u)),o.type){case"sprite":var d=j[e]=j[e]||new SpriteObject,h=c,f=l
d.copy(h.sprite).tween(f.sprite,u,c.spin),d.name=o.name,d.parent_index=t.parent_index,d.z_index_secundario=t.z_index
break
case"bone":var y=j[e]=j[e]||new Bone,g=c,v=l
y.copy(g.bone).tween(v.bone,u,c.spin),y.name=o.name,y.parent_index=t.parent_index
break
case"box":var x=j[e]=j[e]||new BoxObject,w=c,z=l
x.copy(w.box).tween(z.box,u,c.spin),x.name=o.name,x.parent_index=t.parent_index
break
case"point":var E=j[e]=j[e]||new PointObject,k=c,O=l
E.copy(k.point).tween(O.point,u,c.spin),E.name=o.name,E.parent_index=t.parent_index
break
case"sound":var P=j[e]=j[e]||new SoundObject,M=c,A=l
P.copy(M.sound).tween(A.sound,u,c.spin),P.name=o.name
break
case"entity":var S=j[e]=j[e]||new EntityObject,q=c,T=l
S.copy(q.entity).tween(T.entity,u,c.spin),S.name=o.name,S.parent_index=t.parent_index
break
case"variable":var I=j[e]=j[e]||new VariableObject,C=c,N=l
I.name=o.name,I.copy(C.variable).tween(N.variable,u,c.spin)
break
default:throw new Error(o.type)}})),j.length=x.length,e.character_map_key_array.forEach((function(t){var e=i.character_map_map[t]
e&&e.map_instruction_array.forEach((function(t){j.forEach((function(e){switch(e.type){case"sprite":var i=e
i.folder_index===t.folder_index&&i.file_index===t.file_index&&(i.folder_index=t.target_folder_index,i.file_index=t.target_file_index)
break
case"bone":case"box":case"sound":case"event":case"entity":case"variable":break
default:throw new Error(e.type)}}))}))})),j.forEach((function(t){switch(t.type){case"sprite":var a=t,o=v[a.parent_index]
o?Space.combine(o.world_space,a.local_space,a.world_space):a.world_space.copy(a.local_space)
var r=e.data.folder_array[a.folder_index],n=r&&r.file_array[a.file_index]
if(n){var s=n,c=a.default_pivot?s.pivot:a.pivot,l=(.5-c.x)*s.width,p=(.5-c.y)*s.height
Space.translate(a.world_space,l,p)}break
case"bone":var _=t,u=v[_.parent_index]
u?Space.combine(u.world_space,_.local_space,_.world_space):_.world_space.copy(_.local_space)
break
case"box":var d=t,h=v[d.parent_index]
h?Space.combine(h.world_space,d.local_space,d.world_space):d.world_space.copy(d.local_space)
var f=i.obj_info_map[t.name]
if(f){var m=f
l=(.5-d.pivot.x)*m.w,p=(.5-d.pivot.y)*m.h
Space.translate(d.world_space,l,p)}break
case"point":var y=t,b=v[y.parent_index]
b?Space.combine(b.world_space,y.local_space,y.world_space):y.world_space.copy(y.local_space)
break
case"sound":break
case"entity":var g=t,x=v[g.parent_index]
x?Space.combine(x.world_space,g.local_space,g.world_space):g.world_space.copy(g.local_space)
break
case"variable":break
default:throw new Error(t.type)}})),j.forEach((function(i){switch(i.type){case"entity":var a=i,o=a.pose=a.pose||new t(e.data),r=o.data.entity_keys[a.entity_index]
r!==o.getEntity()&&o.setEntity(r)
var n=o.curEntity().animation_keys[a.animation_index]
if(n!==o.getAnim()){o.setAnim(n)
var s=o.curAnimLength(),c=a.animation_time*s
o.setTime(c)}else{s=o.curAnimLength()
var l=(c=a.animation_time*s)-o.getTime()
o.update(l)}o.strike()}})),e.sound_array=[],a.soundline_array.forEach((function(t){function i(t){var i=e.data.folder_array[t.sound.folder_index],a=i&&i.file_array[t.sound.file_index]
e.sound_array.push({name:a.name,volume:t.sound.volume,panning:t.sound.panning})}r<0?n?t.keyframe_array.forEach((function(t){(a.min_time<=t.time&&t.time<o||c<=t.time&&t.time<=a.max_time)&&i(t)})):t.keyframe_array.forEach((function(t){c<=t.time&&t.time<o&&i(t)})):s?t.keyframe_array.forEach((function(t){(a.min_time<=t.time&&t.time<=c||o<t.time&&t.time<=a.max_time)&&i(t)})):t.keyframe_array.forEach((function(t){o<t.time&&t.time<=c&&i(t)}))})),e.event_array=[],a.eventline_array.forEach((function(t){function i(i){e.event_array.push(t.name)}r<0?n?t.keyframe_array.forEach((function(t){(a.min_time<=t.time&&t.time<o||c<=t.time&&t.time<=a.max_time)&&i()})):t.keyframe_array.forEach((function(t){c<=t.time&&t.time<o&&i()})):s?t.keyframe_array.forEach((function(t){(a.min_time<=t.time&&t.time<=c||o<t.time&&t.time<=a.max_time)&&i()})):t.keyframe_array.forEach((function(t){o<t.time&&t.time<=c&&i()}))})),a.meta){if(a.meta.tagline){var w=function(t){e.tag_array=[],t.tag_array.forEach((function(t){var i=e.data.tag_def_array[t.tag_def_index]
e.tag_array.push(i.name)})),e.tag_array.sort()}
r<0?n?a.meta.tagline.keyframe_array.forEach((function(t){(a.min_time<=t.time&&t.time<o||c<=t.time&&t.time<=a.max_time)&&w(t)})):a.meta.tagline.keyframe_array.forEach((function(t){c<=t.time&&t.time<o&&w(t)})):s?a.meta.tagline.keyframe_array.forEach((function(t){(a.min_time<=t.time&&t.time<=c||o<t.time&&t.time<=a.max_time)&&w(t)})):a.meta.tagline.keyframe_array.forEach((function(t){o<t.time&&t.time<=c&&w(t)}))}e.var_map=e.var_map||{},a.meta.varline_array.forEach((function(t){var o=t.keyframe_array,r=Keyframe.find(o,c)
if(-1!==r){var n=(r+1)%o.length,s=o[r],l=o[n],p=s.time,_=l.time
_<p&&(_=a.length)
var u=0
p!==_&&(u=(c-p)/(_-p))
var d=i.var_defs.var_def_array[t.var_def_index],h=0
switch(d.type){case"int":h=0|tween(+s.val,+l.val,u)
break
case"float":h=tween(+s.val,+l.val,u)
break
case"string":h=s.val}e.var_map[d.name]=h}}))}}}},t}(),COLOR_DEL_LASER=16776608,Modo=function(t){function e(e){var i=t.call(this,e)||this
return i._nombre_del_fondo="",i.es_modo_ejecucion=!1,i}return __extends(e,t),e.prototype.create=function(t,e,i){this.ancho=e,this.alto=i,this.canvas_fisica=this.sys.add.graphics({x:0,y:0}),this.canvas_fisica.depth=99999,t.pilas.opciones.modo_simple||this.crear_indicadores_de_rendimiento_fps(),this.crear_canvas_de_depuracion(),this.pilas=t.pilas,t.proyecto&&30===t.proyecto.fps&&this.matter.set30Hz()},e.prototype.crear_indicadores_de_rendimiento_fps=function(){this.fps=this.add.bitmapText(5,10,"color-blanco-con-sombra",""),this.fps.scrollFactorX=0,this.fps.scrollFactorY=0,this.fps.depth=999999},e.prototype.destacar_actor_por_id=function(t){var e=this.obtener_actor_por_id(t)
e&&e.destacar&&e.destacar()},e.prototype.crear_canvas_de_depuracion=function(){var t=this.add.graphics()
t.depth=2e4,this.graphics=t},e.prototype.crear_manejadores_para_controlar_el_zoom=function(t){var e=this
this.input.on("wheel",(function(i,a,o,r,n,s){var c=this.cameras.main.zoom
r>0?c+=.25:c-=.25,c=Math.max(1,c),c=Math.min(5,c),t&&e.pilas.mensajes.emitir_mensaje_al_editor("cambia_zoom",{zoom:c}),this.cameras.main.setZoom(c)}))},e.prototype.update=function(t){var e=this
this.graphics.clear(),t=t||this.actores,this.pilas.depurador.modo_posicion_activado&&!this.es_modo_ejecucion&&t.map((function(t){e.dibujar_punto_de_control(e.graphics,t.x,t.y)}))},e.prototype.actualizar_canvas_fisica=function(){var t=this.canvas_fisica,e=this.matter.world.localWorld.bodies
t.clear()
for(var i=0;i<e.length;i++){var a=e[i],o=null
o=a.es_sensor?16728128:a.es_dinamica?65280:255,this.dibujar_figura_desde_vertices(t,2,o,a.vertices)}this.dibujar_lasers()},e.prototype.dibujar_lasers=function(){var t=this,e=this.canvas_fisica
this.actores.map((function(i){i.lasers.map((function(a){t.dibujar_laser_del_actor(a,e,i)}))}))},e.prototype.dibujar_laser_del_actor=function(t,e,i){var a=-t.rotacion*(Math.PI/180),o=COLOR_DEL_LASER,r=i.x,n=i.y,s=i.x+Math.cos(a)*t.longitud,c=i.y+Math.sin(a)*t.longitud
e.lineStyle(2,o,1),e.lineBetween(r,n,s,c),this._laser_entre_entidades(r,n,s,c,i).map((function(t){e.beginPath(),e.fillStyle(o),e.fillCircle(t.x,t.y,5),e.closePath()}))},e.prototype._laser_entre_entidades=function(t,e,i,a,o){var r=this,n=this.matter.world.getAllBodies(),s=[],c=raycast(n,{x:t,y:e},{x:i,y:a})
return(c=c.filter((function(t){return(!o||!o.figura||o.figura.id!==t.body.id)&&((!t.body||!t.body.actor_id||t.body.actor_id!==o.id)&&(!t.body.es_sensor&&(!s.includes(t.body.id)&&(s.push(t.body.id),t))))}))).map((function(i){var a=r.pilas.obtener_distancia_entre_puntos(t,e,i.point.x,i.point.y)
return{actor:null,body:i.body,distancia:a,x:i.point.x,y:i.point.y}})).sort((function(t,e){return t.distancia-e.distancia}))},e.prototype.dibujar_figura_desde_vertices=function(t,e,i,a){t.beginPath(),t.lineStyle(e,i,2),t.moveTo(a[0].x,a[0].y)
for(var o=a.length,r=1;r<o;r++)a[r-1].isInternal?t.moveTo(a[r].x,a[r].y):t.lineTo(a[r].x,a[r].y),a[r].isInternal&&t.moveTo(a[(r+1)%a.length].x,a[(r+1)%a.length].y)
t.lineTo(a[0].x,a[0].y),t.closePath(),t.strokePath()},e.prototype.obtener_posicion_de_la_camara=function(){return{x:this.pilas.modo.cameras.cameras[0].scrollX,y:this.pilas.modo.cameras.cameras[0].scrollY}},e.prototype.crear_fondo=function(t,e,i){if(this._nombre_del_fondo=t,this.pilas.utilidades.validar_que_existe_imagen(t),e=e||this.ancho,i=i||this.alto,t.indexOf(":")>-1){var a=t.split(":")[0],o=t.split(":")[1]
this.fondo=this.add.tileSprite(0,0,e,i,a,o)}else this.fondo=this.add.tileSprite(0,0,e,i,t)
this.fondo.depth=-2e4,this.fondo.setOrigin(0)},e.prototype.posicionar_fondo=function(t,e){t||(t=0),e||(e=0)
var i=this.obtener_posicion_de_la_camara()
this.fondo&&(this.fondo.x=i.x,this.fondo.y=i.y,this.fondo.tilePositionX=i.x+t,this.fondo.tilePositionY=i.y+e)},e.prototype.cambiar_fondo=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),t!==this._nombre_del_fondo&&(this.fondo.destroy(),this.fondo=null,this.crear_fondo(t,e,i))},e.prototype.obtener_actor_por_id=function(t){return this.pilas&&this.pilas.modo&&this.pilas.actores?this.pilas.modo.actores.filter((function(e){return e.id===t}))[0]:null},e.prototype.actualizar_sprite_desde_datos=function(t,e){var i=this,a=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(e.x,e.y)
if(this.pilas.utilidades.validar_que_existe_imagen(e.imagen),e.imagen.indexOf(":")>-1){var o=e.imagen.split(":")[0],r=e.imagen.split(":")[1]
t.setTexture(o,r)}else t.setTexture(e.imagen)
if(t.input.hitArea.width=t.width,t.input.hitArea.height=t.height,this.actor_seleccionado===t&&this.input.enableDebug(t,16777215),!1===e.activo?t.alpha=.5:t.alpha=1-e.transparencia/100,t.id=e.id,t.x=a.x,t.y=a.y,t.angle=-e.rotacion,t.scaleX=e.escala_x,t.scaleY=e.escala_y,t.depth=-e.z||0,t.setOrigin(e.centro_x,e.centro_y),t.figura&&this.pilas.Phaser.Physics.Matter.Matter.World.remove(this.pilas.modo.matter.world.localWorld,t.figura),e.figura&&(t.figura=this.crear_figura_estatica_para(e)),this.actualizar_sensores_del_actor(e,t),this.actualizar_lasers_del_actor(e,t),t.setFlipX(e.espejado),t.setFlipY(e.espejado_vertical),e.es_texto){if(t.texto&&t.texto_fuente!==e.fuente&&(t.texto.destroy(),t.texto=void 0,t.fondo&&t.fondo.destroy()),!t.texto&&(t.texto=this.add.bitmapText(0,0,e.fuente,e.texto),t.texto_fuente=e.fuente,t.update=function(){i.copiar_valores_de_sprite_a_texto(t)},e.fondo)){var n=this.obtener_imagen_para_nineslice(e.fondo),s=this.add.nineslice(0,0,30,20,n,10,10)
t.fondo=s,t.fondo_imagen=e.fondo}if(t.texto.text=e.texto,e.fondo!==t.fondo_imagen&&(t.fondo&&t.fondo.destroy(),e.fondo)){n=this.obtener_imagen_para_nineslice(e.fondo),s=this.add.nineslice(0,0,30,20,n,10,10)
t.fondo=s,t.fondo_imagen=e.fondo}this.copiar_valores_de_sprite_a_texto(t)}},e.prototype.actualizar_sensores_del_actor=function(t,e){var i=this
e.sensores&&e.sensores.map((function(t){i.pilas.Phaser.Physics.Matter.Matter.World.remove(i.pilas.modo.matter.world.localWorld,t)})),t.sensores&&(e.sensores=t.sensores.map((function(t){var a=i.matter.add.rectangle(t.x+e.x,-t.y+e.y,t.ancho,t.alto,{isStatic:!0})
return a.es_sensor=!0,a.dx=t.x,a.dy=t.y,a})))},e.prototype.actualizar_lasers_del_actor=function(t,e){t.lasers&&(e.lasers=t.lasers.map((function(t){return{nombre:t.nombre,rotacion:t.rotacion,longitud:t.longitud}})))},e.prototype.obtener_imagen_para_nineslice=function(t){if(t.indexOf(":")>-1){var e=t.split(":")
return{key:e[0],frame:e[1]}}return t},e.prototype.copiar_valores_de_sprite_a_texto=function(t){var e=t.texto,i=t.fondo
if(e.x=t.x,e.y=t.y,e.angle=t.angle,e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.alpha=t.alpha,e.flipX=t.flipX,e.flipY=t.flipY,e.setOrigin(t.originX,t.originY),e.depth=t.depth+.1,t.input&&(t.input.hitArea.width=e.width+15,t.input.hitArea.height=e.height+10,t.input.hitArea.x=-e.width/2,t.input.hitArea.y=-e.height/2),i){i.x=t.x,i.y=t.y,i.angle=t.angle,i.scaleX=t.scaleX,i.scaleY=t.scaleY,i.setOrigin(t.originX,t.originY),i.alpha=t.alpha,i.flipX=t.flipX,i.flipY=t.flipY,i.resize(e.width+30,e.height+30),t.fondo_imagen.includes("dialogo")&&(i.y+=4),i.depth=e.depth-1,t.width=e.width+30,t.height=e.height+30,t.input&&(t.setOrigin(t.originX,t.originY),t.input.hitArea.width=e.width+30,t.input.hitArea.height=e.height+30,t.input.hitArea.x=0,t.input.hitArea.y=0)}},e.prototype.crear_figura_estatica_para=function(t){var e=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(t.x,t.y),i=this.pilas.utilidades.convertir_angulo_a_radianes(-t.rotacion),a=null
if("rectangulo"===t.figura)return(a=this.matter.add.rectangle(e.x,e.y,t.figura_ancho,t.figura_alto,{isStatic:!0,angle:i})).es_sensor=t.figura_sensor,a.es_dinamica=t.figura_dinamica,a
if("circulo"===t.figura){var o=this.matter.add.circle(e.x,e.y,t.figura_radio,{isStatic:!0,angle:i},25)
return o.es_sensor=t.figura_sensor,o.es_dinamica=t.figura_dinamica,o}throw Error("No se reconoce la figura "+t.figura+" en este modo.")},e.prototype.actualizar_posicion=function(t){throw void 0===t&&(t=null),Error("No se puede actualizar posicion en este modo. Solo se puede en el modo pausa.")},e.prototype.dibujar_punto_de_control=function(t,e,i){t.fillStyle(16777215,1),t.fillRect(e-3,i-3,6,6),t.fillStyle(0,1),t.fillRect(e-2,i-2,4,4)},e.prototype.selecciona_actor_o_escena_en_modo_pausa=function(t){},e}(Phaser.Scene),ModoCargador=function(t){function e(){return t.call(this,{key:"ModoCargador"})||this}return __extends(e,t),e.prototype.preload=function(){var t=this
if(this.load.crossOrigin="anonymous",this.contador=0,this.crear_indicador_de_carga(),this.pilas.opciones.omitir_imagenes_de_pilas||(this.load.multiatlas("imagenes","imagenes.json","./"),this.load.multiatlas("bloques","bloques.json","./"),this.load.multiatlas("decoracion","decoracion.json","./"),this.load.multiatlas("fuentes","fuentes.json","./"),this.load.json("fuentes-datos-json","fuentes-datos.json")),this.pilas.recursos.sonidos)for(var e=function(e){var a=i.pilas.recursos.sonidos[e]
i.pilas.sonidos.agregar_sonido(a.nombre),a.contenido?i.convertir_sonido_en_array_buffer(a,(function(e){t.cache.audio.add(a.nombre,e)})):i.load.audio(a.nombre,a.ruta,{})},i=this,a=0;a<this.pilas.recursos.sonidos.length;a++)e(a)
if(this.pilas.recursos.atlas)for(a=0;a<this.pilas.recursos.atlas.length;a++){var o=this.pilas.recursos.atlas[a]
this.load.multiatlas(o.nombre,o.archivo,o.ruta)}if(this.pilas.recursos.huesos)for(a=0;a<this.pilas.recursos.huesos.length;a++){var r=this.pilas.recursos.huesos[a]
this.load.json(r.nombre,r.ruta)}else void 0===this.pilas.recursos.huesos&&(this.load.multiatlas("atlas-robot","robot.json","./"),this.load.json("robot","robot.scon"))
if(this.pilas.recursos.imagenes)for(a=0;a<this.pilas.recursos.imagenes.length;a++){var n=this.pilas.recursos.imagenes[a]
this.load.image(n.nombre,n.ruta)}this.pilas.imagenes&&this.pilas.imagenes.map((function(e){if(e.contenido)t.textures.addBase64(e.nombre,e.contenido)
else{if(!e.ruta)throw Error("No se puede cargar una imagen sin contenido ni ruta.")
t.load.image(e.nombre,e.ruta)}})),this.load.on("progress",this.cuando_progresa_la_carga,this)},e.prototype.init=function(t){this.pilas=t.pilas},e.prototype.crear_indicador_de_carga=function(){var t=this.add.graphics(),e=this.add.graphics()
this.barra_de_progreso=this.add.graphics()
var i=this.cameras.main.width,a=this.cameras.main.height
this.make.text({x:i/2,y:a/2-100,text:"Iniciando ...",style:{font:"14px verdana"}}).setOrigin(.5,.5),this.x=i/2-155,e.lineStyle(1,5592405,1),e.strokeRect(this.x,220,310,20),t.fillStyle(2236962,1),t.fillRect(this.x,220,310,20)},e.prototype.update=function(){if(this.contador+=1,60===this.contador){this.add.text(5,5,"Carga finalizada\nTiene que enviar la señal 'ejecutar_proyecto'")}},e.prototype.notificar_imagenes_cargadas=function(){var t=[]
for(var e in this.game.textures.list)if(-1===e.indexOf("__")&&e){var i=this.game.textures.list[e]
if(1===i.frameTotal)t.push(e)
else for(var a=i.getFrameNames(),o=0;o<a.length;o++)t.push(e+":"+a[o])}this.pilas.imagenes_precargadas=t},e.prototype.create=function(){this.pilas.opciones.omitir_imagenes_de_pilas||(this.crear_fuente_bitmap("color-negro"),this.crear_fuente_bitmap("color-blanco"),this.crear_fuente_bitmap("color-blanco-con-sombra-chico"),this.crear_fuente_bitmap("color-blanco-con-sombra-grande"),this.crear_fuente_bitmap("color-blanco-con-sombra-medio"),this.crear_fuente_bitmap("color-blanco-con-sombra"),this.crear_fuente_bitmap("pixel-color-negro"),this.crear_fuente_bitmap("pixel-color-blanco")),t.prototype.create.call(this,{pilas:this.pilas},this.pilas._ancho,this.pilas._alto),this.notificar_imagenes_cargadas()
this.pilas.opciones.modo_simple?this.pilas.definir_modo("ModoEjecucion",{pilas:this.pilas,nombre_de_la_escena_inicial:"principal",es_cambio_de_escena:!1,codigo:"\n\n        var __extends = (this && this.__extends) || (function () {\n          var extendStatics = function (d, b) {\n              extendStatics = Object.setPrototypeOf ||\n                  ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n                  function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n              return extendStatics(d, b);\n          }\n          return function (d, b) {\n              extendStatics(d, b);\n              function __() { this.constructor = d; }\n              d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n          };\n      })();\n      var Proyecto = /** @class */ (function () {\n          function Proyecto() {\n          }\n          Proyecto.prototype.iniciar = function () {\n          };\n          return Proyecto;\n      }());\n      var principal = /** @class */ (function (_super) {\n          __extends(principal, _super);\n          function principal() {\n              return _super !== null && _super.apply(this, arguments) || this;\n          }\n          principal.prototype.iniciar = function () {\n          };\n          principal.prototype.actualizar = function () {\n          };\n          return principal;\n      }(Escena));\n      ",proyecto:{alto:this.pilas._alto,ancho:this.pilas._ancho,titulo:"sin usar",escena_inicial:3,codigos:{escenas:[{nombre:"principal",codigo:"\n                  class principal extends Escena {\n                    iniciar() {\n\n                    }\n\n                    actualizar() {\n\n                    }\n                  }"}],actores:[]},escenas:[{nombre:"principal",id:3,ancho:this.pilas._ancho,alto:this.pilas._alto,fondo:void 0,actores:[],camara_x:0,camara_y:0}]}}):this.pilas.mensajes.emitir_mensaje_al_editor("finaliza_carga_de_recursos")},e.prototype.crear_fuente_bitmap=function(t){var e=Phaser.GameObjects.BitmapText.ParseXMLBitmapFont,i=this.sys.textures.getFrame("fuentes",t),a=this.sys.cache.json.get("fuentes-datos-json"),o=e((new DOMParser).parseFromString(a[t].contenido,"application/xml"),i,void 0,void 0)
this.sys.cache.bitmapFont.add(t,{data:o,texture:"fuentes",frame:t})},e.prototype.cuando_progresa_la_carga=function(t){this.barra_de_progreso.clear(),this.barra_de_progreso.fillStyle(16777215,1),this.barra_de_progreso.fillRect(this.x+5,225,300*t,10)},e.prototype.convertir_sonido_en_array_buffer=function(t,e){var i=this,a={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",removePaddingChars:function(t){return 64==this._keyStr.indexOf(t.charAt(t.length-1))?t.substring(0,t.length-1):t},decode:function(t){t=this.removePaddingChars(t),t=this.removePaddingChars(t)
var e,i,a,o,r,n,s,c=parseInt(""+t.length/4*3,10),l=0,p=0
for(e=new Uint8Array(c),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),l=0;l<c;l+=3)i=this._keyStr.indexOf(t.charAt(p++))<<2|(r=this._keyStr.indexOf(t.charAt(p++)))>>4,a=(15&r)<<4|(n=this._keyStr.indexOf(t.charAt(p++)))>>2,o=(3&n)<<6|(s=this._keyStr.indexOf(t.charAt(p++))),e[l]=i,64!=n&&(e[l+1]=a),64!=s&&(e[l+2]=o)
return e}}.decode(t.contenido.split("64,")[1]).buffer;(new(window.AudioContext||window.webkitAudioContext)).decodeAudioData(a,(function(t){e.call(i,t)}),(function(t){console.log("Error with decoding audio data"+t.err)}))},e}(Modo),ModoEditor=function(t){function e(){return t.call(this,{key:"ModoEditor"})||this}return __extends(e,t),e.prototype.preload=function(){},e.prototype.create=function(e){t.prototype.create.call(this,e,e.proyecto.ancho,e.proyecto.alto),this.actores=[],this.pilas=e.pilas,this.usar_grilla=!1,this.tamaño_de_la_grilla=256,this.crear_sprite_para_el_cursor_de_la_grilla(),this.actor_seleccionado=null,this.crear_fondo(e.escena.fondo,e.escena.ancho+this.ancho/2,e.escena.alto),this.posicionar_la_camara(e.escena),this.aplicar_limites_a_la_camara(e.escena),this.crear_minimap(e.escena),this.crear_sprite_con_el_borde_de_la_camara(e.escena),this.crear_actores_desde_los_datos_de_la_escena(e.escena),this.hacer_que_el_fondo_se_pueda_arrastrar(),this.crear_manejadores_para_hacer_arrastrables_los_actores_y_la_camara(),this.crear_manejadores_para_controlar_el_zoom(!0),this.conectar_movimiento_del_mouse(),this.conectar_eventos_de_teclado(),this.pilas.game.scale.scaleMode=Phaser.Scale.FIT,this.pilas.game.scale.resize(this.ancho,this.alto),this.pilas.mensajes.emitir_mensaje_al_editor("comienza_el_modo_edicion")},e.prototype.conectar_eventos_de_teclado=function(){this.input.keyboard.on("keyup",this.manejar_evento_key_up.bind(this)),this.input.keyboard.on("keydown",this.manejar_evento_key_down.bind(this))},e.prototype.crear_fondo=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),this._nombre_del_fondo=t,this.pilas.utilidades.validar_que_existe_imagen(t),e=e||this.ancho,i=i||this.alto,t.indexOf(":")>-1){var a=t.split(":")[0],o=t.split(":")[1]
this.fondo=this.add.tileSprite(0,0,e,i,a,o)}else this.fondo=this.add.tileSprite(0,0,e,i,t)
this.fondo.depth=-2e4,this.fondo.setOrigin(0)},e.prototype.manejar_evento_key_up=function(t){"d"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("duplicar_el_actor_seleccionado",{}),"x"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("eliminar_el_actor_seleccionado",{}),"n"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("crear_un_actor_desde_atajo",{}),"ArrowLeft"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("mover_al_actor_con_el_teclado",{x:-1}),"ArrowRight"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("mover_al_actor_con_el_teclado",{x:1}),"ArrowUp"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("mover_al_actor_con_el_teclado",{y:1}),"ArrowDown"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("mover_al_actor_con_el_teclado",{y:-1}),"Meta"===t.key&&(this.tecla_meta_pulsada=!1)},e.prototype.manejar_evento_key_down=function(t){"Meta"===t.key&&(this.tecla_meta_pulsada=!0)},e.prototype.crear_sprite_para_el_cursor_de_la_grilla=function(){var t=0,e=0
this.sprite_cursor_de_la_grilla&&(t=this.sprite_cursor_de_la_grilla.x,e=this.sprite_cursor_de_la_grilla.y,this.sprite_cursor_de_la_grilla.destroy())
var i=this.add.rectangle(t-2e3,e-2e3,this.tamaño_de_la_grilla,this.tamaño_de_la_grilla)
i.setStrokeStyle(1,16777215),i.depth=9999999,this.sprite_cursor_de_la_grilla=i},e.prototype.crear_minimap=function(t){var e=this.ancho,i=this.alto,a=t.ancho,o=t.alto
this.minimap=this.cameras.add(e-100-5,i-70-5,100,70).setZoom(.1),this.minimap.setBounds(0,0,a,o),this.minimap.setBackgroundColor(8772),this.minimap.scrollX=0,this.minimap.scrollY=0,this.minimap.inputEnabled=!1,this.minimap.ignore(this.fondo),this.minimap.ignore(this.fps)},e.prototype.crear_sprite_con_el_borde_de_la_camara=function(t){var e=t.camara_x,i=t.camara_y
this.sprite_borde_de_la_camara=this.add.rectangle(this.ancho/2,this.alto/2,this.ancho,this.alto),this.sprite_borde_de_la_camara.setStrokeStyle(3,16777215),this.sprite_borde_de_la_camara.depth=999999,this.sprite_borde_de_la_camara.x=e+this.ancho/2,this.sprite_borde_de_la_camara.y=-i+this.alto/2,this.cameras.cameras[0].ignore(this.sprite_borde_de_la_camara)},e.prototype.hacer_que_el_fondo_se_pueda_arrastrar=function(){this.fondo.setInteractive(),this.input.setDraggable(this.fondo,void 0),this.fondo.es_fondo=!0},e.prototype.aplicar_limites_a_la_camara=function(t){this.cameras.cameras[0].setBounds(0,0,t.ancho+this.ancho/2,t.alto)},e.prototype.conectar_movimiento_del_mouse=function(){var t=this
this.input.on("pointermove",(function(e){var i=t.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(e.worldX,e.worldY)
t.pilas.cursor_x=Math.trunc(i.x),t.pilas.cursor_y=Math.trunc(i.y)
var a=t.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(e.worldX,e.worldY)
t.pilas.cursor_x_absoluta=Math.trunc(a.x),t.pilas.cursor_y_absoluta=Math.trunc(a.y)})),this.input.on("pointerup",(function(e){if(t.tecla_meta_pulsada){var i=t.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(e.worldX,e.worldY)
t.pilas.mensajes.emitir_mensaje_al_editor("duplicar_el_actor_seleccionado_con_click",{x:i.x,y:i.y})}}))},e.prototype.crear_manejadores_para_hacer_arrastrables_los_actores_y_la_camara=function(){var t=this,e=this,i=null
this.input.on("dragstart",(function(a,o){if(a.downElement&&"CANVAS"!==a.downElement.tagName)return!1
i=o,t.mover_cursor_de_la_grilla(a.worldX,a.worldY),t.posicion_anterior_de_arrastre=a.position.clone(),o.es_fondo||e.pilas.mensajes.emitir_mensaje_al_editor("comienza_a_mover_un_actor",{id:o.id}),e.pilas.utilidades.es_firefox()?e.input.setDefaultCursor("grabbing"):e.input.setDefaultCursor("-webkit-grabbing")})),this.input.on("drag",(function(e,a,o,r){if(!i)return null
a.es_fondo?t.desplazar_la_camara_desde_el_evento_drag(e):t.desplazar_actor_desde_el_evento_drag(a,e)}))
var a=function(a,o){if(o&&(i=null,e.input.setDefaultCursor("default"),!o.es_fondo)){t.usar_grilla&&t.ajustar_posicion_a_la_grilla(o)
var r=e.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(o.x,o.y)
e.pilas.mensajes.emitir_mensaje_al_editor("termina_de_mover_un_actor",{id:o.id,x:r.x,y:r.y})}}
this.input.on("dragend",a),this.input.on("gameout",(function(){i&&a(0,i)}))},e.prototype.ajustar_posicion_a_la_grilla=function(t){t.x=this.sprite_cursor_de_la_grilla.x,t.y=this.sprite_cursor_de_la_grilla.y,this.ajustar_figura(t),this.ajustar_sensores(t)},e.prototype.cuando_cambia_grilla_desde_el_selector_manual=function(t){0===t?(this.usar_grilla=!1,this.tamaño_de_la_grilla=0):(this.usar_grilla=!0,this.tamaño_de_la_grilla=t),this.crear_sprite_para_el_cursor_de_la_grilla(),this.sprite_cursor_de_la_grilla.alpha=0===t?0:1},e.prototype.desplazar_la_camara_desde_el_evento_drag=function(t){var e=this.cameras.main.zoom,i=this.obtener_factores(),a=this.posicion_anterior_de_arrastre.x-t.position.x,o=this.posicion_anterior_de_arrastre.y-t.position.y
this.cameras.main.scrollX+=a/i.x/e,this.cameras.main.scrollY+=o/i.y/e,this.posicion_anterior_de_arrastre=t.position.clone(),this.actualizar_posicion_del_minimap_y_el_borde_de_camara()},e.prototype.obtener_factores=function(){return{x:Math.min(1,this.ancho/this.alto),y:Math.min(1,this.alto/this.ancho)}},e.prototype.desplazar_actor_desde_el_evento_drag=function(t,e){var i=this.cameras.main.zoom,a=this.obtener_factores(),o=(e.position.x-this.posicion_anterior_de_arrastre.x)/a.x/i,r=(e.position.y-this.posicion_anterior_de_arrastre.y)/a.y/i
t.x+=o,t.y+=r,this.mover_cursor_de_la_grilla(t.x,t.y),this.ajustar_figura(t),this.ajustar_sensores(t),this.posicion_anterior_de_arrastre=e.position.clone()},e.prototype.ajustar_figura=function(t){var e=this.pilas.Phaser.Physics.Matter.Matter
if(t.figura){var i=t.figura
e.Body.setPosition(i,{x:t.x,y:t.y})}},e.prototype.ajustar_sensores=function(t){var e=this.pilas.Phaser.Physics.Matter.Matter
t.sensores&&t.sensores.map((function(i){e.Body.setPosition(i,{x:t.x+i.dx,y:t.y-i.dy})}))},e.prototype.mover_cursor_de_la_grilla=function(t,e){var i=this.tamaño_de_la_grilla
function a(t){return Math.round(t/i)*i}var o=a(t),r=a(e)
o+=(this.ancho-a(this.ancho))/2,r+=(this.alto-a(this.alto))/2,this.sprite_cursor_de_la_grilla.x=o,this.sprite_cursor_de_la_grilla.y=r},e.prototype.actualizar_posicion_del_minimap_y_el_borde_de_camara=function(t){void 0===t&&(t=!0)
var e=this.obtener_posicion_de_desplazamiento_de_la_camara(),i=e.x,a=e.y
this.sprite_borde_de_la_camara.x=i+this.ancho/2,this.sprite_borde_de_la_camara.y=a+this.alto/2,this.minimap.scrollX=i+this.ancho/2,this.minimap.scrollY=a+this.alto/2,t&&this.pilas.mensajes.emitir_mensaje_al_editor("mientras_mueve_la_camara",{x:i,y:-a})},e.prototype.obtener_posicion_de_desplazamiento_de_la_camara=function(){var t=this.cameras.main,e=t.scrollX,i=t.scrollY,a=this.ancho,o=this.alto,r=t.getBounds()
return e<r.x&&(e=r.x),e>r.width-a/2&&(e=r.width-a/2),i<r.y&&(i=r.y),i>r.height-o&&(i=r.height-o),{x:e,y:i}},e.prototype.crear_actores_desde_los_datos_de_la_escena=function(t){var e=this
t.actores.map((function(t){e.crear_sprite_desde_actor(t)}))},e.prototype.crear_sprite_desde_actor=function(t){var e=this
this.pilas.utilidades.validar_que_existe_imagen(t.imagen)
var i=null
if(t.imagen.indexOf(":")>-1){var a=t.imagen.split(":")[0],o=t.imagen.split(":")[1]
i=this.add.sprite(0,0,a,o)}else i=this.add.sprite(0,0,t.imagen)
i.setInteractive(),i.actor=t,i.destacar=function(){e.actor_seleccionado&&e.input.removeDebug(e.actor_seleccionado),e.input.enableDebug(i,16777215),e.actor_seleccionado=i},this.aplicar_atributos_de_actor_a_sprite(t,i),this.input.setDraggable(i,void 0),this.actores.push(i)},e.prototype.copiar_atributos_excepto_alpha=function(t,e){e.x=t.x,e.y=t.y,e.angle=t.angle,e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.flipX=t.flipX,e.flipY=t.flipY,e.depth=t.depth,e.setOrigin(t.originX,t.originY)},e.prototype.aplicar_atributos_de_actor_a_sprite=function(t,e){this.actualizar_sprite_desde_datos(e,t)},e.prototype.update=function(){if(t.prototype.update.call(this,this.actores),this.pilas.depurador.minimapa?this.minimap.setAlpha(1):this.minimap.setAlpha(0),this.actores.map((function(t){t.update()})),this.minimap.y=this.scale.baseSize.height-75,this.minimap.x=this.scale.baseSize.width-105,this.pilas.depurador.mostrar_fisica?(this.canvas_fisica.setAlpha(1),this.actualizar_canvas_fisica()):this.canvas_fisica.setAlpha(0),this.fps)if(this.pilas.depurador.mostrar_fps){this.fps.alpha=1
var e=this.pilas.cursor_x,i=this.pilas.cursor_y
this.fps.text=["FPS: "+Math.round(this.pilas.game.loop.actualFps),"Cantidad de actores: "+this.actores.length,"Cursor X: "+e,"Cursor Y: "+i].join("\n")}else this.fps.alpha=0
this.pilas.game.hasFocus||(this.tecla_meta_pulsada=!1)},e.prototype.eliminar_actor_por_id=function(t){var e=this,i=this.actores.findIndex((function(e){return e.id===t})),a=this.actores.splice(i,1)
this.actor_seleccionado&&this.actor_seleccionado.id==a[0].id&&(this.input.removeDebug(this.actor_seleccionado),this.actor_seleccionado=null),a[0].figura&&this.pilas.Phaser.Physics.Matter.Matter.World.remove(this.pilas.modo.matter.world.localWorld,a[0].figura),a[0].sensores&&a[0].sensores.map((function(t){e.pilas.Phaser.Physics.Matter.Matter.World.remove(e.pilas.modo.matter.world.localWorld,t)})),a[0].texto&&a[0].texto.destroy(),a[0].fondo&&a[0].fondo.destroy(),a[0].destroy()},e.prototype.posicionar_la_camara=function(t){this.cameras.cameras[0].setScroll(t.camara_x,-t.camara_y)
try{this.actualizar_posicion_del_minimap_y_el_borde_de_camara(!1)}catch(e){}},e.prototype.cambiar_fondo=function(e){var i=this.cameras.main.getBounds().width,a=this.cameras.main.getBounds().height
t.prototype.cambiar_fondo.call(this,e,i,a),this.minimap.ignore(this.fondo),this.hacer_que_el_fondo_se_pueda_arrastrar()},e}(Modo),ModoEjecucion=function(_super){function ModoEjecucion(){var t=_super.call(this,{key:"ModoEjecucion"})||this
return t.proyecto={},t.nombre_de_la_escena_inicial=null,t._escena_en_ejecucion=null,t.teclas=null,t.instancia_de_proyecto=null,t.es_modo_ejecucion=!0,t}return __extends(ModoEjecucion,_super),ModoEjecucion.prototype.preload=function(){},ModoEjecucion.prototype.create=function(t){_super.prototype.create.call(this,t,t.proyecto.ancho,t.proyecto.alto),this.actores=[],this.teclas=new Set,this.con_error=!1
try{this.guardar_parametros_en_atributos(t),this.clases=this.obtener_referencias_a_clases(),this.cargar_animaciones(t),t.es_cambio_de_escena||this.instanciar_proyecto(),this.pilas.instrumentacion={},this.pilas.instrumentacion_de_bloques={},this.instanciar_escena(this.nombre_de_la_escena_inicial),this.pilas.opciones.modo_simple?this.pilas.onready?this.pilas.onready(this.pilas):console.warn("Estas usando pilas en modo simple, pero no has indicado pilas.onready = () => { /* codigo */}"):this.pilas.mensajes.emitir_mensaje_al_editor("termina_de_iniciar_ejecucion",{}),this.pilas.historia.limpiar(),this.conectar_eventos(),this.vincular_eventos_de_colision(),this.modificar_modo_de_pantalla()}catch(e){this.pilas.mensajes.emitir_excepcion_al_editor(e,"crear la escena")}this.events.on("update",this.save_delta_times.bind(this))},ModoEjecucion.prototype.save_delta_times=function(t,e){this._time=t,this._delta=e},ModoEjecucion.prototype.modificar_modo_de_pantalla=function(){this.pilas.game.scale.scaleMode=Phaser.Scale.FIT,this.pilas.game.scale.resize(this.ancho,this.alto)},ModoEjecucion.prototype.cargar_animaciones=function(t){var e=t.proyecto.animaciones
e&&this.pilas.animaciones.reemplazar_todas_las_animaciones(e)},ModoEjecucion.prototype.conectar_eventos=function(){this.input.on("pointermove",this.manejar_evento_muevemouse.bind(this)),this.input.on("pointerdown",this.manejar_evento_click_de_mouse.bind(this)),this.input.on("pointerup",this.manejar_evento_termina_click.bind(this)),this.input.keyboard.on("keydown",this.manejar_evento_key_down.bind(this)),this.input.keyboard.on("keyup",this.manejar_evento_key_up.bind(this))},ModoEjecucion.prototype.manejar_evento_click_de_mouse=function(t){var e=t.worldX,i=t.worldY,a=this.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(e,i)
if(this.pilas.eventos.emitir_evento("click_de_mouse",{x:a.x,y:a.y,evento:t}),this._escena_en_ejecucion)try{this._escena_en_ejecucion._bloques_cuando_hace_click&&this._escena_en_ejecucion._bloques_cuando_hace_click(a.x,a.y,t),this._escena_en_ejecucion.cuando_hace_click(a.x,a.y,t),this._escena_en_ejecucion.avisar_click_en_la_pantalla_a_los_actores(a.x,a.y,t)}catch(o){this.pilas.mensajes.emitir_excepcion_al_editor(o,"emitir cuando_hace_click")}},ModoEjecucion.prototype.manejar_evento_termina_click=function(t){var e=t.worldX,i=t.worldY,a=this.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(e,i)
if(this.pilas.eventos.emitir_evento("termina_click",{x:a.x,y:a.y,evento:t}),this._escena_en_ejecucion)try{this._escena_en_ejecucion.cuando_termina_de_hacer_click(a.x,a.y,t),this._escena_en_ejecucion.avisar_cuando_termina_de_hacer_click_en_la_pantalla_a_los_actores(a.x,a.y,t)}catch(o){this.pilas.mensajes.emitir_excepcion_al_editor(o,"emitir cuando_hace_click")}},ModoEjecucion.prototype.manejar_evento_muevemouse=function(t){var e=this.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(t.worldX,t.worldY)
this.pilas.cursor_x=Math.trunc(e.x),this.pilas.cursor_y=Math.trunc(e.y)
var i=this.pilas.utilidades.convertir_coordenada_de_phaser_a_pilas(t.worldX,t.worldY)
if(this.pilas.cursor_x_absoluta=Math.trunc(i.x),this.pilas.cursor_y_absoluta=Math.trunc(i.y),this.pilas.eventos.emitir_evento("mueve_mouse",{x:e.x,y:e.y,evento:t}),this._escena_en_ejecucion)try{this._escena_en_ejecucion.cuando_mueve(e.x,e.y,t),this._escena_en_ejecucion.avisar_cuando_mueve_a_todos_los_actores(e.x,e.y,t)}catch(a){this.pilas.mensajes.emitir_excepcion_al_editor(a,"emitir cuando_mueve")}},ModoEjecucion.prototype.manejar_evento_key_down=function(t){if(!this.teclas.has(t.code)){this.teclas.add(t.code)
var e=this.pilas.utilidades.obtener_nombre_de_la_tecla_desde_un_evento(t)
this._escena_en_ejecucion.cuando_pulsa_tecla(e,t),this._escena_en_ejecucion.avisar_cuando_pulsa_tecla_a_los_actores(e,t)}},ModoEjecucion.prototype.manejar_evento_key_up=function(t){this.teclas.delete(t.code),"Escape"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("pulsa_la_tecla_escape",{})
var e=this.pilas.utilidades.obtener_nombre_de_la_tecla_desde_un_evento(t)
this._escena_en_ejecucion.cuando_suelta_tecla(e,t),this._escena_en_ejecucion.avisar_cuando_suelta_tecla_a_los_actores(e,t)},ModoEjecucion.prototype.cambiar_escena=function(t){var e={pilas:this.pilas,nombre_de_la_escena_inicial:t,permitir_modo_pausa:this.permitir_modo_pausa,codigo:this.codigo,proyecto:this.proyecto,es_cambio_de_escena:!0}
this.pilas.definir_modo("ModoEjecucion",e)},ModoEjecucion.prototype._obtener_cuerpos_desde_clave=function(t,e){var i=t.split("-"),a=+i[0],o=+i[1]
return{figura_1:e.find((function(t){return t.id===a})),figura_2:e.find((function(t){return t.id===o}))}},ModoEjecucion.prototype._reportar_colision_entre_figuras=function(t,e,i){void 0===i&&(i=null)
try{if(t&&e&&t.gameObject&&t.gameObject.actor&&e.gameObject&&e.gameObject.actor){var a=t.gameObject.actor,o=e.gameObject.actor
a.colisiones.push(o),o.colisiones.push(a)
var r=a.cuando_comienza_una_colision(o),n=o.cuando_comienza_una_colision(a);(r||n)&&i&&(i.isActive=!1)}else t&&e&&e.sensor_del_actor&&t.gameObject&&e.sensor_del_actor!==t.gameObject.actor&&e.colisiones.push(t.gameObject.actor),t&&e&&t.sensor_del_actor&&e.gameObject&&t.sensor_del_actor!==e.gameObject.actor&&t.colisiones.push(e.gameObject.actor)}catch(s){this.pilas.mensajes.emitir_excepcion_al_editor(s,"al detectar colisiones")}},ModoEjecucion.prototype._reportar_colision_activa_entre_figuras=function(t,e){try{if(t&&e&&t.gameObject&&t.gameObject.actor&&e.gameObject&&e.gameObject.actor){var i=t.gameObject.actor,a=e.gameObject.actor;-1===i.colisiones.indexOf(a)&&i.colisiones.push(a),-1===a.colisiones.indexOf(i)&&a.colisiones.push(i),i.cuando_se_mantiene_una_colision(a),a.cuando_se_mantiene_una_colision(i)}}catch(o){this.pilas.mensajes.emitir_excepcion_al_editor(o,"al detectar colisiones")}},ModoEjecucion.prototype._reportar_fin_de_colision_entre_figuras=function(t,e){try{if(t&&e&&t.gameObject&&t.gameObject.actor&&e.gameObject&&e.gameObject.actor){var i=t.gameObject.actor,a=e.gameObject.actor
i.colisiones.splice(i.colisiones.indexOf(a),1),a.colisiones.splice(a.colisiones.indexOf(i),1),i.cuando_termina_una_colision(a),a.cuando_termina_una_colision(i)}else t&&e&&e.sensor_del_actor&&t.gameObject&&e.colisiones.indexOf(t.gameObject.actor)>-1&&e.colisiones.splice(e.colisiones.indexOf(t.gameObject.actor),1),t&&e&&t.sensor_del_actor&&e.gameObject&&t.colisiones.indexOf(e.gameObject.actor)>-1&&t.colisiones.splice(t.colisiones.indexOf(e.gameObject.actor),1)}catch(o){this.pilas.mensajes.emitir_excepcion_al_editor(o,"al detectar colisiones")}},ModoEjecucion.prototype.vincular_eventos_de_colision=function(){var t=this,e=this.pilas,i=[]
this.matter.world.on("beforeupdate",(function(a){var o=t.matter.world.getAllBodies().filter((function(t){return t.isStatic})),r=[]
o.map((function(t){try{var i=o.filter((function(e){return e.id!==t.id}))
e.Phaser.Physics.Matter.Matter.Query.collides(t,i).map((function(t){var e=t.bodyA,i=t.bodyB
if(e.gameObject&&e.gameObject.actor&&i.gameObject&&i.gameObject.actor){var a=e.gameObject.actor,o=i.gameObject.actor
if(a._vivo&&o._vivo){var n=a.cuando_colisiona(o),s=o.cuando_colisiona(a)
r.push(e.id+"-"+i.id),(n||s)&&(t.isActive=!1),a._bloques_cuando_colisiona&&(n=a._bloques_cuando_colisiona(o)),o._bloques_cuando_colisiona&&(s=o._bloques_cuando_colisiona(a)),(n||s)&&(t.isActive=!1)}}}))}catch(a){e.mensajes.emitir_excepcion_al_editor(a,"al detectar colisiones")}}))
var n=r.filter((function(t){return!i.includes(t)})),s=r.filter((function(t){return i.includes(t)})),c=i.filter((function(t){return!r.includes(t)}))
n.map((function(e){var i=t._obtener_cuerpos_desde_clave(e,o),a=i.figura_1,r=i.figura_2
t._reportar_colision_entre_figuras(a,r,null)})),s.map((function(e){var i=t._obtener_cuerpos_desde_clave(e,o),a=i.figura_1,r=i.figura_2
t._reportar_colision_activa_entre_figuras(a,r)})),c.map((function(e){var i=t._obtener_cuerpos_desde_clave(e,o),a=i.figura_1,r=i.figura_2
t._reportar_fin_de_colision_entre_figuras(a,r)})),i=r})),this.matter.world.on("collisionstart",(function(e){for(var i=0;i<e.pairs.length;i++){var a=e.pairs[i],o=a.bodyA,r=a.bodyB
t._reportar_colision_entre_figuras(o,r,a)}})),this.matter.world.on("collisionactive",(function(e,i,a){for(var o=0;o<e.pairs.length;o++){var r=e.pairs[o],n=r.bodyA,s=r.bodyB
t._reportar_colision_activa_entre_figuras(n,s)}})),this.matter.world.on("collisionend",(function(e,i,a){for(var o=0;o<e.pairs.length;o++){var r=e.pairs[o],n=r.bodyA,s=r.bodyB
t._reportar_fin_de_colision_entre_figuras(n,s)}}))},ModoEjecucion.prototype.obtener_escena_inicial=function(){var t=this.obtener_nombre_de_la_escena_inicial()
return this.obtener_escena_por_nombre(t)},ModoEjecucion.prototype.obtener_nombre_de_la_escena_inicial=function(){return this.nombre_de_la_escena_inicial},ModoEjecucion.prototype.obtener_escena_por_nombre=function(t){var e=this.proyecto.escenas.filter((function(e){return e.nombre==t})),i=this.proyecto.escenas.map((function(t){return t.nombre})).join(",")
if(0===e.length)throw Error("No se puede encontrar la escena '"+t+"' en "+i)
if(e.length>1)throw Error("Hay más de una escena llamada '"+t+"'.")
return e[0]},ModoEjecucion.prototype.instanciar_proyecto=function(){var t=new this.clases.Proyecto(this.pilas)
t.iniciar&&t.iniciar(),this.instancia_de_proyecto=t},ModoEjecucion.prototype.instanciar_escena=function(t){var e=this.obtener_escena_por_nombre(t)
e.fondo&&this.crear_fondo(e.fondo,e.ancho,e.alto),this.crear_escena(e)},ModoEjecucion.prototype.crear_escena=function(datos_de_la_escena){var _this=this,nombre=datos_de_la_escena.nombre
if(!this.clases[nombre])throw new Error("No hay una clase con el nombre "+nombre)
var escena=new this.clases[nombre](this.pilas)
if(escena.proyecto=this.instancia_de_proyecto,escena.camara.x=datos_de_la_escena.camara_x,escena.camara.y=datos_de_la_escena.camara_y,escena.fondo=datos_de_la_escena.fondo,escena.ancho=datos_de_la_escena.ancho,escena.alto=datos_de_la_escena.alto,void 0!==datos_de_la_escena.gravedad_x&&(escena.gravedad_x=datos_de_la_escena.gravedad_x),void 0!==datos_de_la_escena.gravedad_y&&(escena.gravedad_y=datos_de_la_escena.gravedad_y),this.actores=datos_de_la_escena.actores.map((function(t){return!1!==t.activo&&_this.crear_actor(t)})).map((function(t){if(t){var e=t.actor,i=t.entidad
return _this.inicializar_actor(e,i)}return!1})).filter((function(t){return t})),this._escena_en_ejecucion=escena,this.bloques&&this.bloques.escenas){var items_bloques=this.bloques.escenas.filter((function(t){return t.nombre==nombre}))
items_bloques.length>0&&eval(items_bloques[0].bloques.codigo_de_bloques)}escena.iniciar(),escena._bloques_al_iniciar&&escena._bloques_al_iniciar()},ModoEjecucion.prototype.existe_actor_llamado_en_el_proyecto=function(t){return-1!==this.obtener_nombres_de_actores().indexOf(t)},ModoEjecucion.prototype.clonar_actor_por_nombre=function(t){var e=this.obtener_nombres_de_actores()
if(-1===e.indexOf(t)){var i=this.pilas.utilidades.obtener_mas_similar(t,e)
throw new Error('No se encuentra el actor "'+t+'", ¿quisiste decir "'+i+'"?')}var a=this.obtener_definicion_de_actor_por_nombre(t)
a.id=void 0
var o=this.crear_actor(a).actor
return this.inicializar_actor(o,a)},ModoEjecucion.prototype.obtener_nombres_de_actores=function(){return this.obtener_entidades_de_actores_de_todas_las_escenas().map((function(t){return t.nombre}))},ModoEjecucion.prototype.obtener_entidades_de_actores_de_todas_las_escenas=function(){return this.proyecto.escenas.map((function(t){return t.actores})).reduce((function(t,e){return t.concat(e)}))},ModoEjecucion.prototype.obtener_definicion_de_actor_por_nombre=function(t){return this.obtener_entidades_de_actores_de_todas_las_escenas().filter((function(e){return e.nombre===t}))[0]},ModoEjecucion.prototype.crear_actor=function(entidad){var actor=null,clase=this.clases[entidad.nombre]
if(!clase){var nombres_de_clases=Object.getOwnPropertyNames(this.clases)
throw new Error("No existe código para crear un actor de la clase "+entidad.nombre+". Las clases disponibles son ["+nombres_de_clases.join(", ")+"]")}actor=new this.clases[entidad.nombre](this.pilas),actor.proyecto=this.instancia_de_proyecto
var items_bloques=this.bloques.actores.filter((function(t){return t.nombre==entidad.nombre}))
items_bloques.length>0&&eval(items_bloques[0].codigo_de_bloques)
var p=this.pilas.utilidades.combinar_propiedades(actor.propiedades_base,actor.propiedades)
return p=this.pilas.utilidades.combinar_propiedades(p,entidad),actor.pre_iniciar(p),{actor:actor,entidad:entidad}},ModoEjecucion.prototype.inicializar_actor=function(t,e){return t.agregar_sensores_desde_lista(e.sensores),t.iniciar(),t._bloques_iniciar&&t._bloques_iniciar(),e.habilidades&&e.habilidades.map((function(e){t.aprender(e)})),t},ModoEjecucion.prototype.obtener_referencias_a_clases=function(){var codigoDeExportacion=this.obtener_codigo_para_exportar_clases(this.codigo),codigo_completo=this.codigo+codigoDeExportacion
return eval(codigo_completo)},ModoEjecucion.prototype.obtener_codigo_para_exportar_clases=function(t){var e=/var (.*) \= \/\*\* @class/g,i=/var\ (\w+)/,a=[]
t.match(e)&&(a=t.match(e).map((function(t){return t.match(i)[1]})))
for(var o={},r=0;r<a.length;r++){var n=a[r]
o[n]=n}return"__clases = "+JSON.stringify(o).replace(/"/g,"")+";\n__clases;"},ModoEjecucion.prototype.guardar_parametros_en_atributos=function(t){this.pilas=t.pilas,this.ancho=t.proyecto.ancho,this.alto=t.proyecto.alto,this.nombre_de_la_escena_inicial=t.nombre_de_la_escena_inicial,this.proyecto=t.proyecto,this.codigo=t.codigo,this.permitir_modo_pausa=t.permitir_modo_pausa,this.bloques=t.proyecto.bloques},ModoEjecucion.prototype.update=function(){if(!this.con_error){_super.prototype.update.call(this,this.pilas.escena.actores)
try{this.pilas.escena.iniciar_animaciones_pendientes(),this.pilas.escena.pre_actualizar(),this.pilas.escena.actualizar(),this.pilas.escena._bloques_al_actualizar&&this.pilas.escena._bloques_al_actualizar(),this.pilas.escena.actualizar_actores(),this.pilas.escena.reproducir_sonidos_pendientes(),this.pilas.depurador.fisica_en_modo_ejecucion?(this.canvas_fisica.setAlpha(1),this.actualizar_canvas_fisica()):this.canvas_fisica.setAlpha(0),this.posicionar_fondo(this.pilas.escena.desplazamiento_del_fondo_x,this.pilas.escena.desplazamiento_del_fondo_y)}catch(t){return this.pilas.mensajes.emitir_excepcion_al_editor(t,"actualizando escena")}this.permitir_modo_pausa&&this.guardar_foto_de_entidades(),this.pilas.mensajes.emitir_mensaje_al_editor("codigo_ejecutado",{instrumentacion:this.pilas.instrumentacion,instrumentacion_de_bloques:this.pilas.instrumentacion_de_bloques}),this.pilas.limpiar_traza_de_ejecucion()}},ModoEjecucion.prototype.guardar_foto_de_entidades=function(){if(this.pilas.instrumentacion){var t=JSON.parse(JSON.stringify(this.pilas.instrumentacion)),e=JSON.parse(JSON.stringify(this.pilas.instrumentacion_de_bloques))
this.pilas.historia.serializar_escena(this.pilas.escena,t,e)}},ModoEjecucion.prototype.dibujar_punto_de_control=function(t,e,i){t.fillStyle(16777215,1)
var a=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(e,i),o=a.x,r=a.y
t.fillRect(o-3,r-3,6,6),t.fillStyle(0,1),t.fillRect(o-2,r-2,4,4)},ModoEjecucion}(Modo),ModoEjecucionEnPausa=function(t){function e(){return t.call(this,{key:"ModoEjecucionEnPausa"})||this}return __extends(e,t),e.prototype.preload=function(){},e.prototype.create=function(t){this.pilas=this.scene.manager.getScene("ModoCargador").pilas
var e=this.pilas._ancho,i=(this.pilas._alto,this.add.bitmapText(e/2,200,"color-blanco-con-sombra-medio","PAUSA")),a=this.add.bitmapText(e/2,260,"color-blanco-con-sombra-chico","Click o SPACE para reanudar")
i.x-=i.getTextBounds().local.width/2,a.x-=a.getTextBounds().local.width/2,this.input.keyboard.once("keydown_SPACE",this.reanudar,this),this.input.on("pointerdown",this.reanudar,this)},e.prototype.update=function(){},e.prototype.reanudar=function(){this.pilas.modo.scene.resume("ModoEjecucion"),this.game.scene.stop("ModoEjecucionEnPausa")},e}(Modo),ModoError=function(t){function e(){return t.call(this,{key:"ModoError"})||this}return __extends(e,t),e.prototype.preload=function(){this.permitir_modo_pausa=!0},e.prototype.create=function(t){var e
if(this.pilas=t.pilas,this.pilas.opciones.modo_simple)return this.add.text(0,0,"Ha ocurrido un error, mire el detalle en la consola."),void console.error(t.error)
this.conectar_eventos(),this.crear_fondo(),this.crear_titulo(),e=this.crear_subtitulo(t.pilas._ancho,t.error.message.replace(/Error: /g,"")),this.crear_detalle_del_error(e,t),console.error(t.error)},e.prototype.traducir_mensaje_de_error=function(t){var e=/(.*) is not defined/,i=/Cannot read property 'position' of undefined/,a=/Cannot read property '(.*)' of undefined/,o=/(.*) is not a function/
return t.match(e)?t.replace(e,"La variable '$1' no está definida"):t.match(i)?t.replace(i,"Se intentó acceder a un actor eliminado"):t.match(a)?t.replace(a,"No se puede llamar a '$1' de una variable que tiene el valor undefined"):t.match(o)?t.replace(o,"'$1' no es una función"):t},e.prototype.crear_fondo=function(){var t=this.add.graphics()
t.fillStyle(5802926,.75),t.fillRect(0,0,3e3,3e3),t.setDepth(5e5),t.setScrollFactor(0,0)},e.prototype.crear_titulo=function(){var t=this.add.bitmapText(10,10,"color-blanco-con-sombra-grande","uy!")
t.setDepth(500001),t.setScrollFactor(0,0)},e.prototype.crear_subtitulo=function(t,e){e=this.traducir_mensaje_de_error(e)
var i=this.add.bitmapText(10,90,"color-blanco-con-sombra-chico",e)
return i.setMaxWidth(t-20),i.setDepth(500001),i.setScrollFactor(0,0),20+i.y+i.getTextBounds().local.height},e.prototype.crear_detalle_del_error=function(t,e){var i="Hacé click en este mensaje para ver el mensaje de error completo."
i="El error se produjo cuando se llamó al método: \n"+(e.stacktrace.split("\n")[1].trim().replace("- ","")+"(...)")+" \n\n"+i
var a=this.add.bitmapText(10,t,"color-blanco-con-sombra",i).setInteractive({cursor:"pointer"}),o=this
a.on("pointerdown",(function(){this.destroy()
var i=e.stacktrace.replace(/Error: /g,"")
o.add.bitmapText(10,t,"color-blanco-con-sombra",i).setDepth(5e5)})),a.setDepth(500001),a.setScrollFactor(0,0)},e.prototype.update=function(){},e.prototype.guardar_foto_de_entidades=function(){},e.prototype.conectar_eventos=function(){this.input.keyboard.on("keyup",this.manejar_evento_key_up.bind(this))},e.prototype.manejar_evento_key_up=function(t){"Escape"===t.key&&this.pilas.mensajes.emitir_mensaje_al_editor("pulsa_la_tecla_escape",{})},e}(Modo),ModoPausa=function(t){function e(){var e=t.call(this,{key:"ModoPausa"})||this
return e.fondo_anterior=null,e._anterior_posicion_x_de_la_camara=0,e._anterior_posicion_y_de_la_camara=0,e}return __extends(e,t),e.prototype.crear_indicador_de_texto=function(){this.indicador_de_texto=this.add.bitmapText(5,10,"color-blanco-con-sombra",""),this.indicador_de_texto.scrollFactorX=0,this.indicador_de_texto.scrollFactorY=0,this.indicador_de_texto.depth=999999,this.indicador_de_texto.align=2},e.prototype.preload=function(){},e.prototype.create=function(e){t.prototype.create.call(this,e,e.pilas._ancho,e.pilas._alto),this.pilas=e.pilas,this.posicion=this.pilas.historia.obtener_cantidad_de_posiciones(),this.total=this.pilas.historia.obtener_cantidad_de_posiciones(),this.sprites=[],this.crear_indicador_de_texto(),this._anterior_valor_del_modo_posicion_activado=this.pilas.depurador.modo_posicion_activado
var i=this.pilas.historia.obtener_foto(1)
this.crear_fondo(i.escena.fondo,i.escena.ancho,i.escena.alto),this.crear_canvas_de_depuracion_modo_pausa(),this.actualizar_posicion(this.posicion),this.tecla_izquierda=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.tecla_derecha=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT)
var a=this.pilas.historia.obtener_cantidad_de_posiciones(),o={minimo:0,posicion:a,maximo:a}
this.pilas.mensajes.emitir_mensaje_al_editor("comienza_a_depurar_en_modo_pausa",o),this.crear_manejadores_para_controlar_el_zoom(!1)},e.prototype.crear_sprites_desde_historia=function(t){var e=this,i=this.pilas.historia.obtener_foto(t)
this.sprites.map((function(t){t.figura&&e.pilas.Phaser.Physics.Matter.Matter.World.remove(e.pilas.modo.matter.world.localWorld,t.figura),t.texto&&t.texto.destroy(),t.fondo&&t.fondo.destroy(),t.destroy()})),this.graphics.clear(),this.fondo.setAlpha(.8),this.hacer_arratrable_el_fondo(),this.limitar_movimiento_de_la_camara_a_los_bordes_actuales(i.escena),this.posicionar_la_camara(i.escena),this.posicionar_fondo(i.escena),this.sprites=i.actores.map((function(t){if(e.pilas.depurador.modo_posicion_activado){var i=e.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(t.x,t.y),a=i.x,o=i.y
e.dibujar_punto_de_control(e.graphics,a,o)}return e.crear_sprite_desde_entidad(t)}))
var a=Math.floor((t+1)/60/60),o=Math.floor((t+1)/60)%60,r=("0"+a).slice(-2),n=("0"+o).slice(-2)
this.indicador_de_texto.text="Tiempo: "+r+"' "+n+"''\nCuadro: "+(t+1)+"\nCantidad de actores: "+i.actores.length,this.indicador_de_texto.x=this.ancho-this.indicador_de_texto.width-10},e.prototype.posicionar_fondo=function(t){var e=t.desplazamiento_del_fondo_x||0,i=t.desplazamiento_del_fondo_y||0,a={x:t.camara_x,y:-t.camara_y}
this.fondo&&(this.fondo.x=a.x,this.fondo.y=a.y,this.fondo.tilePositionX=a.x+e,this.fondo.tilePositionY=a.y+i)},e.prototype.posicionar_la_camara=function(t){var e=t.camara_x,i=-t.camara_y
this._anterior_posicion_x_de_la_camara===e&&this._anterior_posicion_y_de_la_camara===i||(this.cameras.cameras[0].setScroll(e,i),this._anterior_posicion_x_de_la_camara=e,this._anterior_posicion_y_de_la_camara=i)},e.prototype.limitar_movimiento_de_la_camara_a_los_bordes_actuales=function(t){var e=t.camara_x,i=-t.camara_y
this.cameras.cameras[0].setBounds(e,i,this.ancho,this.alto)},e.prototype.hacer_arratrable_el_fondo=function(){var t=this
this.fondo.setInteractive(),this.input.setDraggable(this.fondo,void 0)
var e=this
this.input.on("dragstart",(function(i,a){t.posicion_anterior_de_arrastre=i.position.clone(),e.pilas.utilidades.es_firefox()?e.input.setDefaultCursor("grabbing"):e.input.setDefaultCursor("-webkit-grabbing")})),this.input.on("drag",(function(e,i,a,o){t.desplazar_la_camara_desde_el_evento_drag(e)})),this.input.on("dragend",(function(t,i){e.input.setDefaultCursor("default")}))},e.prototype.desplazar_la_camara_desde_el_evento_drag=function(t){var e=this.cameras.main.zoom,i=this.obtener_factores(),a=this.posicion_anterior_de_arrastre.x-t.position.x,o=this.posicion_anterior_de_arrastre.y-t.position.y
this.cameras.main.scrollX+=a/i.x/e,this.cameras.main.scrollY+=o/i.y/e,this.posicion_anterior_de_arrastre=t.position.clone()},e.prototype.obtener_factores=function(){return{x:Math.min(1,this.ancho/this.alto),y:Math.min(1,this.alto/this.ancho)}},e.prototype.update=function(){this._anterior_valor_del_modo_posicion_activado!==this.pilas.depurador.modo_posicion_activado&&(this.actualizar_posicion(this.posicion),this._anterior_valor_del_modo_posicion_activado=this.pilas.depurador.modo_posicion_activado),this.tecla_derecha.isDown&&this.avanzar_posicion(),this.tecla_izquierda.isDown&&this.retroceder_posicion(),this.pilas.depurador.mostrar_fisica?this.canvas_fisica.setAlpha(1):this.canvas_fisica.setAlpha(0)},e.prototype.dibujar_sensores_sobre_canvas_fisica=function(t){var e=this,i=this.canvas_fisica
this.pilas.historia.obtener_foto(t).actores.map((function(t){t.sensores.map((function(t){e.dibujar_figura_desde_vertices(i,2,16728128,t)}))}))},e.prototype.crear_sprite_desde_entidad=function(t){var e=t.imagen,i=null,a=null,o=null,r=this.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(t.x,t.y),n=r.x,s=r.y
if(e.indexOf(":")>-1?(a=e.split(":")[0],o=e.split(":")[1]):(a=null,o=e),(i=a?this.add.sprite(n,s,a,o):this.add.sprite(n,s,o)).angle=-t.rotacion,i.setOrigin(t.centro_x,t.centro_y),i.scaleX=t.escala_x,i.scaleY=t.escala_y,i.alpha=1-t.transparencia/100,i.setFlipX(t.espejado),i.setFlipY(t.espejado_vertical),i.depth=-t.z,t.hit_activado&&i.setCrop(t.hit_x,t.hit_y,t.hit_ancho,t.hit_alto),t.fijo&&i.setScrollFactor(0,0),t.texto){if(i.texto=this.pilas.modo.add.bitmapText(0,0,t.fuente,t.texto),i.texto.depth=i.depth,t.fondo){var c=this.obtener_imagen_para_nineslice(t.fondo),l=this.pilas.modo.add.nineslice(40,0,30,20,c,10,10)
i.fondo=l,i.fondo_imagen=t.fondo}this.copiar_valores_de_sprite_a_texto(i),i.fondo&&(i.fondo.depth=i.texto.depth-1,i.fondo.x=i.texto.x,i.fondo.y=i.texto.y,i.fondo.x+=30*i.texto.originX-15,i.fondo.y+=30*i.texto.originY-15,i.fondo.setOrigin(i.texto.originX,i.texto.originY),t.fondo.includes("dialogo")&&(i.fondo.y+=4),t.fijo&&i.fondo.setScrollFactor(0,0)),t.fijo&&i.texto.setScrollFactor(0,0)}return t.figura&&(i.figura=this.crear_figura_estatica_para(t),i.figura.es_sensor=t.figura_sensor,i.figura.es_dinamica=t.figura_dinamica,i.figura.actor_id=t.id),i},e.prototype.actualizar_posicion=function(t){this.posicion=t,this.posicion=Math.min(this.posicion,this.total),this.posicion=Math.max(this.posicion,0),this.crear_sprites_desde_historia(this.posicion)
var e=this.pilas.historia.obtener_foto(this.posicion),i=JSON.parse(JSON.stringify(e.instrumentacion)),a=JSON.parse(JSON.stringify(e.instrumentacion_de_bloques))
this.pilas.mensajes.emitir_mensaje_al_editor("codigo_ejecutado",{instrumentacion:i,instrumentacion_de_bloques:a}),this.completar_foto_detallando_actores_nuevos_y_eliminados(e),this.pilas.mensajes.emitir_mensaje_al_editor("aplica_el_cambio_de_posicion_en_el_modo_pausa",{posicion:this.posicion,foto:e}),this.actualizar_canvas_fisica(),this.dibujar_sensores_sobre_canvas_fisica(this.posicion)},e.prototype.completar_foto_detallando_actores_nuevos_y_eliminados=function(t){if(this.posicion-1>0){var e=this.pilas.historia.obtener_foto(this.posicion-1).actores.map((function(t){return t.nombre}))
t.actores.forEach((function(t){t.es_nuevo=!e.includes(t.nombre)}))}if(this.posicion+1<this.pilas.historia.obtener_cantidad_de_posiciones()){var i=this.pilas.historia.obtener_foto(this.posicion+1).actores.map((function(t){return t.nombre}))
t.actores.forEach((function(t){t.se_elimina_en_el_siguiente_cuadro=!i.includes(t.nombre)}))}},e.prototype.avanzar_posicion=function(){this.posicion+=1,this.actualizar_posicion(this.posicion),this.pilas.mensajes.emitir_mensaje_al_editor("cambia_posicion_dentro_del_modo_pausa",{posicion:this.posicion})},e.prototype.retroceder_posicion=function(){this.posicion-=1,this.actualizar_posicion(this.posicion),this.pilas.mensajes.emitir_mensaje_al_editor("cambia_posicion_dentro_del_modo_pausa",{posicion:this.posicion})},e.prototype.crear_canvas_de_depuracion_modo_pausa=function(){var t=this.add.graphics()
t.depth=190,this.graphics_modo_pausa=t,this.pilas.historia.dibujar_puntos_de_las_posiciones_recorridas(t,null)},e.prototype.dibujar_lasers=function(){var t=this,e=this.pilas.historia.obtener_foto(this.posicion),i=this.canvas_fisica
e.actores.map((function(e){e.lasers.map((function(a){var o=t.pilas.utilidades.convertir_coordenada_de_pilas_a_phaser(e.x,e.y),r=o.x,n=o.y
t.dibujar_laser_del_actor(a,i,{x:r,y:n,id:e.id})}))}))},e.prototype.selecciona_actor_o_escena_en_modo_pausa=function(t){this.seleccion=t,this.actualizar_posicion(this.posicion),this.graphics_modo_pausa.clear(),this.pilas.historia.dibujar_puntos_de_las_posiciones_recorridas(this.graphics_modo_pausa,t)},e}(Modo)
